SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[sp_CIC_iCarolImport_Rollup]
WITH EXECUTE AS CALLER
AS
SET NOCOUNT ON

DECLARE	@Error		INT
SET @Error = 0

MERGE INTO dbo.CIC_iCarolImportRollup dst
USING dbo.CIC_iCarolImport AS src
ON src.ResourceAgencyNum=dst.ResourceAgencyNum AND src.LangID=dst.LangID AND src.TaxonomyLevelName = 'Agency'
WHEN MATCHED AND (src.SYNC_DATE > dst.DATE_MODIFIED)  THEN 
	UPDATE SET 
		[PublicName]=src.[PublicName],
		[AlternateName]=src.[AlternateName],
		[OfficialName]=src.[OfficialName],
		[TaxonomyLevelName]=src.[TaxonomyLevelName],
		[ParentAgency]=src.[ParentAgency],
		[ParentAgencyNum]=src.[ParentAgencyNum],
		[RECORD_OWNER]=LEFT(src.[Custom_Record Owner (controlled)], 3),
		[UniqueIDPriorSystem]=LEFT(src.[UniqueIDPriorSystem], 8),
		[MailingAttentionName]=src.[MailingAttentionName],
		[MailingAddress1]=src.[MailingAddress1],
		[MailingAddress2]=src.[MailingAddress2],
		[MailingCity]=src.[MailingCity],
		[MailingStateProvince]=src.[MailingStateProvince],
		[MailingPostalCode]=src.[MailingPostalCode],
		[MailingCountry]=NULLIF(src.[MailingCountry],'-1'),
		[MailingAddressIsPrivate]=src.[MailingAddressIsPrivate],
		[PhysicalAddress1]=src.[PhysicalAddress1],
		[PhysicalAddress2]=src.[PhysicalAddress2],
		[PhysicalCity]=src.[PhysicalCity],
		[PhysicalCounty]=src.[PhysicalCounty],
		[PhysicalStateProvince]=src.[PhysicalStateProvince],
		[PhysicalPostalCode]=src.[PhysicalPostalCode],
		[PhysicalCountry]=NULLIF(src.[PhysicalCountry], '-1'),
		[PhysicalAddressIsPrivate]=src.[PhysicalAddressIsPrivate],
		[OtherAddress1]=src.[OtherAddress1],
		[OtherAddress2]=src.[OtherAddress2],
		[OtherCity]=src.[OtherCity],
		[OtherCounty]=src.[OtherCounty],
		[OtherStateProvince]=src.[OtherStateProvince],
		[OtherPostalCode]=src.[OtherPostalCode],
		[OtherCountry]=src.[OtherCountry],
		[Latitude]=NULLIF(src.[Latitude],'0'),
		[Longitude]=NULLIF(src.[Longitude], '0'),
		[HoursOfOperation]=src.[HoursOfOperation],
		[Phone1Number]=src.[Phone1Number],
		[Phone1Name]=src.[Phone1Name],
		[Phone1Description]=src.[Phone1Description],
		[Phone1IsPrivate]=src.[Phone1IsPrivate],
		[Phone1Type]=src.[Phone1Type],
		[Phone2Number]=src.[Phone2Number],
		[Phone2Name]=src.[Phone2Name],
		[Phone2Description]=src.[Phone2Description],
		[Phone2IsPrivate]=src.[Phone2IsPrivate],
		[Phone2Type]=src.[Phone2Type],
		[Phone3Number]=src.[Phone3Number],
		[Phone3Name]=src.[Phone3Name],
		[Phone3Description]=src.[Phone3Description],
		[Phone3IsPrivate]=src.[Phone3IsPrivate],
		[Phone3Type]=src.[Phone3Type],
		[Phone4Number]=src.[Phone4Number],
		[Phone4Name]=src.[Phone4Name],
		[Phone4Description]=src.[Phone4Description],
		[Phone4IsPrivate]=src.[Phone4IsPrivate],
		[Phone4Type]=src.[Phone4Type],
		[Phone5Number]=src.[Phone5Number],
		[Phone5name]=src.[Phone5name],
		[Phone5Description]=src.[Phone5Description],
		[Phone5IsPrivate]=src.[Phone5IsPrivate],
		[Phone5Type]=src.[Phone5Type],
		[PhoneFax]=src.[PhoneFax],
		[PhoneFaxDescription]=src.[PhoneFaxDescription],
		[PhoneFaxIsPrivate]=src.[PhoneFaxIsPrivate],
		[PhoneTTY]=src.[PhoneTTY],
		[PhoneTTYDescription]=src.[PhoneTTYDescription],
		[PhoneTTYIsPrivate]=src.[PhoneTTYIsPrivate],
		[PhoneTollFree]=src.[PhoneTollFree],
		[PhoneTollFreeDescription]=src.[PhoneTollFreeDescription],
		[PhoneTollFreeIsPrivate]=src.[PhoneTollFreeIsPrivate],
		[PhoneNumberHotline]=src.[PhoneNumberHotline],
		[PhoneNumberHotlineDescription]=src.[PhoneNumberHotlineDescription],
		[PhoneNumberHotlineIsPrivate]=src.[PhoneNumberHotlineIsPrivate],
		[PhoneNumberBusinessLine]=src.[PhoneNumberBusinessLine],
		[PhoneNumberBusinessLineDescription]=src.[PhoneNumberBusinessLineDescription],
		[PhoneNumberBusinessLineIsPrivate]=src.[PhoneNumberBusinessLineIsPrivate],
		[PhoneNumberOutOfArea]=src.[PhoneNumberOutOfArea],
		[PhoneNumberOutOfAreaDescription]=src.[PhoneNumberOutOfAreaDescription],
		[PhoneNumberOutOfAreaIsPrivate]=src.[PhoneNumberOutOfAreaIsPrivate],
		[PhoneNumberAfterHours]=src.[PhoneNumberAfterHours],
		[PhoneNumberAfterHoursDescription]=src.[PhoneNumberAfterHoursDescription],
		[PhoneNumberAfterHoursIsPrivate]=src.[PhoneNumberAfterHoursIsPrivate],
		[EmailAddressMain]=src.[EmailAddressMain],
		[WebsiteAddress]=src.[WebsiteAddress],
		[AgencyStatus]=src.[AgencyStatus],
		[AgencyClassification]=src.[AgencyClassification],
		[CoverageArea]=src.[CoverageArea],
		[CoverageAreaText]=src.[CoverageAreaText],
		[Eligibility]=src.[Eligibility],
		[EligibilityAdult]=src.[EligibilityAdult],
		[EligibilityChild]=src.[EligibilityChild],
		[EligibilityFamily]=src.[EligibilityFamily],
		[EligibilityFemale]=src.[EligibilityFemale],
		[EligibilityMale]=src.[EligibilityMale],
		[EligibilityTeen]=src.[EligibilityTeen],
		[SeniorWorkerName]=src.[SeniorWorkerName],
		[SeniorWorkerTitle]=src.[SeniorWorkerTitle],
		[SeniorWorkerEmailAddress]=src.[SeniorWorkerEmailAddress],
		[SeniorWorkerPhoneNumber]=src.[SeniorWorkerPhoneNumber],
		[SeniorWorkerIsPrivate]=src.[SeniorWorkerIsPrivate],
		[MainContactName]=src.[MainContactName],
		[MainContactTitle]=src.[MainContactTitle],
		[MainContactEmailAddress]=src.[MainContactEmailAddress],
		[MainContactPhoneNumber]=src.[MainContactPhoneNumber],
		[MainContactType]=src.[MainContactType],
		[MainContactIsPrivate]=src.[MainContactIsPrivate],
		[LicenseAccreditation]=src.[LicenseAccreditation],
		[YearIncorporated]=src.[YearIncorporated],
		[AnnualBudgetTotal]=src.[AnnualBudgetTotal],
		[LegalStatus]=src.[LegalStatus],
		[SourceOfFunds]=src.[SourceOfFunds],
		[ExcludeFromWebsite]=src.[ExcludeFromWebsite],
		[ExcludeFromDirectory]=src.[ExcludeFromDirectory],
		[DisabilitiesAccess]=src.[DisabilitiesAccess],
		[PhysicalLocationDescription]=src.[PhysicalLocationDescription],
		[BusServiceAccess]=src.[BusServiceAccess],
		[PublicAccessTransportation]=src.[PublicAccessTransportation],
		[PaymentMethods]=src.[PaymentMethods],
		[FeeStructureSource]=src.[FeeStructureSource],
		[ApplicationProcess]=src.[ApplicationProcess],
		[ResourceInfo]=src.[ResourceInfo],
		[DocumentsRequired]=src.[DocumentsRequired],
		[LanguagesOffered]=src.[LanguagesOffered],
		[LanguagesOfferedList]=src.[LanguagesOfferedList],
		[AvailabilityNumberOfTimes]=src.[AvailabilityNumberOfTimes],
		[AvailabilityFrequency]=src.[AvailabilityFrequency],
		[AvailabilityPeriod]=src.[AvailabilityPeriod],
		[ServiceNotAlwaysAvailability]=src.[ServiceNotAlwaysAvailability],
		[CapacityType]=src.[CapacityType],
		[ServiceCapacity]=src.[ServiceCapacity],
		[NormalWaitTime]=src.[NormalWaitTime],
		[TemporaryMessage]=src.[TemporaryMessage],
		[TemporaryMessageAppears]=src.[TemporaryMessageAppears],
		[TemporaryMessageExpires]=src.[TemporaryMessageExpires],
		[EnteredOn]=src.[EnteredOn],
		[UpdatedOn]=src.[UpdatedOn],
		[MadeInactiveOn]=src.[MadeInactiveOn],
		[InternalNotes]=src.[InternalNotes],
		[InternalNotesForEditorsAndViewers]=src.[InternalNotesForEditorsAndViewers],
		[HighlightedResource]=src.[HighlightedResource],
		[LastVerifiedOn]=src.[LastVerifiedOn],
		[LastVerifiedByName]=src.[LastVerifiedByName],
		[LastVerifiedByTitle]=src.[LastVerifiedByTitle],
		[LastVerifiedByPhoneNumber]=src.[LastVerifiedByPhoneNumber],
		[LastVerifiedByEmailAddress]=src.[LastVerifiedByEmailAddress],
		[LastVerificationApprovedBy]=src.[LastVerificationApprovedBy],
		[AvailableForDirectory]=src.[AvailableForDirectory],
		[AvailableForReferral]=src.[AvailableForReferral],
		[AvailableForResearch]=src.[AvailableForResearch],
		[PreferredProvider]=src.[PreferredProvider],
		[ConnectsToSiteNum]=src.[ConnectsToSiteNum],
		[ConnectsToProgramNum]=src.[ConnectsToProgramNum],
		[LanguageOfRecord]=src.[LanguageOfRecord],
		[CurrentWorkflowStepCode]=src.[CurrentWorkflowStepCode],
		[VolunteerOpportunities]=src.[VolunteerOpportunities],
		[VolunteerDuties]=src.[VolunteerDuties],
		[IsLinkOnly]=src.[IsLinkOnly],
		[ProgramAgencyNamePublic]=src.[ProgramAgencyNamePublic],
		[SiteAgencyNamePublic]=src.[SiteAgencyNamePublic],
		[Categories]=src.[Categories],
		[TaxonomyTerm]=src.[TaxonomyTerm],
		[TaxonomyTerms]=src.[TaxonomyTerms],
		[TaxonomyTermsNotDeactivated]=src.[TaxonomyTermsNotDeactivated],
		[TaxonomyCodes]=src.[TaxonomyCodes],
		[Coverage]=src.[Coverage],
		[Hours]=src.[Hours],
		[Custom_Public Comments]=src.[Custom_Public Comments],
		[Custom_Former Names]=src.[Custom_Former Names],
		[Custom_Legal Name]=src.[Custom_Legal Name],
		[Custom_Facebook]=src.[Custom_Facebook],
		[Custom_Instagram]=src.[Custom_Instagram],
		[Custom_LinkedIn]=src.[Custom_LinkedIn],
		[Custom_Twitter]=src.[Custom_Twitter],
		[Custom_YouTube]=src.[Custom_YouTube],
		[Custom_Minimum Age]=src.[Custom_Minimum Age],
		[Custom_Maximum Age]=src.[Custom_Maximum Age],
		[dst].[DATE_MODIFIED]=GETDATE(),
		ORG_LEVEL_1=src.PublicName,
		dst.ORG_DESCRIPTION=src.AgencyDescription,
		dst.ORG_LOCATION_SERVICE='AGENCY',
		dst.DELETION_DATE=src.DELETION_DATE,
		dst.SOFT_DELETION_DATE=CASE WHEN src.[Custom_Deleted Record] = 'yes' THEN COALESCE(dst.SOFT_DELETION_DATE, GETDATE()) ELSE NULL END,
		dst.[Custom_Deleted Record]=src.[Custom_Deleted Record],
		[MailingCommunity]=src.[MailingCommunity],
		[OtherCommunity]=src.[OtherCommunity],
		[PhysicalCommunity]=src.[PhysicalCommunity]		
WHEN NOT MATCHED BY TARGET AND src.TaxonomyLevelName='Agency' THEN
	INSERT (
		[ResourceAgencyNum],
		[LangID],
		[PublicName],
		[AlternateName],
		[OfficialName],
		[TaxonomyLevelName],
		[ParentAgency],
		[ParentAgencyNum],
		[RECORD_OWNER],
		[UniqueIDPriorSystem],
		[MailingAttentionName],
		[MailingAddress1],
		[MailingAddress2],
		[MailingCity],
		[MailingStateProvince],
		[MailingPostalCode],
		[MailingCountry],
		[MailingAddressIsPrivate],
		[PhysicalAddress1],
		[PhysicalAddress2],
		[PhysicalCity],
		[PhysicalCounty],
		[PhysicalStateProvince],
		[PhysicalPostalCode],
		[PhysicalCountry],
		[PhysicalAddressIsPrivate],
		[OtherAddress1],
		[OtherAddress2],
		[OtherCity],
		[OtherCounty],
		[OtherStateProvince],
		[OtherPostalCode],
		[OtherCountry],
		[Latitude],
		[Longitude],
		[HoursOfOperation],
		[Phone1Number],
		[Phone1Name],
		[Phone1Description],
		[Phone1IsPrivate],
		[Phone1Type],
		[Phone2Number],
		[Phone2Name],
		[Phone2Description],
		[Phone2IsPrivate],
		[Phone2Type],
		[Phone3Number],
		[Phone3Name],
		[Phone3Description],
		[Phone3IsPrivate],
		[Phone3Type],
		[Phone4Number],
		[Phone4Name],
		[Phone4Description],
		[Phone4IsPrivate],
		[Phone4Type],
		[Phone5Number],
		[Phone5name],
		[Phone5Description],
		[Phone5IsPrivate],
		[Phone5Type],
		[PhoneFax],
		[PhoneFaxDescription],
		[PhoneFaxIsPrivate],
		[PhoneTTY],
		[PhoneTTYDescription],
		[PhoneTTYIsPrivate],
		[PhoneTollFree],
		[PhoneTollFreeDescription],
		[PhoneTollFreeIsPrivate],
		[PhoneNumberHotline],
		[PhoneNumberHotlineDescription],
		[PhoneNumberHotlineIsPrivate],
		[PhoneNumberBusinessLine],
		[PhoneNumberBusinessLineDescription],
		[PhoneNumberBusinessLineIsPrivate],
		[PhoneNumberOutOfArea],
		[PhoneNumberOutOfAreaDescription],
		[PhoneNumberOutOfAreaIsPrivate],
		[PhoneNumberAfterHours],
		[PhoneNumberAfterHoursDescription],
		[PhoneNumberAfterHoursIsPrivate],
		[EmailAddressMain],
		[WebsiteAddress],
		[AgencyStatus],
		[AgencyClassification],
		[CoverageArea],
		[CoverageAreaText],
		[Eligibility],
		[EligibilityAdult],
		[EligibilityChild],
		[EligibilityFamily],
		[EligibilityFemale],
		[EligibilityMale],
		[EligibilityTeen],
		[SeniorWorkerName],
		[SeniorWorkerTitle],
		[SeniorWorkerEmailAddress],
		[SeniorWorkerPhoneNumber],
		[SeniorWorkerIsPrivate],
		[MainContactName],
		[MainContactTitle],
		[MainContactEmailAddress],
		[MainContactPhoneNumber],
		[MainContactType],
		[MainContactIsPrivate],
		[LicenseAccreditation],
		[YearIncorporated],
		[AnnualBudgetTotal],
		[LegalStatus],
		[SourceOfFunds],
		[ExcludeFromWebsite],
		[ExcludeFromDirectory],
		[DisabilitiesAccess],
		[PhysicalLocationDescription],
		[BusServiceAccess],
		[PublicAccessTransportation],
		[PaymentMethods],
		[FeeStructureSource],
		[ApplicationProcess],
		[ResourceInfo],
		[DocumentsRequired],
		[LanguagesOffered],
		[LanguagesOfferedList],
		[AvailabilityNumberOfTimes],
		[AvailabilityFrequency],
		[AvailabilityPeriod],
		[ServiceNotAlwaysAvailability],
		[CapacityType],
		[ServiceCapacity],
		[NormalWaitTime],
		[TemporaryMessage],
		[TemporaryMessageAppears],
		[TemporaryMessageExpires],
		[EnteredOn],
		[UpdatedOn],
		[MadeInactiveOn],
		[InternalNotes],
		[InternalNotesForEditorsAndViewers],
		[HighlightedResource],
		[LastVerifiedOn],
		[LastVerifiedByName],
		[LastVerifiedByTitle],
		[LastVerifiedByPhoneNumber],
		[LastVerifiedByEmailAddress],
		[LastVerificationApprovedBy],
		[AvailableForDirectory],
		[AvailableForReferral],
		[AvailableForResearch],
		[PreferredProvider],
		[ConnectsToSiteNum],
		[ConnectsToProgramNum],
		[LanguageOfRecord],
		[CurrentWorkflowStepCode],
		[VolunteerOpportunities],
		[VolunteerDuties],
		[IsLinkOnly],
		[ProgramAgencyNamePublic],
		[SiteAgencyNamePublic],
		[Categories],
		[TaxonomyTerm],
		[TaxonomyTerms],
		[TaxonomyTermsNotDeactivated],
		[TaxonomyCodes],
		[Coverage],
		[Hours],
		[Custom_Public Comments],
		[Custom_Former Names],
		[Custom_Legal Name],
		[Custom_Facebook],
		[Custom_Instagram],
		[Custom_LinkedIn],
		[Custom_Twitter],
		[Custom_YouTube],
		[Custom_Minimum Age],
		[Custom_Maximum Age],
		[DATE_MODIFIED],
		ORG_LEVEL_1,
		ORG_DESCRIPTION,
		ORG_LOCATION_SERVICE,
		DELETION_DATE,
		SOFT_DELETION_DATE,
		[Custom_Deleted Record],
		[MailingCommunity],
		[OtherCommunity],
		[PhysicalCommunity]
	) VALUES (
		src.[ResourceAgencyNum],
		src.LangID,
		src.[PublicName],
		src.[AlternateName],
		src.[OfficialName],
		src.[TaxonomyLevelName],
		src.[ParentAgency],
		src.[ParentAgencyNum],
		LEFT(src.[Custom_Record Owner (controlled)], 3),
		LEFT(src.[UniqueIDPriorSystem],8),
		src.[MailingAttentionName],
		src.[MailingAddress1],
		src.[MailingAddress2],
		src.[MailingCity],
		src.[MailingStateProvince],
		src.[MailingPostalCode],
		NULLIF(src.[MailingCountry], '-1'),
		src.[MailingAddressIsPrivate],
		src.[PhysicalAddress1],
		src.[PhysicalAddress2],
		src.[PhysicalCity],
		src.[PhysicalCounty],
		src.[PhysicalStateProvince],
		src.[PhysicalPostalCode],
		NULLIF(src.[PhysicalCountry], '-1'),
		src.[PhysicalAddressIsPrivate],
		src.[OtherAddress1],
		src.[OtherAddress2],
		src.[OtherCity],
		src.[OtherCounty],
		src.[OtherStateProvince],
		src.[OtherPostalCode],
		NULLIF(src.[OtherCountry], '-1'),
		NULLIF(src.[Latitude],'0'),
		NULLIF(src.[Longitude],'0'),
		src.[HoursOfOperation],
		src.[Phone1Number],
		src.[Phone1Name],
		src.[Phone1Description],
		src.[Phone1IsPrivate],
		src.[Phone1Type],
		src.[Phone2Number],
		src.[Phone2Name],
		src.[Phone2Description],
		src.[Phone2IsPrivate],
		src.[Phone2Type],
		src.[Phone3Number],
		src.[Phone3Name],
		src.[Phone3Description],
		src.[Phone3IsPrivate],
		src.[Phone3Type],
		src.[Phone4Number],
		src.[Phone4Name],
		src.[Phone4Description],
		src.[Phone4IsPrivate],
		src.[Phone4Type],
		src.[Phone5Number],
		src.[Phone5name],
		src.[Phone5Description],
		src.[Phone5IsPrivate],
		src.[Phone5Type],
		src.[PhoneFax],
		src.[PhoneFaxDescription],
		src.[PhoneFaxIsPrivate],
		src.[PhoneTTY],
		src.[PhoneTTYDescription],
		src.[PhoneTTYIsPrivate],
		src.[PhoneTollFree],
		src.[PhoneTollFreeDescription],
		src.[PhoneTollFreeIsPrivate],
		src.[PhoneNumberHotline],
		src.[PhoneNumberHotlineDescription],
		src.[PhoneNumberHotlineIsPrivate],
		src.[PhoneNumberBusinessLine],
		src.[PhoneNumberBusinessLineDescription],
		src.[PhoneNumberBusinessLineIsPrivate],
		src.[PhoneNumberOutOfArea],
		src.[PhoneNumberOutOfAreaDescription],
		src.[PhoneNumberOutOfAreaIsPrivate],
		src.[PhoneNumberAfterHours],
		src.[PhoneNumberAfterHoursDescription],
		src.[PhoneNumberAfterHoursIsPrivate],
		src.[EmailAddressMain],
		src.[WebsiteAddress],
		src.[AgencyStatus],
		src.[AgencyClassification],
		src.[CoverageArea],
		src.[CoverageAreaText],
		src.[Eligibility],
		src.[EligibilityAdult],
		src.[EligibilityChild],
		src.[EligibilityFamily],
		src.[EligibilityFemale],
		src.[EligibilityMale],
		src.[EligibilityTeen],
		src.[SeniorWorkerName],
		src.[SeniorWorkerTitle],
		src.[SeniorWorkerEmailAddress],
		src.[SeniorWorkerPhoneNumber],
		src.[SeniorWorkerIsPrivate],
		src.[MainContactName],
		src.[MainContactTitle],
		src.[MainContactEmailAddress],
		src.[MainContactPhoneNumber],
		src.[MainContactType],
		src.[MainContactIsPrivate],
		src.[LicenseAccreditation],
		src.[YearIncorporated],
		src.[AnnualBudgetTotal],
		src.[LegalStatus],
		src.[SourceOfFunds],
		src.[ExcludeFromWebsite],
		src.[ExcludeFromDirectory],
		src.[DisabilitiesAccess],
		src.[PhysicalLocationDescription],
		src.[BusServiceAccess],
		src.[PublicAccessTransportation],
		src.[PaymentMethods],
		src.[FeeStructureSource],
		src.[ApplicationProcess],
		src.[ResourceInfo],
		src.[DocumentsRequired],
		src.[LanguagesOffered],
		src.[LanguagesOfferedList],
		src.[AvailabilityNumberOfTimes],
		src.[AvailabilityFrequency],
		src.[AvailabilityPeriod],
		src.[ServiceNotAlwaysAvailability],
		src.[CapacityType],
		src.[ServiceCapacity],
		src.[NormalWaitTime],
		src.[TemporaryMessage],
		src.[TemporaryMessageAppears],
		src.[TemporaryMessageExpires],
		src.[EnteredOn],
		src.[UpdatedOn],
		src.[MadeInactiveOn],
		src.[InternalNotes],
		src.[InternalNotesForEditorsAndViewers],
		src.[HighlightedResource],
		src.[LastVerifiedOn],
		src.[LastVerifiedByName],
		src.[LastVerifiedByTitle],
		src.[LastVerifiedByPhoneNumber],
		src.[LastVerifiedByEmailAddress],
		src.[LastVerificationApprovedBy],
		src.[AvailableForDirectory],
		src.[AvailableForReferral],
		src.[AvailableForResearch],
		src.[PreferredProvider],
		src.[ConnectsToSiteNum],
		src.[ConnectsToProgramNum],
		src.[LanguageOfRecord],
		src.[CurrentWorkflowStepCode],
		src.[VolunteerOpportunities],
		src.[VolunteerDuties],
		src.[IsLinkOnly],
		src.[ProgramAgencyNamePublic],
		src.[SiteAgencyNamePublic],
		src.[Categories],
		src.[TaxonomyTerm],
		src.[TaxonomyTerms],
		src.[TaxonomyTermsNotDeactivated],
		src.[TaxonomyCodes],
		src.[Coverage],
		src.[Hours],
		src.[Custom_Public Comments],
		src.[Custom_Former Names],
		src.[Custom_Legal Name],
		src.[Custom_Facebook],
		src.[Custom_Instagram],
		src.[Custom_LinkedIn],
		src.[Custom_Twitter],
		src.[Custom_YouTube],
		src.[Custom_Minimum Age],
		src.[Custom_Maximum Age],
		GETDATE(),
		src.PublicName,
		src.AgencyDescription,
		'AGENCY',
		src.DELETION_DATE,
		CASE WHEN src.[Custom_Deleted Record] = 'yes' THEN GETDATE() ELSE NULL END,
		src.[Custom_Deleted Record],
		src.[MailingCommunity],
		src.[OtherCommunity],
		src.[PhysicalCommunity]	
	)
OPTION (ROBUST PLAN)
	;


MERGE INTO dbo.CIC_iCarolImportRollup dst
USING (
SELECT 
		(SELECT MAX(SYNC_DATE) FROM (VALUES (pas.SYNC_DATE), (p.SYNC_DATE), (s.SYNC_DATE), (a.SYNC_DATE)) AS i(SYNC_DATE)) AS SYNC_DATE,
		COALESCE(pas.[ResourceAgencyNum], p.[ResourceAgencyNum], s.[ResourceAgencyNum], a.[ResourceAgencyNum]) AS [ResourceAgencyNum],
		COALESCE(pas.[LangID], p.[LangID], s.[LangID], a.[LangID]) AS [LangID],
		COALESCE(pas.[PublicName], p.[PublicName], s.[PublicName], a.[PublicName]) AS [PublicName],
		COALESCE(pas.[AlternateName], p.[AlternateName], s.[AlternateName], a.[AlternateName]) AS [AlternateName],
		COALESCE(pas.[OfficialName], p.[OfficialName], s.[OfficialName], a.[OfficialName]) AS [OfficialName],
		COALESCE(pas.[TaxonomyLevelName], p.[TaxonomyLevelName], s.[TaxonomyLevelName], a.[TaxonomyLevelName]) AS [TaxonomyLevelName],
		COALESCE(pas.[ParentAgency], p.[ParentAgency], s.[ParentAgency], a.[ParentAgency]) AS [ParentAgency],
		COALESCE(pas.[ParentAgencyNum], p.[ParentAgencyNum], s.[ParentAgencyNum], a.[ParentAgencyNum]) AS [ParentAgencyNum],
		COALESCE(pas.[Custom_Record Owner (controlled)], p.[Custom_Record Owner (controlled)]) AS [RECORD_OWNER],
		LEFT(COALESCE(pas.[UniqueIDPriorSystem], p.[UniqueIDPriorSystem], s.[UniqueIDPriorSystem], a.[UniqueIDPriorSystem]), 8) AS [UniqueIDPriorSystem],
		CASE WHEN pas.HasMailingAddress=1 THEN pas.[MailingAttentionName] WHEN p.HasMailingAddress=1 THEN p.[MailingAttentionName] WHEN s.HasMailingAddress=1 THEN s.[MailingAttentionName]  WHEN a.HasMailingAddress=1 THEN a.[MailingAttentionName]  ELSE NULL END AS [MailingAttentionName],
		CASE WHEN pas.HasMailingAddress=1 THEN pas.[MailingAddress1] WHEN p.HasMailingAddress=1 THEN p.[MailingAddress1] WHEN s.HasMailingAddress=1 THEN s.[MailingAddress1] WHEN a.HasMailingAddress=1 THEN a.[MailingAddress1] ELSE NULL END AS [MailingAddress1],
		CASE WHEN pas.HasMailingAddress=1 THEN pas.[MailingAddress2] WHEN p.HasMailingAddress=1 THEN p.[MailingAddress2] WHEN s.HasMailingAddress=1 THEN s.[MailingAddress2] WHEN a.HasMailingAddress=1 THEN a.[MailingAddress2] ELSE NULL END AS [MailingAddress2],
		CASE WHEN pas.HasMailingAddress=1 THEN pas.[MailingCity] WHEN p.HasMailingAddress=1 THEN p.[MailingCity] WHEN s.HasMailingAddress=1 THEN s.[MailingCity] WHEN a.HasMailingAddress=1 THEN a.[MailingCity] ELSE NULL END AS [MailingCity],
		CASE WHEN pas.HasMailingAddress=1 THEN pas.[MailingCommunity] WHEN p.HasMailingAddress=1 THEN p.[MailingCommunity] WHEN s.HasMailingAddress=1 THEN s.[MailingCommunity] WHEN a.HasMailingAddress=1 THEN a.[MailingCommunity] ELSE NULL END AS [MailingCommunity],
		CASE WHEN pas.HasMailingAddress=1 THEN pas.[MailingStateProvince] WHEN p.HasMailingAddress=1 THEN p.[MailingStateProvince] WHEN s.HasMailingAddress=1 THEN s.[MailingStateProvince] WHEN a.HasMailingAddress=1 THEN a.[MailingStateProvince] ELSE NULL END AS [MailingStateProvince],
		CASE WHEN pas.HasMailingAddress=1 THEN pas.[MailingPostalCode] WHEN p.HasMailingAddress=1 THEN p.[MailingPostalCode] WHEN s.HasMailingAddress=1 THEN s.[MailingPostalCode] WHEN a.HasMailingAddress=1 THEN a.[MailingPostalCode] ELSE NULL END AS [MailingPostalCode],
		CASE WHEN pas.HasMailingAddress=1 THEN pas.[MailingCountry] WHEN p.HasMailingAddress=1 THEN p.[MailingCountry] WHEN s.HasMailingAddress=1 THEN s.[MailingCountry] WHEN a.HasMailingAddress=1 THEN a.[MailingCountry] ELSE NULL END AS [MailingCountry],
		CASE WHEN pas.HasMailingAddress=1 THEN pas.[MailingAddressIsPrivate] WHEN p.HasMailingAddress=1 THEN p.[MailingAddressIsPrivate] WHEN s.HasMailingAddress=1 THEN s.[MailingAddressIsPrivate] WHEN a.HasMailingAddress=1 THEN a.[MailingAddressIsPrivate] ELSE NULL END AS [MailingAddressIsPrivate],
		CASE WHEN pas.HasPhysicalAddress=1 THEN pas.[PhysicalAddress1] WHEN p.HasPhysicalAddress=1 THEN p.[PhysicalAddress1] WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalAddress1] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalAddress1] ELSE NULL END AS [PhysicalAddress1],
		CASE WHEN pas.HasPhysicalAddress=1 THEN pas.[PhysicalAddress2] WHEN p.HasPhysicalAddress=1 THEN p.[PhysicalAddress2] WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalAddress2] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalAddress2] ELSE NULL END AS [PhysicalAddress2],
		CASE WHEN pas.HasPhysicalAddress=1 THEN pas.[PhysicalCity] WHEN p.HasPhysicalAddress=1 THEN p.[PhysicalCity] WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalCity] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalCity] ELSE NULL END AS [PhysicalCity],
		CASE WHEN pas.HasPhysicalAddress=1 THEN pas.[PhysicalCounty] WHEN p.HasPhysicalAddress=1 THEN p.[PhysicalCounty] WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalCounty] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalCounty] ELSE NULL END AS [PhysicalCounty],
		CASE WHEN pas.HasPhysicalAddress=1 THEN pas.[PhysicalCommunity] WHEN p.HasPhysicalAddress=1 THEN p.[PhysicalCommunity] WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalCommunity] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalCommunity] ELSE NULL END AS [PhysicalCommunity],
		CASE WHEN pas.HasPhysicalAddress=1 THEN pas.[PhysicalStateProvince] WHEN p.HasPhysicalAddress=1 THEN p.[PhysicalStateProvince] WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalStateProvince] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalStateProvince] ELSE NULL END AS [PhysicalStateProvince],
		CASE WHEN pas.HasPhysicalAddress=1 THEN pas.[PhysicalPostalCode] WHEN p.HasPhysicalAddress=1 THEN p.[PhysicalPostalCode] WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalPostalCode] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalPostalCode] ELSE NULL END AS [PhysicalPostalCode],
		CASE WHEN pas.HasPhysicalAddress=1 THEN pas.[PhysicalCountry] WHEN p.HasPhysicalAddress=1 THEN p.[PhysicalCountry] WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalCountry] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalCountry] ELSE NULL END AS [PhysicalCountry],
		CASE WHEN pas.HasPhysicalAddress=1 THEN pas.[PhysicalAddressIsPrivate] WHEN p.HasPhysicalAddress=1 THEN p.[PhysicalAddressIsPrivate] WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalAddressIsPrivate] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalAddressIsPrivate] ELSE NULL END AS [PhysicalAddressIsPrivate],
		COALESCE(pas.[OtherAddress1], p.[OtherAddress1], s.[OtherAddress1], a.[OtherAddress1]) AS [OtherAddress1],
		COALESCE(pas.[OtherAddress2], p.[OtherAddress2], s.[OtherAddress2], a.[OtherAddress2]) AS [OtherAddress2],
		COALESCE(pas.[OtherCity], p.[OtherCity], s.[OtherCity], a.[OtherCity]) AS [OtherCity],
		COALESCE(pas.[OtherCounty], p.[OtherCounty], s.[OtherCounty], a.[OtherCounty]) AS [OtherCounty],
		COALESCE(pas.[OtherCommunity], p.[OtherCommunity], s.[OtherCommunity], a.[OtherCommunity]) AS [OtherCommunity],
		COALESCE(pas.[OtherStateProvince], p.[OtherStateProvince], s.[OtherStateProvince], a.[OtherStateProvince]) AS [OtherStateProvince],
		COALESCE(pas.[OtherPostalCode], p.[OtherPostalCode], s.[OtherPostalCode], a.[OtherPostalCode]) AS [OtherPostalCode],
		COALESCE(NULLIF(pas.[OtherCountry], '-1'), NULLIF(p.[OtherCountry], '-1'), NULLIF(s.[OtherCountry], '-1'), NULLIF(a.[OtherCountry], '-1')) AS [OtherCountry],
		-- TODO Update Lat/Lng with HasPhysical
		COALESCE(NULLIF(pas.[Latitude],'0'), CASE WHEN p.PhysicalAddressIsPrivate = 'Yes' THEN NULL ELSE NULLIF(p.[Latitude],'0') END, CASE WHEN s.PhysicalAddressIsPrivate = 'Yes' THEN NULL ELSE NULLIF(s.[Latitude],'0') END, CASE WHEN a.PhysicalAddressIsPrivate = 'Yes' THEN NULL ELSE NULLIF(a.[Latitude],'0') END) AS [Latitude],
		COALESCE(NULLIF(pas.[Longitude], '0'), CASE WHEN p.PhysicalAddressIsPrivate = 'Yes' THEN NULL ELSE NULLIF(p.[Longitude],'0') END, CASE WHEN s.PhysicalAddressIsPrivate = 'Yes' THEN NULL ELSE NULLIF(s.[Longitude],'0') END, CASE WHEN a.PhysicalAddressIsPrivate = 'Yes' THEN NULL ELSE NULLIF(a.[Longitude],'0') END) AS [Longitude],
		COALESCE(pas.[HoursOfOperation], p.[HoursOfOperation], s.[HoursOfOperation], a.[HoursOfOperation]) AS [HoursOfOperation],
		CASE WHEN pas.HasPhone1=1 THEN pas.[Phone1Number] WHEN p.HasPhone1=1 THEN p.[Phone1Number] WHEN s.HasPhone1=1 THEN s.[Phone1Number] WHEN a.HasPhone1=1 THEN a.[Phone1Number] ELSE NULL END AS [Phone1Number],
		CASE WHEN pas.HasPhone1=1 THEN pas.[Phone1Name] WHEN p.HasPhone1=1 THEN p.[Phone1Name] WHEN s.HasPhone1=1 THEN s.[Phone1Name] WHEN a.HasPhone1=1 THEN a.[Phone1Name] ELSE NULL END AS [Phone1Name],
		CASE WHEN pas.HasPhone1=1 THEN pas.[Phone1Description] WHEN p.HasPhone1=1 THEN p.[Phone1Description] WHEN s.HasPhone1=1 THEN s.[Phone1Description] WHEN a.HasPhone1=1 THEN a.[Phone1Description] ELSE NULL END AS [Phone1Description],
		CASE WHEN pas.HasPhone1=1 THEN pas.[Phone1IsPrivate] WHEN p.HasPhone1=1 THEN p.[Phone1IsPrivate] WHEN s.HasPhone1=1 THEN s.[Phone1IsPrivate] WHEN a.HasPhone1=1 THEN a.[Phone1IsPrivate] ELSE NULL END AS [Phone1IsPrivate],
		CASE WHEN pas.HasPhone1=1 THEN pas.[Phone1Type] WHEN p.HasPhone1=1 THEN p.[Phone1Type] WHEN s.HasPhone1=1 THEN s.[Phone1Type] WHEN a.HasPhone1=1 THEN a.[Phone1Type] ELSE NULL END AS [Phone1Type],
		CASE WHEN pas.HasPhone2=1 THEN pas.[Phone2Number] WHEN p.HasPhone2=1 THEN p.[Phone2Number] WHEN s.HasPhone2=1 THEN s.[Phone2Number] WHEN a.HasPhone2=1 THEN a.[Phone2Number] ELSE NULL END AS [Phone2Number],
		CASE WHEN pas.HasPhone2=1 THEN pas.[Phone2Name] WHEN p.HasPhone2=1 THEN p.[Phone2Name] WHEN s.HasPhone2=1 THEN s.[Phone2Name] WHEN a.HasPhone2=1 THEN a.[Phone2Name] ELSE NULL END AS [Phone2Name],
		CASE WHEN pas.HasPhone2=1 THEN pas.[Phone2Description] WHEN p.HasPhone2=1 THEN p.[Phone2Description] WHEN s.HasPhone2=1 THEN s.[Phone2Description] WHEN a.HasPhone2=1 THEN a.[Phone2Description] ELSE NULL END AS [Phone2Description],
		CASE WHEN pas.HasPhone2=1 THEN pas.[Phone2IsPrivate] WHEN p.HasPhone2=1 THEN p.[Phone2IsPrivate] WHEN s.HasPhone2=1 THEN s.[Phone2IsPrivate] WHEN a.HasPhone2=1 THEN a.[Phone2IsPrivate] ELSE NULL END AS [Phone2IsPrivate],
		CASE WHEN pas.HasPhone2=1 THEN pas.[Phone2Type] WHEN p.HasPhone2=1 THEN p.[Phone2Type] WHEN s.HasPhone2=1 THEN s.[Phone2Type] WHEN a.HasPhone2=1 THEN a.[Phone2Type] ELSE NULL END AS [Phone2Type],
		CASE WHEN pas.HasPhone3=1 THEN pas.[Phone3Number] WHEN p.HasPhone3=1 THEN p.[Phone3Number] WHEN s.HasPhone3=1 THEN s.[Phone3Number] WHEN a.HasPhone3=1 THEN a.[Phone3Number] ELSE NULL END AS [Phone3Number],
		CASE WHEN pas.HasPhone3=1 THEN pas.[Phone3Name] WHEN p.HasPhone3=1 THEN p.[Phone3Name] WHEN s.HasPhone3=1 THEN s.[Phone3Name] WHEN a.HasPhone3=1 THEN a.[Phone3Name] ELSE NULL END AS [Phone3Name],
		CASE WHEN pas.HasPhone3=1 THEN pas.[Phone3Description] WHEN p.HasPhone3=1 THEN p.[Phone3Description] WHEN s.HasPhone3=1 THEN s.[Phone3Description] WHEN a.HasPhone3=1 THEN a.[Phone3Description] ELSE NULL END AS [Phone3Description],
		CASE WHEN pas.HasPhone3=1 THEN pas.[Phone3IsPrivate] WHEN p.HasPhone3=1 THEN p.[Phone3IsPrivate] WHEN s.HasPhone3=1 THEN s.[Phone3IsPrivate] WHEN a.HasPhone3=1 THEN a.[Phone3IsPrivate] ELSE NULL END AS [Phone3IsPrivate],
		CASE WHEN pas.HasPhone3=1 THEN pas.[Phone3Type] WHEN p.HasPhone3=1 THEN p.[Phone3Type] WHEN s.HasPhone3=1 THEN s.[Phone3Type] WHEN a.HasPhone3=1 THEN a.[Phone3Type] ELSE NULL END AS [Phone3Type],
		CASE WHEN pas.HasPhone4=1 THEN pas.[Phone4Number] WHEN p.HasPhone4=1 THEN p.[Phone4Number] WHEN s.HasPhone4=1 THEN s.[Phone4Number] WHEN a.HasPhone4=1 THEN a.[Phone4Number] ELSE NULL END AS [Phone4Number],
		CASE WHEN pas.HasPhone4=1 THEN pas.[Phone4Name] WHEN p.HasPhone4=1 THEN p.[Phone4Name] WHEN s.HasPhone4=1 THEN s.[Phone4Name] WHEN a.HasPhone4=1 THEN a.[Phone4Name] ELSE NULL END AS [Phone4Name],
		CASE WHEN pas.HasPhone4=1 THEN pas.[Phone4Description] WHEN p.HasPhone4=1 THEN p.[Phone4Description] WHEN s.HasPhone4=1 THEN s.[Phone4Description] WHEN a.HasPhone4=1 THEN a.[Phone4Description] ELSE NULL END AS [Phone4Description],
		CASE WHEN pas.HasPhone4=1 THEN pas.[Phone4IsPrivate] WHEN p.HasPhone4=1 THEN p.[Phone4IsPrivate] WHEN s.HasPhone4=1 THEN s.[Phone4IsPrivate] WHEN a.HasPhone4=1 THEN a.[Phone4IsPrivate] ELSE NULL END AS [Phone4IsPrivate],
		CASE WHEN pas.HasPhone4=1 THEN pas.[Phone4Type] WHEN p.HasPhone4=1 THEN p.[Phone4Type] WHEN s.HasPhone4=1 THEN s.[Phone4Type] WHEN a.HasPhone4=1 THEN a.[Phone4Type] ELSE NULL END AS [Phone4Type],
		CASE WHEN pas.HasPhone5=1 THEN pas.[Phone5Number] WHEN p.HasPhone5=1 THEN p.[Phone5Number] WHEN s.HasPhone5=1 THEN s.[Phone5Number] WHEN a.HasPhone5=1 THEN a.[Phone5Number] ELSE NULL END AS [Phone5Number],
		CASE WHEN pas.HasPhone5=1 THEN pas.[Phone5name] WHEN p.HasPhone5=1 THEN p.[Phone5name] WHEN s.HasPhone5=1 THEN s.[Phone5name] WHEN a.HasPhone5=1 THEN a.[Phone5name] ELSE NULL END AS [Phone5name],
		CASE WHEN pas.HasPhone5=1 THEN pas.[Phone5Description] WHEN p.HasPhone5=1 THEN p.[Phone5Description] WHEN s.HasPhone5=1 THEN s.[Phone5Description] WHEN a.HasPhone5=1 THEN a.[Phone5Description] ELSE NULL END AS [Phone5Description],
		CASE WHEN pas.HasPhone5=1 THEN pas.[Phone5IsPrivate] WHEN p.HasPhone5=1 THEN p.[Phone5IsPrivate] WHEN s.HasPhone5=1 THEN s.[Phone5IsPrivate] WHEN a.HasPhone5=1 THEN a.[Phone5IsPrivate] ELSE NULL END AS [Phone5IsPrivate],
		CASE WHEN pas.HasPhone5=1 THEN pas.[Phone5Type] WHEN p.HasPhone5=1 THEN p.[Phone5Type] WHEN s.HasPhone5=1 THEN s.[Phone5Type] WHEN a.HasPhone5=1 THEN a.[Phone5Type] ELSE NULL END AS [Phone5Type],
		CASE WHEN pas.HasPhoneFax=1 THEN pas.[PhoneFax] WHEN p.HasPhoneFax=1 THEN p.[PhoneFax] WHEN s.HasPhoneFax=1 THEN s.[PhoneFax] WHEN a.HasPhoneFax=1 THEN a.[PhoneFax] ELSE NULL END AS [PhoneFax],
		CASE WHEN pas.HasPhoneFax=1 THEN pas.[PhoneFaxDescription] WHEN p.HasPhoneFax=1 THEN p.[PhoneFaxDescription] WHEN s.HasPhoneFax=1 THEN s.[PhoneFaxDescription] WHEN a.HasPhoneFax=1 THEN a.[PhoneFaxDescription] ELSE NULL END AS [PhoneFaxDescription],
		CASE WHEN pas.HasPhoneFax=1 THEN pas.[PhoneFaxIsPrivate] WHEN p.HasPhoneFax=1 THEN p.[PhoneFaxIsPrivate] WHEN s.HasPhoneFax=1 THEN s.[PhoneFaxIsPrivate] WHEN a.HasPhoneFax=1 THEN a.[PhoneFaxIsPrivate] ELSE NULL END AS [PhoneFaxIsPrivate],
		CASE WHEN pas.HasPhoneTTY=1 THEN pas.[PhoneTTY] WHEN p.HasPhoneTTY=1 THEN p.[PhoneTTY] WHEN s.HasPhoneTTY=1 THEN s.[PhoneTTY] WHEN a.HasPhoneTTY=1 THEN a.[PhoneTTY] ELSE NULL END AS [PhoneTTY],
		CASE WHEN pas.HasPhoneTTY=1 THEN pas.[PhoneTTYDescription] WHEN p.HasPhoneTTY=1 THEN p.[PhoneTTYDescription] WHEN s.HasPhoneTTY=1 THEN s.[PhoneTTYDescription] WHEN a.HasPhoneTTY=1 THEN a.[PhoneTTYDescription] ELSE NULL END AS [PhoneTTYDescription],
		CASE WHEN pas.HasPhoneTTY=1 THEN pas.[PhoneTTYIsPrivate] WHEN p.HasPhoneTTY=1 THEN p.[PhoneTTYIsPrivate] WHEN s.HasPhoneTTY=1 THEN s.[PhoneTTYIsPrivate] WHEN a.HasPhoneTTY=1 THEN a.[PhoneTTYIsPrivate] ELSE NULL END AS [PhoneTTYIsPrivate],
		CASE WHEN pas.HasPhoneTollFree=1 THEN pas.[PhoneTollFree] WHEN p.HasPhoneTollFree=1 THEN p.[PhoneTollFree] WHEN s.HasPhoneTollFree=1 THEN s.[PhoneTollFree] WHEN a.HasPhoneTollFree=1 THEN a.[PhoneTollFree] ELSE NULL END AS [PhoneTollFree],
		CASE WHEN pas.HasPhoneTollFree=1 THEN pas.[PhoneTollFreeDescription] WHEN p.HasPhoneTollFree=1 THEN p.[PhoneTollFreeDescription] WHEN s.HasPhoneTollFree=1 THEN s.[PhoneTollFreeDescription] WHEN a.HasPhoneTollFree=1 THEN a.[PhoneTollFreeDescription] ELSE NULL END AS [PhoneTollFreeDescription],
		CASE WHEN pas.HasPhoneTollFree=1 THEN pas.[PhoneTollFreeIsPrivate] WHEN p.HasPhoneTollFree=1 THEN p.[PhoneTollFreeIsPrivate] WHEN s.HasPhoneTollFree=1 THEN s.[PhoneTollFreeIsPrivate] WHEN a.HasPhoneTollFree=1 THEN a.[PhoneTollFreeIsPrivate] ELSE NULL END AS [PhoneTollFreeIsPrivate],
		CASE WHEN pas.HasPhoneNumberHotline=1 THEN pas.[PhoneNumberHotline] WHEN p.HasPhoneNumberHotline=1 THEN p.[PhoneNumberHotline] WHEN s.HasPhoneNumberHotline=1 THEN s.[PhoneNumberHotline] WHEN a.HasPhoneNumberHotline=1 THEN a.[PhoneNumberHotline] ELSE NULL END AS [PhoneNumberHotline],
		CASE WHEN pas.HasPhoneNumberHotline=1 THEN pas.[PhoneNumberHotlineDescription] WHEN p.HasPhoneNumberHotline=1 THEN p.[PhoneNumberHotlineDescription] WHEN s.HasPhoneNumberHotline=1 THEN s.[PhoneNumberHotlineDescription] WHEN a.HasPhoneNumberHotline=1 THEN a.[PhoneNumberHotlineDescription] ELSE NULL END AS [PhoneNumberHotlineDescription],
		CASE WHEN pas.HasPhoneNumberHotline=1 THEN pas.[PhoneNumberHotlineIsPrivate] WHEN p.HasPhoneNumberHotline=1 THEN p.[PhoneNumberHotlineIsPrivate] WHEN s.HasPhoneNumberHotline=1 THEN s.[PhoneNumberHotlineIsPrivate] WHEN a.HasPhoneNumberHotline=1 THEN a.[PhoneNumberHotlineIsPrivate] ELSE NULL END AS [PhoneNumberHotlineIsPrivate],
		CASE WHEN pas.HasPhoneNumberBusinessLine=1 THEN pas.[PhoneNumberBusinessLine] WHEN p.HasPhoneNumberBusinessLine=1 THEN p.[PhoneNumberBusinessLine] WHEN s.HasPhoneNumberBusinessLine=1 THEN s.[PhoneNumberBusinessLine] WHEN a.HasPhoneNumberBusinessLine=1 THEN a.[PhoneNumberBusinessLine] ELSE NULL END AS [PhoneNumberBusinessLine],
		CASE WHEN pas.HasPhoneNumberBusinessLine=1 THEN pas.[PhoneNumberBusinessLineDescription] WHEN p.HasPhoneNumberBusinessLine=1 THEN p.[PhoneNumberBusinessLineDescription] WHEN s.HasPhoneNumberBusinessLine=1 THEN s.[PhoneNumberBusinessLineDescription] WHEN a.HasPhoneNumberBusinessLine=1 THEN a.[PhoneNumberBusinessLineDescription] ELSE NULL END AS [PhoneNumberBusinessLineDescription],
		CASE WHEN pas.HasPhoneNumberBusinessLine=1 THEN pas.[PhoneNumberBusinessLineIsPrivate] WHEN p.HasPhoneNumberBusinessLine=1 THEN p.[PhoneNumberBusinessLineIsPrivate] WHEN s.HasPhoneNumberBusinessLine=1 THEN s.[PhoneNumberBusinessLineIsPrivate] WHEN a.HasPhoneNumberBusinessLine=1 THEN a.[PhoneNumberBusinessLineIsPrivate] ELSE NULL END AS [PhoneNumberBusinessLineIsPrivate],
		CASE WHEN pas.HasPhoneNumberOutOfArea=1 THEN pas.[PhoneNumberOutOfArea] WHEN p.HasPhoneNumberOutOfArea=1 THEN p.[PhoneNumberOutOfArea] WHEN s.HasPhoneNumberOutOfArea=1 THEN s.[PhoneNumberOutOfArea] WHEN a.HasPhoneNumberOutOfArea=1 THEN a.[PhoneNumberOutOfArea] ELSE NULL END AS [PhoneNumberOutOfArea],
		CASE WHEN pas.HasPhoneNumberOutOfArea=1 THEN pas.[PhoneNumberOutOfAreaDescription] WHEN p.HasPhoneNumberOutOfArea=1 THEN p.[PhoneNumberOutOfAreaDescription] WHEN s.HasPhoneNumberOutOfArea=1 THEN s.[PhoneNumberOutOfAreaDescription] WHEN a.HasPhoneNumberOutOfArea=1 THEN a.[PhoneNumberOutOfAreaDescription] ELSE NULL END AS [PhoneNumberOutOfAreaDescription],
		CASE WHEN pas.HasPhoneNumberOutOfArea=1 THEN pas.[PhoneNumberOutOfAreaIsPrivate] WHEN p.HasPhoneNumberOutOfArea=1 THEN p.[PhoneNumberOutOfAreaIsPrivate] WHEN s.HasPhoneNumberOutOfArea=1 THEN s.[PhoneNumberOutOfAreaIsPrivate] WHEN a.HasPhoneNumberOutOfArea=1 THEN a.[PhoneNumberOutOfAreaIsPrivate] ELSE NULL END AS [PhoneNumberOutOfAreaIsPrivate],
		CASE WHEN pas.HasPhoneNumberAfterHours=1 THEN pas.[PhoneNumberAfterHours] WHEN p.HasPhoneNumberAfterHours=1 THEN p.[PhoneNumberAfterHours] WHEN s.HasPhoneNumberAfterHours=1 THEN s.[PhoneNumberAfterHours] WHEN a.HasPhoneNumberAfterHours=1 THEN a.[PhoneNumberAfterHours] ELSE NULL END AS [PhoneNumberAfterHours],
		CASE WHEN pas.HasPhoneNumberAfterHours=1 THEN pas.[PhoneNumberAfterHoursDescription] WHEN p.HasPhoneNumberAfterHours=1 THEN p.[PhoneNumberAfterHoursDescription] WHEN s.HasPhoneNumberAfterHours=1 THEN s.[PhoneNumberAfterHoursDescription] WHEN a.HasPhoneNumberAfterHours=1 THEN a.[PhoneNumberAfterHoursDescription] ELSE NULL END AS [PhoneNumberAfterHoursDescription],
		CASE WHEN pas.HasPhoneNumberAfterHours=1 THEN pas.[PhoneNumberAfterHoursIsPrivate] WHEN p.HasPhoneNumberAfterHours=1 THEN p.[PhoneNumberAfterHoursIsPrivate] WHEN s.HasPhoneNumberAfterHours=1 THEN s.[PhoneNumberAfterHoursIsPrivate] WHEN a.HasPhoneNumberAfterHours=1 THEN a.[PhoneNumberAfterHoursIsPrivate] ELSE NULL END AS [PhoneNumberAfterHoursIsPrivate],
		COALESCE(pas.[EmailAddressMain], p.[EmailAddressMain], s.[EmailAddressMain], a.[EmailAddressMain]) AS [EmailAddressMain],
		COALESCE(pas.[WebsiteAddress], p.[WebsiteAddress], s.[WebsiteAddress], a.[WebsiteAddress]) AS [WebsiteAddress],
		COALESCE(pas.[AgencyStatus], p.[AgencyStatus], s.[AgencyStatus], a.[AgencyStatus]) AS [AgencyStatus],
		COALESCE(pas.[AgencyClassification], p.[AgencyClassification], s.[AgencyClassification], a.[AgencyClassification]) AS [AgencyClassification],
		COALESCE(pas.[CoverageArea], p.[CoverageArea], s.[CoverageArea], a.[CoverageArea]) AS [CoverageArea],
		COALESCE(pas.[CoverageAreaText], p.[CoverageAreaText], s.[CoverageAreaText], a.[CoverageAreaText]) AS [CoverageAreaText],
		COALESCE(pas.[Eligibility], p.[Eligibility], s.[Eligibility], a.[Eligibility]) AS [Eligibility],
		COALESCE(pas.[EligibilityAdult], p.[EligibilityAdult], s.[EligibilityAdult], a.[EligibilityAdult]) AS [EligibilityAdult],
		COALESCE(pas.[EligibilityChild], p.[EligibilityChild], s.[EligibilityChild], a.[EligibilityChild]) AS [EligibilityChild],
		COALESCE(pas.[EligibilityFamily], p.[EligibilityFamily], s.[EligibilityFamily], a.[EligibilityFamily]) AS [EligibilityFamily],
		COALESCE(pas.[EligibilityFemale], p.[EligibilityFemale], s.[EligibilityFemale], a.[EligibilityFemale]) AS [EligibilityFemale],
		COALESCE(pas.[EligibilityMale], p.[EligibilityMale], s.[EligibilityMale], a.[EligibilityMale]) AS [EligibilityMale],
		COALESCE(pas.[EligibilityTeen], p.[EligibilityTeen], s.[EligibilityTeen], a.[EligibilityTeen]) AS [EligibilityTeen],
		CASE WHEN pas.HasSeniorWorker=1 THEN pas.[SeniorWorkerName] ELSE p.[SeniorWorkerName] END AS [SeniorWorkerName],
		CASE WHEN pas.HasSeniorWorker=1 THEN pas.[SeniorWorkerTitle] ELSE p.[SeniorWorkerTitle] END AS [SeniorWorkerTitle],
		CASE WHEN pas.HasSeniorWorker=1 THEN pas.[SeniorWorkerEmailAddress] ELSE p.[SeniorWorkerEmailAddress] END AS [SeniorWorkerEmailAddress],
		CASE WHEN pas.HasSeniorWorker=1 THEN pas.[SeniorWorkerPhoneNumber] ELSE p.[SeniorWorkerPhoneNumber] END AS [SeniorWorkerPhoneNumber],
		CASE WHEN pas.HasSeniorWorker=1 THEN pas.[SeniorWorkerIsPrivate] ELSE p.[SeniorWorkerIsPrivate] END AS [SeniorWorkerIsPrivate],
		CASE WHEN pas.HasMainContact=1 THEN pas.[MainContactName] ELSE p.[MainContactName] END AS [MainContactName], 
        CASE WHEN pas.HasMainContact=1 THEN pas.[MainContactTitle] ELSE p.[MainContactTitle] END AS [MainContactTitle],
		CASE WHEN pas.HasMainContact=1 THEN pas.[MainContactEmailAddress] ELSE p.[MainContactEmailAddress] END AS [MainContactEmailAddress],
		CASE WHEN pas.HasMainContact=1 THEN pas.[MainContactPhoneNumber] ELSE p.[MainContactPhoneNumber] END AS [MainContactPhoneNumber],
		CASE WHEN pas.HasMainContact=1 THEN pas.[MainContactType] ELSE p.[MainContactType] END AS [MainContactType],
		CASE WHEN pas.HasMainContact=1 THEN pas.[MainContactIsPrivate] ELSE p.[MainContactIsPrivate] END AS [MainContactIsPrivate],
		COALESCE(pas.[LicenseAccreditation], p.[LicenseAccreditation], s.[LicenseAccreditation], a.[LicenseAccreditation]) AS [LicenseAccreditation],
		COALESCE(pas.[YearIncorporated], p.[YearIncorporated], s.[YearIncorporated], a.[YearIncorporated]) AS [YearIncorporated],
		COALESCE(pas.[AnnualBudgetTotal], p.[AnnualBudgetTotal], s.[AnnualBudgetTotal], a.[AnnualBudgetTotal]) AS [AnnualBudgetTotal],
		COALESCE(pas.[LegalStatus], p.[LegalStatus], s.[LegalStatus], a.[LegalStatus]) AS [LegalStatus],
		COALESCE(pas.[SourceOfFunds], p.[SourceOfFunds], s.[SourceOfFunds], a.[SourceOfFunds]) AS [SourceOfFunds],
		COALESCE(pas.[ExcludeFromWebsite], p.[ExcludeFromWebsite], s.[ExcludeFromWebsite], a.[ExcludeFromWebsite]) AS [ExcludeFromWebsite],
		COALESCE(pas.[ExcludeFromDirectory], p.[ExcludeFromDirectory], s.[ExcludeFromDirectory], a.[ExcludeFromDirectory]) AS [ExcludeFromDirectory],
		COALESCE(pas.[DisabilitiesAccess], p.[DisabilitiesAccess], s.[DisabilitiesAccess], a.[DisabilitiesAccess]) AS [DisabilitiesAccess],
		COALESCE(pas.[PhysicalLocationDescription], p.[PhysicalLocationDescription], s.[PhysicalLocationDescription], a.[PhysicalLocationDescription]) AS [PhysicalLocationDescription],
		COALESCE(pas.[BusServiceAccess], p.[BusServiceAccess], s.[BusServiceAccess], a.[BusServiceAccess]) AS [BusServiceAccess],
		COALESCE(pas.[PublicAccessTransportation], p.[PublicAccessTransportation], s.[PublicAccessTransportation], a.[PublicAccessTransportation]) AS [PublicAccessTransportation],
		COALESCE(pas.[PaymentMethods], p.[PaymentMethods], s.[PaymentMethods], a.[PaymentMethods]) AS [PaymentMethods],
		COALESCE(pas.[FeeStructureSource], p.[FeeStructureSource], s.[FeeStructureSource], a.[FeeStructureSource]) AS [FeeStructureSource],
		COALESCE(pas.[ApplicationProcess], p.[ApplicationProcess], s.[ApplicationProcess], a.[ApplicationProcess]) AS [ApplicationProcess],
		COALESCE(pas.[ResourceInfo], p.[ResourceInfo], s.[ResourceInfo], a.[ResourceInfo]) AS [ResourceInfo],
		COALESCE(pas.[DocumentsRequired], p.[DocumentsRequired], s.[DocumentsRequired], a.[DocumentsRequired]) AS [DocumentsRequired],
		COALESCE(pas.[LanguagesOffered], p.[LanguagesOffered], s.[LanguagesOffered], a.[LanguagesOffered]) AS [LanguagesOffered],
		COALESCE(pas.[LanguagesOfferedList], p.[LanguagesOfferedList], s.[LanguagesOfferedList], a.[LanguagesOfferedList]) AS [LanguagesOfferedList],
		COALESCE(pas.[AvailabilityNumberOfTimes], p.[AvailabilityNumberOfTimes], s.[AvailabilityNumberOfTimes], a.[AvailabilityNumberOfTimes]) AS [AvailabilityNumberOfTimes],
		COALESCE(pas.[AvailabilityFrequency], p.[AvailabilityFrequency], s.[AvailabilityFrequency], a.[AvailabilityFrequency]) AS [AvailabilityFrequency],
		COALESCE(pas.[AvailabilityPeriod], p.[AvailabilityPeriod], s.[AvailabilityPeriod], a.[AvailabilityPeriod]) AS [AvailabilityPeriod],
		COALESCE(pas.[ServiceNotAlwaysAvailability], p.[ServiceNotAlwaysAvailability], s.[ServiceNotAlwaysAvailability], a.[ServiceNotAlwaysAvailability]) AS [ServiceNotAlwaysAvailability],
		COALESCE(pas.[CapacityType], p.[CapacityType], s.[CapacityType], a.[CapacityType]) AS [CapacityType],
		COALESCE(pas.[ServiceCapacity], p.[ServiceCapacity], s.[ServiceCapacity], a.[ServiceCapacity]) AS [ServiceCapacity],
		COALESCE(pas.[NormalWaitTime], p.[NormalWaitTime], s.[NormalWaitTime], a.[NormalWaitTime]) AS [NormalWaitTime],
		COALESCE(pas.[TemporaryMessage], p.[TemporaryMessage], s.[TemporaryMessage], a.[TemporaryMessage]) AS [TemporaryMessage],
		COALESCE(pas.[TemporaryMessageAppears], p.[TemporaryMessageAppears], s.[TemporaryMessageAppears], a.[TemporaryMessageAppears]) AS [TemporaryMessageAppears],
		COALESCE(pas.[TemporaryMessageExpires], p.[TemporaryMessageExpires], s.[TemporaryMessageExpires], a.[TemporaryMessageExpires]) AS [TemporaryMessageExpires],
		COALESCE(pas.[EnteredOn], p.[EnteredOn], s.[EnteredOn], a.[EnteredOn]) AS [EnteredOn],
		COALESCE(pas.[UpdatedOn], p.[UpdatedOn], s.[UpdatedOn], a.[UpdatedOn]) AS [UpdatedOn],
		COALESCE(pas.[MadeInactiveOn], p.[MadeInactiveOn], s.[MadeInactiveOn], a.[MadeInactiveOn]) AS [MadeInactiveOn],
		COALESCE(pas.[InternalNotes], p.[InternalNotes]) AS [InternalNotes],
		COALESCE(pas.[InternalNotesForEditorsAndViewers], p.[InternalNotesForEditorsAndViewers]) AS [InternalNotesForEditorsAndViewers],
		COALESCE(pas.[HighlightedResource], p.[HighlightedResource], s.[HighlightedResource], a.[HighlightedResource]) AS [HighlightedResource],
		COALESCE(pas.[LastVerifiedOn], p.[LastVerifiedOn]) AS [LastVerifiedOn],
		COALESCE(pas.[LastVerifiedByName], p.[LastVerifiedByName]) AS [LastVerifiedByName],
		COALESCE(pas.[LastVerifiedByTitle], p.[LastVerifiedByTitle]) AS [LastVerifiedByTitle],
		COALESCE(pas.[LastVerifiedByPhoneNumber], p.[LastVerifiedByPhoneNumber]) AS [LastVerifiedByPhoneNumber],
		COALESCE(pas.[LastVerifiedByEmailAddress], p.[LastVerifiedByEmailAddress]) AS [LastVerifiedByEmailAddress],
		COALESCE(pas.[LastVerificationApprovedBy], p.[LastVerificationApprovedBy]) AS [LastVerificationApprovedBy],
		COALESCE(pas.[AvailableForDirectory], p.[AvailableForDirectory], s.[AvailableForDirectory], a.[AvailableForDirectory]) AS [AvailableForDirectory],
		COALESCE(pas.[AvailableForReferral], p.[AvailableForReferral], s.[AvailableForReferral], a.[AvailableForReferral]) AS [AvailableForReferral],
		COALESCE(pas.[AvailableForResearch], p.[AvailableForResearch], s.[AvailableForResearch], a.[AvailableForResearch]) AS [AvailableForResearch],
		COALESCE(pas.[PreferredProvider], p.[PreferredProvider], s.[PreferredProvider], a.[PreferredProvider]) AS [PreferredProvider],
		COALESCE(pas.[ConnectsToSiteNum], p.[ConnectsToSiteNum], s.[ConnectsToSiteNum], a.[ConnectsToSiteNum]) AS [ConnectsToSiteNum],
		COALESCE(pas.[ConnectsToProgramNum], p.[ConnectsToProgramNum], s.[ConnectsToProgramNum], a.[ConnectsToProgramNum]) AS [ConnectsToProgramNum],
		COALESCE(pas.[LanguageOfRecord], p.[LanguageOfRecord], s.[LanguageOfRecord], a.[LanguageOfRecord]) AS [LanguageOfRecord],
		COALESCE(pas.[CurrentWorkflowStepCode], p.[CurrentWorkflowStepCode], s.[CurrentWorkflowStepCode], a.[CurrentWorkflowStepCode]) AS [CurrentWorkflowStepCode],
		COALESCE(pas.[VolunteerOpportunities], p.[VolunteerOpportunities], s.[VolunteerOpportunities], a.[VolunteerOpportunities]) AS [VolunteerOpportunities],
		COALESCE(pas.[VolunteerDuties], p.[VolunteerDuties], s.[VolunteerDuties], a.[VolunteerDuties]) AS [VolunteerDuties],
		COALESCE(pas.[IsLinkOnly], p.[IsLinkOnly], s.[IsLinkOnly], a.[IsLinkOnly]) AS [IsLinkOnly],
		COALESCE(pas.[ProgramAgencyNamePublic], p.[ProgramAgencyNamePublic], s.[ProgramAgencyNamePublic], a.[ProgramAgencyNamePublic]) AS [ProgramAgencyNamePublic],
		COALESCE(pas.[SiteAgencyNamePublic], p.[SiteAgencyNamePublic], s.[SiteAgencyNamePublic], a.[SiteAgencyNamePublic]) AS [SiteAgencyNamePublic],
		COALESCE(pas.[Categories], p.[Categories], s.[Categories], a.[Categories]) AS [Categories],
		COALESCE(pas.[TaxonomyTerm], p.[TaxonomyTerm], s.[TaxonomyTerm], a.[TaxonomyTerm]) AS [TaxonomyTerm],
		COALESCE(pas.[TaxonomyTerms], p.[TaxonomyTerms], s.[TaxonomyTerms], a.[TaxonomyTerms]) AS [TaxonomyTerms],
		COALESCE(pas.[TaxonomyTermsNotDeactivated], p.[TaxonomyTermsNotDeactivated], s.[TaxonomyTermsNotDeactivated], a.[TaxonomyTermsNotDeactivated]) AS [TaxonomyTermsNotDeactivated],
		COALESCE(pas.[TaxonomyCodes], p.[TaxonomyCodes], s.[TaxonomyCodes], a.[TaxonomyCodes]) AS [TaxonomyCodes],
		COALESCE(pas.[Coverage], p.[Coverage], s.[Coverage], a.[Coverage]) AS [Coverage],
		COALESCE(pas.[Hours], p.[Hours], s.[Hours], a.[Hours]) AS [Hours],
		COALESCE(pas.[Custom_Public Comments], p.[Custom_Public Comments]) AS [Custom_Public Comments],
		COALESCE(pas.[Custom_Former Names], p.[Custom_Former Names], s.[Custom_Former Names], a.[Custom_Former Names]) AS [Custom_Former Names],
		COALESCE(pas.[Custom_Legal Name], p.[Custom_Legal Name], s.[Custom_Legal Name], a.[Custom_Legal Name]) AS [Custom_Legal Name],
		COALESCE(pas.[Custom_Facebook], p.[Custom_Facebook], s.[Custom_Facebook], a.[Custom_Facebook]) AS [Custom_Facebook],
		COALESCE(pas.[Custom_Instagram], p.[Custom_Instagram], s.[Custom_Instagram], a.[Custom_Instagram]) AS [Custom_Instagram],
		COALESCE(pas.[Custom_LinkedIn], p.[Custom_LinkedIn], s.[Custom_LinkedIn], a.[Custom_LinkedIn]) AS [Custom_LinkedIn],
		COALESCE(pas.[Custom_Twitter], p.[Custom_Twitter], s.[Custom_Twitter], a.[Custom_Twitter]) AS [Custom_Twitter],
		COALESCE(pas.[Custom_YouTube], p.[Custom_YouTube], s.[Custom_YouTube], a.[Custom_YouTube]) AS [Custom_YouTube],
		COALESCE(pas.[Custom_Minimum Age], p.[Custom_Minimum Age], s.[Custom_Minimum Age], a.[Custom_Minimum Age]) AS [Custom_Minimum Age],
		COALESCE(pas.[Custom_Maximum Age], p.[Custom_Maximum Age], s.[Custom_Maximum Age], a.[Custom_Maximum Age]) AS [Custom_Maximum Age],
		a.PublicName AS ORG_LEVEL_1,
		NULL AS ORG_DESCRIPTION,
		s.PublicName AS LOCATION_NAME,
		s.AgencyDescription AS LOCATION_DESCRIPTION,
		COALESCE(p.PublicName, pas.PublicName) AS SERVICE_NAME_LEVEL_1,
		s.PublicName AS SERVICE_NAME_LEVEL_2,
		COALESCE(pas.AgencyDescription, p.AgencyDescription) AS DESCRIPTION,
		pas.DELETION_DATE,
		CASE WHEN p.ResourceAgencyNum IS NULL OR s.ResourceAgencyNum IS NULL OR a.ResourceAgencyNum IS NULL OR 'yes' IN (pas.[Custom_Deleted Record], p.[Custom_Deleted Record], s.[Custom_Deleted Record], a.[Custom_Deleted Record]) THEN 'yes' ELSE 'no' END AS [Custom_Deleted Record]
	FROM dbo.CIC_iCarolImport pas
	LEFT JOIN dbo.CIC_iCarolImport p
		ON p.ResourceAgencyNum=pas.ConnectsToProgramNum AND p.TaxonomyLevelName='Program' AND p.LangID=pas.LangID
	LEFT JOIN dbo.CIC_iCarolImport s
		ON s.ResourceAgencyNum=pas.ConnectsToSiteNum AND s.TaxonomyLevelName='Site' AND s.langid=pas.LangID
	LEFT JOIN dbo.CIC_iCarolImport a
		ON pas.ParentAgencyNum=a.ResourceAgencyNum AND a.TaxonomyLevelName='Agency' AND a.LangID=pas.LangID
	WHERE pas.TaxonomyLevelName='ProgramAtSite'
) AS src
ON src.ResourceAgencyNum=dst.ResourceAgencyNum AND src.LangID=dst.LangID AND src.TaxonomyLevelName = 'ProgramAtSite'
WHEN MATCHED AND src.SYNC_DATE > dst.DATE_MODIFIED THEN 
	UPDATE SET 
		[PublicName]=src.[PublicName],
		[AlternateName]=src.[AlternateName],
		[OfficialName]=src.[OfficialName],
		[TaxonomyLevelName]=src.[TaxonomyLevelName],
		[ParentAgency]=src.[ParentAgency],
		[ParentAgencyNum]=src.[ParentAgencyNum],
		[RECORD_OWNER]=LEFT(src.[RECORD_OWNER], 3),
		[UniqueIDPriorSystem]=src.[UniqueIDPriorSystem],
		[MailingAttentionName]=src.[MailingAttentionName],
		[MailingAddress1]=src.[MailingAddress1],
		[MailingAddress2]=src.[MailingAddress2],
		[MailingCity]=src.[MailingCity],
		[MailingCommunity]=src.[MailingCommunity],
		[MailingStateProvince]=src.[MailingStateProvince],
		[MailingPostalCode]=src.[MailingPostalCode],
		[MailingCountry]=src.[MailingCountry],
		[MailingAddressIsPrivate]=src.[MailingAddressIsPrivate],
		[PhysicalAddress1]=src.[PhysicalAddress1],
		[PhysicalAddress2]=src.[PhysicalAddress2],
		[PhysicalCity]=src.[PhysicalCity],
		[PhysicalCounty]=src.[PhysicalCounty],
		[PhysicalCommunity]=src.[PhysicalCommunity],
		[PhysicalStateProvince]=src.[PhysicalStateProvince],
		[PhysicalPostalCode]=src.[PhysicalPostalCode],
		[PhysicalCountry]=src.[PhysicalCountry],
		[PhysicalAddressIsPrivate]=src.[PhysicalAddressIsPrivate],
		[OtherAddress1]=src.[OtherAddress1],
		[OtherAddress2]=src.[OtherAddress2],
		[OtherCity]=src.[OtherCity],
		[OtherCounty]=src.[OtherCounty],
		[OtherCommunity]=src.[OtherCommunity],
		[OtherStateProvince]=src.[OtherStateProvince],
		[OtherPostalCode]=src.[OtherPostalCode],
		[OtherCountry]=src.[OtherCountry],
		[Latitude]=src.[Latitude],
		[Longitude]=src.[Longitude],
		[HoursOfOperation]=src.[HoursOfOperation],
		[Phone1Number]=src.[Phone1Number],
		[Phone1Name]=src.[Phone1Name],
		[Phone1Description]=src.[Phone1Description],
		[Phone1IsPrivate]=src.[Phone1IsPrivate],
		[Phone1Type]=src.[Phone1Type],
		[Phone2Number]=src.[Phone2Number],
		[Phone2Name]=src.[Phone2Name],
		[Phone2Description]=src.[Phone2Description],
		[Phone2IsPrivate]=src.[Phone2IsPrivate],
		[Phone2Type]=src.[Phone2Type],
		[Phone3Number]=src.[Phone3Number],
		[Phone3Name]=src.[Phone3Name],
		[Phone3Description]=src.[Phone3Description],
		[Phone3IsPrivate]=src.[Phone3IsPrivate],
		[Phone3Type]=src.[Phone3Type],
		[Phone4Number]=src.[Phone4Number],
		[Phone4Name]=src.[Phone4Name],
		[Phone4Description]=src.[Phone4Description],
		[Phone4IsPrivate]=src.[Phone4IsPrivate],
		[Phone4Type]=src.[Phone4Type],
		[Phone5Number]=src.[Phone5Number],
		[Phone5name]=src.[Phone5name],
		[Phone5Description]=src.[Phone5Description],
		[Phone5IsPrivate]=src.[Phone5IsPrivate],
		[Phone5Type]=src.[Phone5Type],
		[PhoneFax]=src.[PhoneFax],
		[PhoneFaxDescription]=src.[PhoneFaxDescription],
		[PhoneFaxIsPrivate]=src.[PhoneFaxIsPrivate],
		[PhoneTTY]=src.[PhoneTTY],
		[PhoneTTYDescription]=src.[PhoneTTYDescription],
		[PhoneTTYIsPrivate]=src.[PhoneTTYIsPrivate],
		[PhoneTollFree]=src.[PhoneTollFree],
		[PhoneTollFreeDescription]=src.[PhoneTollFreeDescription],
		[PhoneTollFreeIsPrivate]=src.[PhoneTollFreeIsPrivate],
		[PhoneNumberHotline]=src.[PhoneNumberHotline],
		[PhoneNumberHotlineDescription]=src.[PhoneNumberHotlineDescription],
		[PhoneNumberHotlineIsPrivate]=src.[PhoneNumberHotlineIsPrivate],
		[PhoneNumberBusinessLine]=src.[PhoneNumberBusinessLine],
		[PhoneNumberBusinessLineDescription]=src.[PhoneNumberBusinessLineDescription],
		[PhoneNumberBusinessLineIsPrivate]=src.[PhoneNumberBusinessLineIsPrivate],
		[PhoneNumberOutOfArea]=src.[PhoneNumberOutOfArea],
		[PhoneNumberOutOfAreaDescription]=src.[PhoneNumberOutOfAreaDescription],
		[PhoneNumberOutOfAreaIsPrivate]=src.[PhoneNumberOutOfAreaIsPrivate],
		[PhoneNumberAfterHours]=src.[PhoneNumberAfterHours],
		[PhoneNumberAfterHoursDescription]=src.[PhoneNumberAfterHoursDescription],
		[PhoneNumberAfterHoursIsPrivate]=src.[PhoneNumberAfterHoursIsPrivate],
		[EmailAddressMain]=src.[EmailAddressMain],
		[WebsiteAddress]=src.[WebsiteAddress],
		[AgencyStatus]=src.[AgencyStatus],
		[AgencyClassification]=src.[AgencyClassification],
		[CoverageArea]=src.[CoverageArea],
		[CoverageAreaText]=src.[CoverageAreaText],
		[Eligibility]=src.[Eligibility],
		[EligibilityAdult]=src.[EligibilityAdult],
		[EligibilityChild]=src.[EligibilityChild],
		[EligibilityFamily]=src.[EligibilityFamily],
		[EligibilityFemale]=src.[EligibilityFemale],
		[EligibilityMale]=src.[EligibilityMale],
		[EligibilityTeen]=src.[EligibilityTeen],
		[SeniorWorkerName]=src.[SeniorWorkerName],
		[SeniorWorkerTitle]=src.[SeniorWorkerTitle],
		[SeniorWorkerEmailAddress]=src.[SeniorWorkerEmailAddress],
		[SeniorWorkerPhoneNumber]=src.[SeniorWorkerPhoneNumber],
		[SeniorWorkerIsPrivate]=src.[SeniorWorkerIsPrivate],
		[MainContactName]=src.[MainContactName],
		[MainContactTitle]=src.[MainContactTitle],
		[MainContactEmailAddress]=src.[MainContactEmailAddress],
		[MainContactPhoneNumber]=src.[MainContactPhoneNumber],
		[MainContactType]=src.[MainContactType],
		[MainContactIsPrivate]=src.[MainContactIsPrivate],
		[LicenseAccreditation]=src.[LicenseAccreditation],
		[YearIncorporated]=src.[YearIncorporated],
		[AnnualBudgetTotal]=src.[AnnualBudgetTotal],
		[LegalStatus]=src.[LegalStatus],
		[SourceOfFunds]=src.[SourceOfFunds],
		[ExcludeFromWebsite]=src.[ExcludeFromWebsite],
		[ExcludeFromDirectory]=src.[ExcludeFromDirectory],
		[DisabilitiesAccess]=src.[DisabilitiesAccess],
		[PhysicalLocationDescription]=src.[PhysicalLocationDescription],
		[BusServiceAccess]=src.[BusServiceAccess],
		[PublicAccessTransportation]=src.[PublicAccessTransportation],
		[PaymentMethods]=src.[PaymentMethods],
		[FeeStructureSource]=src.[FeeStructureSource],
		[ApplicationProcess]=src.[ApplicationProcess],
		[ResourceInfo]=src.[ResourceInfo],
		[DocumentsRequired]=src.[DocumentsRequired],
		[LanguagesOffered]=src.[LanguagesOffered],
		[LanguagesOfferedList]=src.[LanguagesOfferedList],
		[AvailabilityNumberOfTimes]=src.[AvailabilityNumberOfTimes],
		[AvailabilityFrequency]=src.[AvailabilityFrequency],
		[AvailabilityPeriod]=src.[AvailabilityPeriod],
		[ServiceNotAlwaysAvailability]=src.[ServiceNotAlwaysAvailability],
		[CapacityType]=src.[CapacityType],
		[ServiceCapacity]=src.[ServiceCapacity],
		[NormalWaitTime]=src.[NormalWaitTime],
		[TemporaryMessage]=src.[TemporaryMessage],
		[TemporaryMessageAppears]=src.[TemporaryMessageAppears],
		[TemporaryMessageExpires]=src.[TemporaryMessageExpires],
		[EnteredOn]=src.[EnteredOn],
		[UpdatedOn]=src.[UpdatedOn],
		[MadeInactiveOn]=src.[MadeInactiveOn],
		[InternalNotes]=src.[InternalNotes],
		[InternalNotesForEditorsAndViewers]=src.[InternalNotesForEditorsAndViewers],
		[HighlightedResource]=src.[HighlightedResource],
		[LastVerifiedOn]=src.[LastVerifiedOn],
		[LastVerifiedByName]=src.[LastVerifiedByName],
		[LastVerifiedByTitle]=src.[LastVerifiedByTitle],
		[LastVerifiedByPhoneNumber]=src.[LastVerifiedByPhoneNumber],
		[LastVerifiedByEmailAddress]=src.[LastVerifiedByEmailAddress],
		[LastVerificationApprovedBy]=src.[LastVerificationApprovedBy],
		[AvailableForDirectory]=src.[AvailableForDirectory],
		[AvailableForReferral]=src.[AvailableForReferral],
		[AvailableForResearch]=src.[AvailableForResearch],
		[PreferredProvider]=src.[PreferredProvider],
		[ConnectsToSiteNum]=src.[ConnectsToSiteNum],
		[ConnectsToProgramNum]=src.[ConnectsToProgramNum],
		[LanguageOfRecord]=src.[LanguageOfRecord],
		[CurrentWorkflowStepCode]=src.[CurrentWorkflowStepCode],
		[VolunteerOpportunities]=src.[VolunteerOpportunities],
		[VolunteerDuties]=src.[VolunteerDuties],
		[IsLinkOnly]=src.[IsLinkOnly],
		[ProgramAgencyNamePublic]=src.[ProgramAgencyNamePublic],
		[SiteAgencyNamePublic]=src.[SiteAgencyNamePublic],
		[Categories]=src.[Categories],
		[TaxonomyTerm]=src.[TaxonomyTerm],
		[TaxonomyTerms]=src.[TaxonomyTerms],
		[TaxonomyTermsNotDeactivated]=src.[TaxonomyTermsNotDeactivated],
		[TaxonomyCodes]=src.[TaxonomyCodes],
		[Coverage]=src.[Coverage],
		[Hours]=src.[Hours],
		[Custom_Public Comments]=src.[Custom_Public Comments],
		[Custom_Former Names]=src.[Custom_Former Names],
		[Custom_Legal Name]=src.[Custom_Legal Name],
		[Custom_Facebook]=src.[Custom_Facebook],
		[Custom_Instagram]=src.[Custom_Instagram],
		[Custom_LinkedIn]=src.[Custom_LinkedIn],
		[Custom_Twitter]=src.[Custom_Twitter],
		[Custom_YouTube]=src.[Custom_YouTube],
		[Custom_Minimum Age]=src.[Custom_Minimum Age],
		[Custom_Maximum Age]=src.[Custom_Maximum Age],
		[dst].[DATE_MODIFIED]=GETDATE(),
		ORG_LEVEL_1=src.ORG_LEVEL_1,
		ORG_DESCRIPTION=src.ORG_DESCRIPTION,
		LOCATION_NAME=src.LOCATION_NAME,
		LOCATION_DESCRIPTION=src.LOCATION_DESCRIPTION,
		SERVICE_NAME_LEVEL_1=src.SERVICE_NAME_LEVEL_1,
		SERVICE_NAME_LEVEL_2=src.SERVICE_NAME_LEVEL_2,
		DESCRIPTION=src.DESCRIPTION,
		dst.ORG_LOCATION_SERVICE='SERVICE',
		dst.DELETION_DATE=src.DELETION_DATE,
		dst.SOFT_DELETION_DATE=CASE WHEN src.[Custom_Deleted Record] = 'yes' THEN COALESCE(dst.SOFT_DELETION_DATE,GETDATE()) ELSE NULL END,
		dst.[Custom_Deleted Record]=src.[Custom_Deleted Record]
WHEN NOT MATCHED BY TARGET AND src.TaxonomyLevelName='ProgramAtSite' THEN
	INSERT (
		[ResourceAgencyNum],
		[LangID],
		[PublicName],
		[AlternateName],
		[OfficialName],
		[TaxonomyLevelName],
		[ParentAgency],
		[ParentAgencyNum],
		[RECORD_OWNER],
		[UniqueIDPriorSystem],
		[MailingAttentionName],
		[MailingAddress1],
		[MailingAddress2],
		[MailingCity],
		[MailingCommunity],
		[MailingStateProvince],
		[MailingPostalCode],
		[MailingCountry],
		[MailingAddressIsPrivate],
		[PhysicalAddress1],
		[PhysicalAddress2],
		[PhysicalCity],
		[PhysicalCounty],
		[PhysicalCommunity],
		[PhysicalStateProvince],
		[PhysicalPostalCode],
		[PhysicalCountry],
		[PhysicalAddressIsPrivate],
		[OtherAddress1],
		[OtherAddress2],
		[OtherCity],
		[OtherCounty],
		[OtherCommunity],
		[OtherStateProvince],
		[OtherPostalCode],
		[OtherCountry],
		[Latitude],
		[Longitude],
		[HoursOfOperation],
		[Phone1Number],
		[Phone1Name],
		[Phone1Description],
		[Phone1IsPrivate],
		[Phone1Type],
		[Phone2Number],
		[Phone2Name],
		[Phone2Description],
		[Phone2IsPrivate],
		[Phone2Type],
		[Phone3Number],
		[Phone3Name],
		[Phone3Description],
		[Phone3IsPrivate],
		[Phone3Type],
		[Phone4Number],
		[Phone4Name],
		[Phone4Description],
		[Phone4IsPrivate],
		[Phone4Type],
		[Phone5Number],
		[Phone5name],
		[Phone5Description],
		[Phone5IsPrivate],
		[Phone5Type],
		[PhoneFax],
		[PhoneFaxDescription],
		[PhoneFaxIsPrivate],
		[PhoneTTY],
		[PhoneTTYDescription],
		[PhoneTTYIsPrivate],
		[PhoneTollFree],
		[PhoneTollFreeDescription],
		[PhoneTollFreeIsPrivate],
		[PhoneNumberHotline],
		[PhoneNumberHotlineDescription],
		[PhoneNumberHotlineIsPrivate],
		[PhoneNumberBusinessLine],
		[PhoneNumberBusinessLineDescription],
		[PhoneNumberBusinessLineIsPrivate],
		[PhoneNumberOutOfArea],
		[PhoneNumberOutOfAreaDescription],
		[PhoneNumberOutOfAreaIsPrivate],
		[PhoneNumberAfterHours],
		[PhoneNumberAfterHoursDescription],
		[PhoneNumberAfterHoursIsPrivate],
		[EmailAddressMain],
		[WebsiteAddress],
		[AgencyStatus],
		[AgencyClassification],
		[CoverageArea],
		[CoverageAreaText],
		[Eligibility],
		[EligibilityAdult],
		[EligibilityChild],
		[EligibilityFamily],
		[EligibilityFemale],
		[EligibilityMale],
		[EligibilityTeen],
		[SeniorWorkerName],
		[SeniorWorkerTitle],
		[SeniorWorkerEmailAddress],
		[SeniorWorkerPhoneNumber],
		[SeniorWorkerIsPrivate],
		[MainContactName],
		[MainContactTitle],
		[MainContactEmailAddress],
		[MainContactPhoneNumber],
		[MainContactType],
		[MainContactIsPrivate],
		[LicenseAccreditation],
		[YearIncorporated],
		[AnnualBudgetTotal],
		[LegalStatus],
		[SourceOfFunds],
		[ExcludeFromWebsite],
		[ExcludeFromDirectory],
		[DisabilitiesAccess],
		[PhysicalLocationDescription],
		[BusServiceAccess],
		[PublicAccessTransportation],
		[PaymentMethods],
		[FeeStructureSource],
		[ApplicationProcess],
		[ResourceInfo],
		[DocumentsRequired],
		[LanguagesOffered],
		[LanguagesOfferedList],
		[AvailabilityNumberOfTimes],
		[AvailabilityFrequency],
		[AvailabilityPeriod],
		[ServiceNotAlwaysAvailability],
		[CapacityType],
		[ServiceCapacity],
		[NormalWaitTime],
		[TemporaryMessage],
		[TemporaryMessageAppears],
		[TemporaryMessageExpires],
		[EnteredOn],
		[UpdatedOn],
		[MadeInactiveOn],
		[InternalNotes],
		[InternalNotesForEditorsAndViewers],
		[HighlightedResource],
		[LastVerifiedOn],
		[LastVerifiedByName],
		[LastVerifiedByTitle],
		[LastVerifiedByPhoneNumber],
		[LastVerifiedByEmailAddress],
		[LastVerificationApprovedBy],
		[AvailableForDirectory],
		[AvailableForReferral],
		[AvailableForResearch],
		[PreferredProvider],
		[ConnectsToSiteNum],
		[ConnectsToProgramNum],
		[LanguageOfRecord],
		[CurrentWorkflowStepCode],
		[VolunteerOpportunities],
		[VolunteerDuties],
		[IsLinkOnly],
		[ProgramAgencyNamePublic],
		[SiteAgencyNamePublic],
		[Categories],
		[TaxonomyTerm],
		[TaxonomyTerms],
		[TaxonomyTermsNotDeactivated],
		[TaxonomyCodes],
		[Coverage],
		[Hours],
		[Custom_Public Comments],
		[Custom_Former Names],
		[Custom_Legal Name],
		[Custom_Facebook],
		[Custom_Instagram],
		[Custom_LinkedIn],
		[Custom_Twitter],
		[Custom_YouTube],
		[Custom_Minimum Age],
		[Custom_Maximum Age],
		[DATE_MODIFIED],
		ORG_LEVEL_1,
		ORG_DESCRIPTION,
		LOCATION_NAME,
		LOCATION_DESCRIPTION,
		SERVICE_NAME_LEVEL_1,
		SERVICE_NAME_LEVEL_2,
		DESCRIPTION,
		ORG_LOCATION_SERVICE,
		DELETION_DATE,
		SOFT_DELETION_DATE,
		[Custom_Deleted Record]
	) VALUES (
		src.[ResourceAgencyNum],
		src.LangID,
		src.[PublicName],
		src.[AlternateName],
		src.[OfficialName],
		src.[TaxonomyLevelName],
		src.[ParentAgency],
		src.[ParentAgencyNum],
		LEFT(src.[RECORD_OWNER], 3),
		src.[UniqueIDPriorSystem],
		src.[MailingAttentionName],
		src.[MailingAddress1],
		src.[MailingAddress2],
		src.[MailingCity],
		src.[MailingCommunity],
		src.[MailingStateProvince],
		src.[MailingPostalCode],
		src.[MailingCountry],
		src.[MailingAddressIsPrivate],
		src.[PhysicalAddress1],
		src.[PhysicalAddress2],
		src.[PhysicalCity],
		src.[PhysicalCounty],
		src.[PhysicalCommunity],
		src.[PhysicalStateProvince],
		src.[PhysicalPostalCode],
		src.[PhysicalCountry],
		src.[PhysicalAddressIsPrivate],
		src.[OtherAddress1],
		src.[OtherAddress2],
		src.[OtherCity],
		src.[OtherCounty],
		src.[OtherCommunity],
		src.[OtherStateProvince],
		src.[OtherPostalCode],
		src.[OtherCountry],
		src.[Latitude],
		src.[Longitude],
		src.[HoursOfOperation],
		src.[Phone1Number],
		src.[Phone1Name],
		src.[Phone1Description],
		src.[Phone1IsPrivate],
		src.[Phone1Type],
		src.[Phone2Number],
		src.[Phone2Name],
		src.[Phone2Description],
		src.[Phone2IsPrivate],
		src.[Phone2Type],
		src.[Phone3Number],
		src.[Phone3Name],
		src.[Phone3Description],
		src.[Phone3IsPrivate],
		src.[Phone3Type],
		src.[Phone4Number],
		src.[Phone4Name],
		src.[Phone4Description],
		src.[Phone4IsPrivate],
		src.[Phone4Type],
		src.[Phone5Number],
		src.[Phone5name],
		src.[Phone5Description],
		src.[Phone5IsPrivate],
		src.[Phone5Type],
		src.[PhoneFax],
		src.[PhoneFaxDescription],
		src.[PhoneFaxIsPrivate],
		src.[PhoneTTY],
		src.[PhoneTTYDescription],
		src.[PhoneTTYIsPrivate],
		src.[PhoneTollFree],
		src.[PhoneTollFreeDescription],
		src.[PhoneTollFreeIsPrivate],
		src.[PhoneNumberHotline],
		src.[PhoneNumberHotlineDescription],
		src.[PhoneNumberHotlineIsPrivate],
		src.[PhoneNumberBusinessLine],
		src.[PhoneNumberBusinessLineDescription],
		src.[PhoneNumberBusinessLineIsPrivate],
		src.[PhoneNumberOutOfArea],
		src.[PhoneNumberOutOfAreaDescription],
		src.[PhoneNumberOutOfAreaIsPrivate],
		src.[PhoneNumberAfterHours],
		src.[PhoneNumberAfterHoursDescription],
		src.[PhoneNumberAfterHoursIsPrivate],
		src.[EmailAddressMain],
		src.[WebsiteAddress],
		src.[AgencyStatus],
		src.[AgencyClassification],
		src.[CoverageArea],
		src.[CoverageAreaText],
		src.[Eligibility],
		src.[EligibilityAdult],
		src.[EligibilityChild],
		src.[EligibilityFamily],
		src.[EligibilityFemale],
		src.[EligibilityMale],
		src.[EligibilityTeen],
		src.[SeniorWorkerName],
		src.[SeniorWorkerTitle],
		src.[SeniorWorkerEmailAddress],
		src.[SeniorWorkerPhoneNumber],
		src.[SeniorWorkerIsPrivate],
		src.[MainContactName],
		src.[MainContactTitle],
		src.[MainContactEmailAddress],
		src.[MainContactPhoneNumber],
		src.[MainContactType],
		src.[MainContactIsPrivate],
		src.[LicenseAccreditation],
		src.[YearIncorporated],
		src.[AnnualBudgetTotal],
		src.[LegalStatus],
		src.[SourceOfFunds],
		src.[ExcludeFromWebsite],
		src.[ExcludeFromDirectory],
		src.[DisabilitiesAccess],
		src.[PhysicalLocationDescription],
		src.[BusServiceAccess],
		src.[PublicAccessTransportation],
		src.[PaymentMethods],
		src.[FeeStructureSource],
		src.[ApplicationProcess],
		src.[ResourceInfo],
		src.[DocumentsRequired],
		src.[LanguagesOffered],
		src.[LanguagesOfferedList],
		src.[AvailabilityNumberOfTimes],
		src.[AvailabilityFrequency],
		src.[AvailabilityPeriod],
		src.[ServiceNotAlwaysAvailability],
		src.[CapacityType],
		src.[ServiceCapacity],
		src.[NormalWaitTime],
		src.[TemporaryMessage],
		src.[TemporaryMessageAppears],
		src.[TemporaryMessageExpires],
		src.[EnteredOn],
		src.[UpdatedOn],
		src.[MadeInactiveOn],
		src.[InternalNotes],
		src.[InternalNotesForEditorsAndViewers],
		src.[HighlightedResource],
		src.[LastVerifiedOn],
		src.[LastVerifiedByName],
		src.[LastVerifiedByTitle],
		src.[LastVerifiedByPhoneNumber],
		src.[LastVerifiedByEmailAddress],
		src.[LastVerificationApprovedBy],
		src.[AvailableForDirectory],
		src.[AvailableForReferral],
		src.[AvailableForResearch],
		src.[PreferredProvider],
		src.[ConnectsToSiteNum],
		src.[ConnectsToProgramNum],
		src.[LanguageOfRecord],
		src.[CurrentWorkflowStepCode],
		src.[VolunteerOpportunities],
		src.[VolunteerDuties],
		src.[IsLinkOnly],
		src.[ProgramAgencyNamePublic],
		src.[SiteAgencyNamePublic],
		src.[Categories],
		src.[TaxonomyTerm],
		src.[TaxonomyTerms],
		src.[TaxonomyTermsNotDeactivated],
		src.[TaxonomyCodes],
		src.[Coverage],
		src.[Hours],
		src.[Custom_Public Comments],
		src.[Custom_Former Names],
		src.[Custom_Legal Name],
		src.[Custom_Facebook],
		src.[Custom_Instagram],
		src.[Custom_LinkedIn],
		src.[Custom_Twitter],
		src.[Custom_YouTube],
		src.[Custom_Minimum Age],
		src.[Custom_Maximum Age],
		GETDATE(),
		src.ORG_LEVEL_1,
		src.ORG_DESCRIPTION,
		src.LOCATION_NAME,
		src.LOCATION_DESCRIPTION,
		src.SERVICE_NAME_LEVEL_1,
		src.SERVICE_NAME_LEVEL_2,
		src.DESCRIPTION,
		'SERVICE',
		src.DELETION_DATE,
		CASE WHEN src.[Custom_Deleted Record] = 'yes' THEN GETDATE() ELSE NULL END,
		src.[Custom_Deleted Record]
	)
OPTION (ROBUST PLAN)
	;

MERGE INTO dbo.CIC_iCarolImportRollup dst
USING (
SELECT 
		(SELECT MAX(SYNC_DATE) FROM (VALUES (s.SYNC_DATE), (a.SYNC_DATE)) AS i(SYNC_DATE)) AS SYNC_DATE,
		s.[ResourceAgencyNum] AS [ResourceAgencyNum],
		s.[LangID] AS [LangID],
		COALESCE(s.[PublicName], a.[PublicName]) AS [PublicName],
		COALESCE(s.[AlternateName], a.[AlternateName]) AS [AlternateName],
		COALESCE(s.[OfficialName], a.[OfficialName]) AS [OfficialName],
		s.[TaxonomyLevelName] AS [TaxonomyLevelName],
		COALESCE(s.[ParentAgency], a.[ParentAgency]) AS [ParentAgency],
		COALESCE(s.[ParentAgencyNum], a.[ParentAgencyNum]) AS [ParentAgencyNum],
		s.[Custom_Record Owner (controlled)] AS [RECORD_OWNER],
		LEFT(COALESCE(s.[UniqueIDPriorSystem], a.[UniqueIDPriorSystem]), 8) AS [UniqueIDPriorSystem],
		CASE WHEN s.HasMailingAddress=1 THEN s.[MailingAttentionName]  WHEN a.HasMailingAddress=1 THEN a.[MailingAttentionName]  ELSE NULL END AS [MailingAttentionName],
		CASE WHEN s.HasMailingAddress=1 THEN s.[MailingAddress1] WHEN a.HasMailingAddress=1 THEN a.[MailingAddress1] ELSE NULL END AS [MailingAddress1],
		CASE WHEN s.HasMailingAddress=1 THEN s.[MailingAddress2] WHEN a.HasMailingAddress=1 THEN a.[MailingAddress2] ELSE NULL END AS [MailingAddress2],
		CASE WHEN s.HasMailingAddress=1 THEN s.[MailingCity] WHEN a.HasMailingAddress=1 THEN a.[MailingCity] ELSE NULL END AS [MailingCity],
		CASE WHEN s.HasMailingAddress=1 THEN s.[MailingCommunity] WHEN a.HasMailingAddress=1 THEN a.[MailingCommunity] ELSE NULL END AS [MailingCommunity],
		CASE WHEN s.HasMailingAddress=1 THEN s.[MailingStateProvince] WHEN a.HasMailingAddress=1 THEN a.[MailingStateProvince] ELSE NULL END AS [MailingStateProvince],
		CASE WHEN s.HasMailingAddress=1 THEN s.[MailingPostalCode] WHEN a.HasMailingAddress=1 THEN a.[MailingPostalCode] ELSE NULL END AS [MailingPostalCode],
		CASE WHEN s.HasMailingAddress=1 THEN s.[MailingCountry] WHEN a.HasMailingAddress=1 THEN a.[MailingCountry] ELSE NULL END AS [MailingCountry],
		CASE WHEN s.HasMailingAddress=1 THEN s.[MailingAddressIsPrivate] WHEN a.HasMailingAddress=1 THEN a.[MailingAddressIsPrivate] ELSE NULL END AS [MailingAddressIsPrivate],
		CASE WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalAddress1] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalAddress1] ELSE NULL END AS [PhysicalAddress1],
		CASE WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalAddress2] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalAddress2] ELSE NULL END AS [PhysicalAddress2],
		CASE WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalCity] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalCity] ELSE NULL END AS [PhysicalCity],
		CASE WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalCounty] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalCounty] ELSE NULL END AS [PhysicalCounty],
		CASE WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalCommunity] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalCommunity] ELSE NULL END AS [PhysicalCommunity],
		CASE WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalStateProvince] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalStateProvince] ELSE NULL END AS [PhysicalStateProvince],
		CASE WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalPostalCode] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalPostalCode] ELSE NULL END AS [PhysicalPostalCode],
		CASE WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalCountry] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalCountry] ELSE NULL END AS [PhysicalCountry],
		CASE WHEN s.HasPhysicalAddress=1 THEN s.[PhysicalAddressIsPrivate] WHEN a.HasPhysicalAddress=1 THEN a.[PhysicalAddressIsPrivate] ELSE NULL END AS [PhysicalAddressIsPrivate],		COALESCE(s.[OtherAddress1], a.[OtherAddress1]) AS [OtherAddress1],
		COALESCE(s.[OtherAddress2], a.[OtherAddress2]) AS [OtherAddress2],
		COALESCE(s.[OtherCity], a.[OtherCity]) AS [OtherCity],
		COALESCE(s.[OtherCounty], a.[OtherCounty]) AS [OtherCounty],
		COALESCE(s.[OtherCommunity], a.[OtherCommunity]) AS [OtherCommunity],
		COALESCE(s.[OtherStateProvince], a.[OtherStateProvince]) AS [OtherStateProvince],
		COALESCE(s.[OtherPostalCode], a.[OtherPostalCode]) AS [OtherPostalCode],
		COALESCE(NULLIF(s.[OtherCountry], '-1'), NULLIF(a.[OtherCountry], '-1')) AS [OtherCountry],
		COALESCE(CASE WHEN s.PhysicalAddressIsPrivate = 'Yes' THEN NULL ELSE NULLIF(s.[Latitude],'0') END, CASE WHEN a.PhysicalAddressIsPrivate = 'Yes' THEN NULL ELSE NULLIF(a.[Latitude],'0') END) AS [Latitude],
		COALESCE(CASE WHEN s.PhysicalAddressIsPrivate = 'Yes' THEN NULL ELSE NULLIF(s.[Longitude],'0') END, CASE WHEN a.PhysicalAddressIsPrivate = 'Yes' THEN NULL ELSE NULLIF(a.[Longitude],'0') END) AS [Longitude],
		COALESCE(s.[HoursOfOperation], a.[HoursOfOperation]) AS [HoursOfOperation],
		s.[Phone1Number],
		s.[Phone1Name],
		s.[Phone1Description],
		s.[Phone1IsPrivate],
		s.[Phone1Type],
		s.[Phone2Number],
		s.[Phone2Name],
		s.[Phone2Description],
		s.[Phone2IsPrivate],
		s.[Phone2Type],
		s.[Phone3Number],
		s.[Phone3Name],
		s.[Phone3Description],
		s.[Phone3IsPrivate],
		s.[Phone3Type],
		s.[Phone4Number],
		s.[Phone4Name],
		s.[Phone4Description],
		s.[Phone4IsPrivate],
		s.[Phone4Type],
		s.[Phone5Number],
		s.[Phone5name],
		s.[Phone5Description],
		s.[Phone5IsPrivate],
		s.[Phone5Type],
		s.[PhoneFax],
		s.[PhoneFaxDescription],
		s.[PhoneFaxIsPrivate],
		s.[PhoneTTY],
		s.[PhoneTTYDescription],
		s.[PhoneTTYIsPrivate],
		s.[PhoneTollFree],
		s.[PhoneTollFreeDescription],
		s.[PhoneTollFreeIsPrivate],
		s.[PhoneNumberHotline],
		s.[PhoneNumberHotlineDescription],
		s.[PhoneNumberHotlineIsPrivate],
		s.[PhoneNumberBusinessLine],
		s.[PhoneNumberBusinessLineDescription],
		s.[PhoneNumberBusinessLineIsPrivate],
		s.[PhoneNumberOutOfArea],
		s.[PhoneNumberOutOfAreaDescription],
		s.[PhoneNumberOutOfAreaIsPrivate],
		s.[PhoneNumberAfterHours],
		s.[PhoneNumberAfterHoursDescription],
		s.[PhoneNumberAfterHoursIsPrivate],
		COALESCE(s.[EmailAddressMain], a.[EmailAddressMain]) AS [EmailAddressMain],
		COALESCE(s.[WebsiteAddress], a.[WebsiteAddress]) AS [WebsiteAddress],
		COALESCE(s.[AgencyStatus], a.[AgencyStatus]) AS [AgencyStatus],
		COALESCE(s.[AgencyClassification], a.[AgencyClassification]) AS [AgencyClassification],
		COALESCE(s.[CoverageArea], a.[CoverageArea]) AS [CoverageArea],
		COALESCE(s.[CoverageAreaText], a.[CoverageAreaText]) AS [CoverageAreaText],
		COALESCE(s.[Eligibility], a.[Eligibility]) AS [Eligibility],
		COALESCE(s.[EligibilityAdult], a.[EligibilityAdult]) AS [EligibilityAdult],
		COALESCE(s.[EligibilityChild], a.[EligibilityChild]) AS [EligibilityChild],
		COALESCE(s.[EligibilityFamily], a.[EligibilityFamily]) AS [EligibilityFamily],
		COALESCE(s.[EligibilityFemale], a.[EligibilityFemale]) AS [EligibilityFemale],
		COALESCE(s.[EligibilityMale], a.[EligibilityMale]) AS [EligibilityMale],
		COALESCE(s.[EligibilityTeen], a.[EligibilityTeen]) AS [EligibilityTeen],
		s.[SeniorWorkerName],
		s.[SeniorWorkerTitle],
		s.[SeniorWorkerEmailAddress],
		s.[SeniorWorkerPhoneNumber],
		s.[SeniorWorkerIsPrivate],
		s.[MainContactName],
		s.[MainContactTitle],
		s.[MainContactEmailAddress],
		s.[MainContactPhoneNumber],
		s.[MainContactType],
		s.[MainContactIsPrivate],
		COALESCE(s.[LicenseAccreditation], a.[LicenseAccreditation]) AS [LicenseAccreditation],
		COALESCE(s.[YearIncorporated], a.[YearIncorporated]) AS [YearIncorporated],
		COALESCE(s.[AnnualBudgetTotal], a.[AnnualBudgetTotal]) AS [AnnualBudgetTotal],
		COALESCE(s.[LegalStatus], a.[LegalStatus]) AS [LegalStatus],
		COALESCE(s.[SourceOfFunds], a.[SourceOfFunds]) AS [SourceOfFunds],
		COALESCE(s.[ExcludeFromWebsite], a.[ExcludeFromWebsite]) AS [ExcludeFromWebsite],
		COALESCE(s.[ExcludeFromDirectory], a.[ExcludeFromDirectory]) AS [ExcludeFromDirectory],
		COALESCE(s.[DisabilitiesAccess], a.[DisabilitiesAccess]) AS [DisabilitiesAccess],
		COALESCE(s.[PhysicalLocationDescription], a.[PhysicalLocationDescription]) AS [PhysicalLocationDescription],
		COALESCE(s.[BusServiceAccess], a.[BusServiceAccess]) AS [BusServiceAccess],
		COALESCE(s.[PublicAccessTransportation], a.[PublicAccessTransportation]) AS [PublicAccessTransportation],
		COALESCE(s.[PaymentMethods], a.[PaymentMethods]) AS [PaymentMethods],
		COALESCE(s.[FeeStructureSource], a.[FeeStructureSource]) AS [FeeStructureSource],
		COALESCE(s.[ApplicationProcess], a.[ApplicationProcess]) AS [ApplicationProcess],
		COALESCE(s.[ResourceInfo], a.[ResourceInfo]) AS [ResourceInfo],
		COALESCE(s.[DocumentsRequired], a.[DocumentsRequired]) AS [DocumentsRequired],
		COALESCE(s.[LanguagesOffered], a.[LanguagesOffered]) AS [LanguagesOffered],
		COALESCE(s.[LanguagesOfferedList], a.[LanguagesOfferedList]) AS [LanguagesOfferedList],
		COALESCE(s.[AvailabilityNumberOfTimes], a.[AvailabilityNumberOfTimes]) AS [AvailabilityNumberOfTimes],
		COALESCE(s.[AvailabilityFrequency], a.[AvailabilityFrequency]) AS [AvailabilityFrequency],
		COALESCE(s.[AvailabilityPeriod], a.[AvailabilityPeriod]) AS [AvailabilityPeriod],
		COALESCE(s.[ServiceNotAlwaysAvailability], a.[ServiceNotAlwaysAvailability]) AS [ServiceNotAlwaysAvailability],
		COALESCE(s.[CapacityType], a.[CapacityType]) AS [CapacityType],
		COALESCE(s.[ServiceCapacity], a.[ServiceCapacity]) AS [ServiceCapacity],
		COALESCE(s.[NormalWaitTime], a.[NormalWaitTime]) AS [NormalWaitTime],
		COALESCE(s.[TemporaryMessage], a.[TemporaryMessage]) AS [TemporaryMessage],
		COALESCE(s.[TemporaryMessageAppears], a.[TemporaryMessageAppears]) AS [TemporaryMessageAppears],
		COALESCE(s.[TemporaryMessageExpires], a.[TemporaryMessageExpires]) AS [TemporaryMessageExpires],
		COALESCE(s.[EnteredOn], a.[EnteredOn]) AS [EnteredOn],
		COALESCE(s.[UpdatedOn], a.[UpdatedOn]) AS [UpdatedOn],
		COALESCE(s.[MadeInactiveOn], a.[MadeInactiveOn]) AS [MadeInactiveOn],
		s.[InternalNotes] AS [InternalNotes],
		s.[InternalNotesForEditorsAndViewers] AS [InternalNotesForEditorsAndViewers],
		COALESCE(s.[HighlightedResource], a.[HighlightedResource]) AS [HighlightedResource],
		s.[LastVerifiedOn], 
		s.[LastVerifiedByName],
		s.[LastVerifiedByTitle], 
		s.[LastVerifiedByPhoneNumber], 
		s.[LastVerifiedByEmailAddress],
		s.[LastVerificationApprovedBy],
		COALESCE(s.[AvailableForDirectory], a.[AvailableForDirectory]) AS [AvailableForDirectory],
		COALESCE(s.[AvailableForReferral], a.[AvailableForReferral]) AS [AvailableForReferral],
		COALESCE(s.[AvailableForResearch], a.[AvailableForResearch]) AS [AvailableForResearch],
		COALESCE(s.[PreferredProvider], a.[PreferredProvider]) AS [PreferredProvider],
		COALESCE(s.[ConnectsToSiteNum], a.[ConnectsToSiteNum]) AS [ConnectsToSiteNum],
		COALESCE(s.[ConnectsToProgramNum], a.[ConnectsToProgramNum]) AS [ConnectsToProgramNum],
		COALESCE(s.[LanguageOfRecord], a.[LanguageOfRecord]) AS [LanguageOfRecord],
		COALESCE(s.[CurrentWorkflowStepCode], a.[CurrentWorkflowStepCode]) AS [CurrentWorkflowStepCode],
		COALESCE(s.[VolunteerOpportunities], a.[VolunteerOpportunities]) AS [VolunteerOpportunities],
		COALESCE(s.[VolunteerDuties], a.[VolunteerDuties]) AS [VolunteerDuties],
		COALESCE(s.[IsLinkOnly], a.[IsLinkOnly]) AS [IsLinkOnly],
		COALESCE(s.[ProgramAgencyNamePublic], a.[ProgramAgencyNamePublic]) AS [ProgramAgencyNamePublic],
		COALESCE(s.[SiteAgencyNamePublic], a.[SiteAgencyNamePublic]) AS [SiteAgencyNamePublic],
		COALESCE(s.[Categories], a.[Categories]) AS [Categories],
		COALESCE(s.[TaxonomyTerm], a.[TaxonomyTerm]) AS [TaxonomyTerm],
		COALESCE(s.[TaxonomyTerms], a.[TaxonomyTerms]) AS [TaxonomyTerms],
		COALESCE(s.[TaxonomyTermsNotDeactivated], a.[TaxonomyTermsNotDeactivated]) AS [TaxonomyTermsNotDeactivated],
		COALESCE(s.[TaxonomyCodes], a.[TaxonomyCodes]) AS [TaxonomyCodes],
		COALESCE(s.[Coverage], a.[Coverage]) AS [Coverage],
		COALESCE(s.[Hours], a.[Hours]) AS [Hours],
		s.[Custom_Public Comments] AS [Custom_Public Comments],
		COALESCE(s.[Custom_Former Names], a.[Custom_Former Names]) AS [Custom_Former Names],
		COALESCE(s.[Custom_Legal Name], a.[Custom_Legal Name]) AS [Custom_Legal Name],
		COALESCE(s.[Custom_Facebook], a.[Custom_Facebook]) AS [Custom_Facebook],
		COALESCE(s.[Custom_Instagram], a.[Custom_Instagram]) AS [Custom_Instagram],
		COALESCE(s.[Custom_LinkedIn], a.[Custom_LinkedIn]) AS [Custom_LinkedIn],
		COALESCE(s.[Custom_Twitter], a.[Custom_Twitter]) AS [Custom_Twitter],
		COALESCE(s.[Custom_YouTube], a.[Custom_YouTube]) AS [Custom_YouTube],
		COALESCE(s.[Custom_Minimum Age], a.[Custom_Minimum Age]) AS [Custom_Minimum Age],
		COALESCE(s.[Custom_Maximum Age], a.[Custom_Maximum Age]) AS [Custom_Maximum Age],
		a.PublicName AS ORG_LEVEL_1,
		NULL AS ORG_DESCRIPTION,
		s.PublicName AS LOCATION_NAME,
		s.AgencyDescription AS LOCATION_DESCRIPTION,
		s.DELETION_DATE,
		CASE WHEN s.ResourceAgencyNum IS NULL OR 'yes' IN (s.[Custom_Deleted Record], a.[Custom_Deleted Record]) THEN 'yes' ELSE 'no' END AS [Custom_Deleted Record]
FROM dbo.CIC_iCarolImport AS s
LEFT JOIN dbo.CIC_iCarolImport a
	ON s.ParentAgencyNum=a.ResourceAgencyNum AND a.TaxonomyLevelName='Agency' AND a.LangID=s.LangID
WHERE s.TaxonomyLevelName='Site'
) AS src
ON src.ResourceAgencyNum=dst.ResourceAgencyNum AND src.LangID=dst.LangID AND src.TaxonomyLevelName = 'Site'
WHEN MATCHED AND src.SYNC_DATE > dst.DATE_MODIFIED THEN 
	UPDATE SET 
		[PublicName]=src.[PublicName],
		[AlternateName]=src.[AlternateName],
		[OfficialName]=src.[OfficialName],
		[TaxonomyLevelName]=src.[TaxonomyLevelName],
		[ParentAgency]=src.[ParentAgency],
		[ParentAgencyNum]=src.[ParentAgencyNum],
		[RECORD_OWNER]=LEFT(src.[RECORD_OWNER], 3),
		[UniqueIDPriorSystem]=src.[UniqueIDPriorSystem],
		[MailingAttentionName]=src.[MailingAttentionName],
		[MailingAddress1]=src.[MailingAddress1],
		[MailingAddress2]=src.[MailingAddress2],
		[MailingCity]=src.[MailingCity],
		[MailingCommunity]=src.[MailingCommunity],
		[MailingStateProvince]=src.[MailingStateProvince],
		[MailingPostalCode]=src.[MailingPostalCode],
		[MailingCountry]=src.[MailingCountry],
		[MailingAddressIsPrivate]=src.[MailingAddressIsPrivate],
		[PhysicalAddress1]=src.[PhysicalAddress1],
		[PhysicalAddress2]=src.[PhysicalAddress2],
		[PhysicalCity]=src.[PhysicalCity],
		[PhysicalCounty]=src.[PhysicalCounty],
		[PhysicalCommunity]=src.[PhysicalCommunity],
		[PhysicalStateProvince]=src.[PhysicalStateProvince],
		[PhysicalPostalCode]=src.[PhysicalPostalCode],
		[PhysicalCountry]=src.[PhysicalCountry],
		[PhysicalAddressIsPrivate]=src.[PhysicalAddressIsPrivate],
		[OtherAddress1]=src.[OtherAddress1],
		[OtherAddress2]=src.[OtherAddress2],
		[OtherCity]=src.[OtherCity],
		[OtherCounty]=src.[OtherCounty],
		[OtherCommunity]=src.[OtherCommunity],
		[OtherStateProvince]=src.[OtherStateProvince],
		[OtherPostalCode]=src.[OtherPostalCode],
		[OtherCountry]=src.[OtherCountry],
		[Latitude]=src.[Latitude],
		[Longitude]=src.[Longitude],
		[HoursOfOperation]=src.[HoursOfOperation],
		[Phone1Number]=src.[Phone1Number],
		[Phone1Name]=src.[Phone1Name],
		[Phone1Description]=src.[Phone1Description],
		[Phone1IsPrivate]=src.[Phone1IsPrivate],
		[Phone1Type]=src.[Phone1Type],
		[Phone2Number]=src.[Phone2Number],
		[Phone2Name]=src.[Phone2Name],
		[Phone2Description]=src.[Phone2Description],
		[Phone2IsPrivate]=src.[Phone2IsPrivate],
		[Phone2Type]=src.[Phone2Type],
		[Phone3Number]=src.[Phone3Number],
		[Phone3Name]=src.[Phone3Name],
		[Phone3Description]=src.[Phone3Description],
		[Phone3IsPrivate]=src.[Phone3IsPrivate],
		[Phone3Type]=src.[Phone3Type],
		[Phone4Number]=src.[Phone4Number],
		[Phone4Name]=src.[Phone4Name],
		[Phone4Description]=src.[Phone4Description],
		[Phone4IsPrivate]=src.[Phone4IsPrivate],
		[Phone4Type]=src.[Phone4Type],
		[Phone5Number]=src.[Phone5Number],
		[Phone5name]=src.[Phone5name],
		[Phone5Description]=src.[Phone5Description],
		[Phone5IsPrivate]=src.[Phone5IsPrivate],
		[Phone5Type]=src.[Phone5Type],
		[PhoneFax]=src.[PhoneFax],
		[PhoneFaxDescription]=src.[PhoneFaxDescription],
		[PhoneFaxIsPrivate]=src.[PhoneFaxIsPrivate],
		[PhoneTTY]=src.[PhoneTTY],
		[PhoneTTYDescription]=src.[PhoneTTYDescription],
		[PhoneTTYIsPrivate]=src.[PhoneTTYIsPrivate],
		[PhoneTollFree]=src.[PhoneTollFree],
		[PhoneTollFreeDescription]=src.[PhoneTollFreeDescription],
		[PhoneTollFreeIsPrivate]=src.[PhoneTollFreeIsPrivate],
		[PhoneNumberHotline]=src.[PhoneNumberHotline],
		[PhoneNumberHotlineDescription]=src.[PhoneNumberHotlineDescription],
		[PhoneNumberHotlineIsPrivate]=src.[PhoneNumberHotlineIsPrivate],
		[PhoneNumberBusinessLine]=src.[PhoneNumberBusinessLine],
		[PhoneNumberBusinessLineDescription]=src.[PhoneNumberBusinessLineDescription],
		[PhoneNumberBusinessLineIsPrivate]=src.[PhoneNumberBusinessLineIsPrivate],
		[PhoneNumberOutOfArea]=src.[PhoneNumberOutOfArea],
		[PhoneNumberOutOfAreaDescription]=src.[PhoneNumberOutOfAreaDescription],
		[PhoneNumberOutOfAreaIsPrivate]=src.[PhoneNumberOutOfAreaIsPrivate],
		[PhoneNumberAfterHours]=src.[PhoneNumberAfterHours],
		[PhoneNumberAfterHoursDescription]=src.[PhoneNumberAfterHoursDescription],
		[PhoneNumberAfterHoursIsPrivate]=src.[PhoneNumberAfterHoursIsPrivate],
		[EmailAddressMain]=src.[EmailAddressMain],
		[WebsiteAddress]=src.[WebsiteAddress],
		[AgencyStatus]=src.[AgencyStatus],
		[AgencyClassification]=src.[AgencyClassification],
		[CoverageArea]=src.[CoverageArea],
		[CoverageAreaText]=src.[CoverageAreaText],
		[Eligibility]=src.[Eligibility],
		[EligibilityAdult]=src.[EligibilityAdult],
		[EligibilityChild]=src.[EligibilityChild],
		[EligibilityFamily]=src.[EligibilityFamily],
		[EligibilityFemale]=src.[EligibilityFemale],
		[EligibilityMale]=src.[EligibilityMale],
		[EligibilityTeen]=src.[EligibilityTeen],
		[SeniorWorkerName]=src.[SeniorWorkerName],
		[SeniorWorkerTitle]=src.[SeniorWorkerTitle],
		[SeniorWorkerEmailAddress]=src.[SeniorWorkerEmailAddress],
		[SeniorWorkerPhoneNumber]=src.[SeniorWorkerPhoneNumber],
		[SeniorWorkerIsPrivate]=src.[SeniorWorkerIsPrivate],
		[MainContactName]=src.[MainContactName],
		[MainContactTitle]=src.[MainContactTitle],
		[MainContactEmailAddress]=src.[MainContactEmailAddress],
		[MainContactPhoneNumber]=src.[MainContactPhoneNumber],
		[MainContactType]=src.[MainContactType],
		[MainContactIsPrivate]=src.[MainContactIsPrivate],
		[LicenseAccreditation]=src.[LicenseAccreditation],
		[YearIncorporated]=src.[YearIncorporated],
		[AnnualBudgetTotal]=src.[AnnualBudgetTotal],
		[LegalStatus]=src.[LegalStatus],
		[SourceOfFunds]=src.[SourceOfFunds],
		[ExcludeFromWebsite]=src.[ExcludeFromWebsite],
		[ExcludeFromDirectory]=src.[ExcludeFromDirectory],
		[DisabilitiesAccess]=src.[DisabilitiesAccess],
		[PhysicalLocationDescription]=src.[PhysicalLocationDescription],
		[BusServiceAccess]=src.[BusServiceAccess],
		[PublicAccessTransportation]=src.[PublicAccessTransportation],
		[PaymentMethods]=src.[PaymentMethods],
		[FeeStructureSource]=src.[FeeStructureSource],
		[ApplicationProcess]=src.[ApplicationProcess],
		[ResourceInfo]=src.[ResourceInfo],
		[DocumentsRequired]=src.[DocumentsRequired],
		[LanguagesOffered]=src.[LanguagesOffered],
		[LanguagesOfferedList]=src.[LanguagesOfferedList],
		[AvailabilityNumberOfTimes]=src.[AvailabilityNumberOfTimes],
		[AvailabilityFrequency]=src.[AvailabilityFrequency],
		[AvailabilityPeriod]=src.[AvailabilityPeriod],
		[ServiceNotAlwaysAvailability]=src.[ServiceNotAlwaysAvailability],
		[CapacityType]=src.[CapacityType],
		[ServiceCapacity]=src.[ServiceCapacity],
		[NormalWaitTime]=src.[NormalWaitTime],
		[TemporaryMessage]=src.[TemporaryMessage],
		[TemporaryMessageAppears]=src.[TemporaryMessageAppears],
		[TemporaryMessageExpires]=src.[TemporaryMessageExpires],
		[EnteredOn]=src.[EnteredOn],
		[UpdatedOn]=src.[UpdatedOn],
		[MadeInactiveOn]=src.[MadeInactiveOn],
		[InternalNotes]=src.[InternalNotes],
		[InternalNotesForEditorsAndViewers]=src.[InternalNotesForEditorsAndViewers],
		[HighlightedResource]=src.[HighlightedResource],
		[LastVerifiedOn]=src.[LastVerifiedOn],
		[LastVerifiedByName]=src.[LastVerifiedByName],
		[LastVerifiedByTitle]=src.[LastVerifiedByTitle],
		[LastVerifiedByPhoneNumber]=src.[LastVerifiedByPhoneNumber],
		[LastVerifiedByEmailAddress]=src.[LastVerifiedByEmailAddress],
		[LastVerificationApprovedBy]=src.[LastVerificationApprovedBy],
		[AvailableForDirectory]=src.[AvailableForDirectory],
		[AvailableForReferral]=src.[AvailableForReferral],
		[AvailableForResearch]=src.[AvailableForResearch],
		[PreferredProvider]=src.[PreferredProvider],
		[ConnectsToSiteNum]=src.[ConnectsToSiteNum],
		[ConnectsToProgramNum]=src.[ConnectsToProgramNum],
		[LanguageOfRecord]=src.[LanguageOfRecord],
		[CurrentWorkflowStepCode]=src.[CurrentWorkflowStepCode],
		[VolunteerOpportunities]=src.[VolunteerOpportunities],
		[VolunteerDuties]=src.[VolunteerDuties],
		[IsLinkOnly]=src.[IsLinkOnly],
		[ProgramAgencyNamePublic]=src.[ProgramAgencyNamePublic],
		[SiteAgencyNamePublic]=src.[SiteAgencyNamePublic],
		[Categories]=src.[Categories],
		[TaxonomyTerm]=src.[TaxonomyTerm],
		[TaxonomyTerms]=src.[TaxonomyTerms],
		[TaxonomyTermsNotDeactivated]=src.[TaxonomyTermsNotDeactivated],
		[TaxonomyCodes]=src.[TaxonomyCodes],
		[Coverage]=src.[Coverage],
		[Hours]=src.[Hours],
		[Custom_Public Comments]=src.[Custom_Public Comments],
		[Custom_Former Names]=src.[Custom_Former Names],
		[Custom_Legal Name]=src.[Custom_Legal Name],
		[Custom_Facebook]=src.[Custom_Facebook],
		[Custom_Instagram]=src.[Custom_Instagram],
		[Custom_LinkedIn]=src.[Custom_LinkedIn],
		[Custom_Twitter]=src.[Custom_Twitter],
		[Custom_YouTube]=src.[Custom_YouTube],
		[Custom_Minimum Age]=src.[Custom_Minimum Age],
		[Custom_Maximum Age]=src.[Custom_Maximum Age],
		[dst].[DATE_MODIFIED]=GETDATE(),
		ORG_LEVEL_1=src.ORG_LEVEL_1,
		ORG_DESCRIPTION=src.ORG_DESCRIPTION,
		LOCATION_NAME=src.LOCATION_NAME,
		LOCATION_DESCRIPTION=src.LOCATION_DESCRIPTION,
		dst.ORG_LOCATION_SERVICE='SITE',
		dst.DELETION_DATE=src.DELETION_DATE,
		dst.SOFT_DELETION_DATE=CASE WHEN src.[Custom_Deleted Record] = 'yes' THEN COALESCE(dst.SOFT_DELETION_DATE,GETDATE()) ELSE NULL END,
		dst.[Custom_Deleted Record]=src.[Custom_Deleted Record]
WHEN NOT MATCHED BY TARGET AND src.TaxonomyLevelName='Site' THEN
	INSERT (
		[ResourceAgencyNum],
		[LangID],
		[PublicName],
		[AlternateName],
		[OfficialName],
		[TaxonomyLevelName],
		[ParentAgency],
		[ParentAgencyNum],
		[RECORD_OWNER],
		[UniqueIDPriorSystem],
		[MailingAttentionName],
		[MailingAddress1],
		[MailingAddress2],
		[MailingCity],
		[MailingCommunity],
		[MailingStateProvince],
		[MailingPostalCode],
		[MailingCountry],
		[MailingAddressIsPrivate],
		[PhysicalAddress1],
		[PhysicalAddress2],
		[PhysicalCity],
		[PhysicalCounty],
		[PhysicalCommunity],
		[PhysicalStateProvince],
		[PhysicalPostalCode],
		[PhysicalCountry],
		[PhysicalAddressIsPrivate],
		[OtherAddress1],
		[OtherAddress2],
		[OtherCity],
		[OtherCounty],
		[OtherCommunity],
		[OtherStateProvince],
		[OtherPostalCode],
		[OtherCountry],
		[Latitude],
		[Longitude],
		[HoursOfOperation],
		[Phone1Number],
		[Phone1Name],
		[Phone1Description],
		[Phone1IsPrivate],
		[Phone1Type],
		[Phone2Number],
		[Phone2Name],
		[Phone2Description],
		[Phone2IsPrivate],
		[Phone2Type],
		[Phone3Number],
		[Phone3Name],
		[Phone3Description],
		[Phone3IsPrivate],
		[Phone3Type],
		[Phone4Number],
		[Phone4Name],
		[Phone4Description],
		[Phone4IsPrivate],
		[Phone4Type],
		[Phone5Number],
		[Phone5name],
		[Phone5Description],
		[Phone5IsPrivate],
		[Phone5Type],
		[PhoneFax],
		[PhoneFaxDescription],
		[PhoneFaxIsPrivate],
		[PhoneTTY],
		[PhoneTTYDescription],
		[PhoneTTYIsPrivate],
		[PhoneTollFree],
		[PhoneTollFreeDescription],
		[PhoneTollFreeIsPrivate],
		[PhoneNumberHotline],
		[PhoneNumberHotlineDescription],
		[PhoneNumberHotlineIsPrivate],
		[PhoneNumberBusinessLine],
		[PhoneNumberBusinessLineDescription],
		[PhoneNumberBusinessLineIsPrivate],
		[PhoneNumberOutOfArea],
		[PhoneNumberOutOfAreaDescription],
		[PhoneNumberOutOfAreaIsPrivate],
		[PhoneNumberAfterHours],
		[PhoneNumberAfterHoursDescription],
		[PhoneNumberAfterHoursIsPrivate],
		[EmailAddressMain],
		[WebsiteAddress],
		[AgencyStatus],
		[AgencyClassification],
		[CoverageArea],
		[CoverageAreaText],
		[Eligibility],
		[EligibilityAdult],
		[EligibilityChild],
		[EligibilityFamily],
		[EligibilityFemale],
		[EligibilityMale],
		[EligibilityTeen],
		[SeniorWorkerName],
		[SeniorWorkerTitle],
		[SeniorWorkerEmailAddress],
		[SeniorWorkerPhoneNumber],
		[SeniorWorkerIsPrivate],
		[MainContactName],
		[MainContactTitle],
		[MainContactEmailAddress],
		[MainContactPhoneNumber],
		[MainContactType],
		[MainContactIsPrivate],
		[LicenseAccreditation],
		[YearIncorporated],
		[AnnualBudgetTotal],
		[LegalStatus],
		[SourceOfFunds],
		[ExcludeFromWebsite],
		[ExcludeFromDirectory],
		[DisabilitiesAccess],
		[PhysicalLocationDescription],
		[BusServiceAccess],
		[PublicAccessTransportation],
		[PaymentMethods],
		[FeeStructureSource],
		[ApplicationProcess],
		[ResourceInfo],
		[DocumentsRequired],
		[LanguagesOffered],
		[LanguagesOfferedList],
		[AvailabilityNumberOfTimes],
		[AvailabilityFrequency],
		[AvailabilityPeriod],
		[ServiceNotAlwaysAvailability],
		[CapacityType],
		[ServiceCapacity],
		[NormalWaitTime],
		[TemporaryMessage],
		[TemporaryMessageAppears],
		[TemporaryMessageExpires],
		[EnteredOn],
		[UpdatedOn],
		[MadeInactiveOn],
		[InternalNotes],
		[InternalNotesForEditorsAndViewers],
		[HighlightedResource],
		[LastVerifiedOn],
		[LastVerifiedByName],
		[LastVerifiedByTitle],
		[LastVerifiedByPhoneNumber],
		[LastVerifiedByEmailAddress],
		[LastVerificationApprovedBy],
		[AvailableForDirectory],
		[AvailableForReferral],
		[AvailableForResearch],
		[PreferredProvider],
		[ConnectsToSiteNum],
		[ConnectsToProgramNum],
		[LanguageOfRecord],
		[CurrentWorkflowStepCode],
		[VolunteerOpportunities],
		[VolunteerDuties],
		[IsLinkOnly],
		[ProgramAgencyNamePublic],
		[SiteAgencyNamePublic],
		[Categories],
		[TaxonomyTerm],
		[TaxonomyTerms],
		[TaxonomyTermsNotDeactivated],
		[TaxonomyCodes],
		[Coverage],
		[Hours],
		[Custom_Public Comments],
		[Custom_Former Names],
		[Custom_Legal Name],
		[Custom_Facebook],
		[Custom_Instagram],
		[Custom_LinkedIn],
		[Custom_Twitter],
		[Custom_YouTube],
		[Custom_Minimum Age],
		[Custom_Maximum Age],
		[DATE_MODIFIED],
		ORG_LEVEL_1,
		ORG_DESCRIPTION,
		LOCATION_NAME,
		LOCATION_DESCRIPTION,
		ORG_LOCATION_SERVICE,
		DELETION_DATE,
		SOFT_DELETION_DATE,
		[Custom_Deleted Record]
	) VALUES (
		src.[ResourceAgencyNum],
		src.LangID,
		src.[PublicName],
		src.[AlternateName],
		src.[OfficialName],
		src.[TaxonomyLevelName],
		src.[ParentAgency],
		src.[ParentAgencyNum],
		LEFT(src.[RECORD_OWNER], 3),
		src.[UniqueIDPriorSystem],
		src.[MailingAttentionName],
		src.[MailingAddress1],
		src.[MailingAddress2],
		src.[MailingCity],
		src.[MailingCommunity],
		src.[MailingStateProvince],
		src.[MailingPostalCode],
		src.[MailingCountry],
		src.[MailingAddressIsPrivate],
		src.[PhysicalAddress1],
		src.[PhysicalAddress2],
		src.[PhysicalCity],
		src.[PhysicalCounty],
		src.[PhysicalCommunity],
		src.[PhysicalStateProvince],
		src.[PhysicalPostalCode],
		src.[PhysicalCountry],
		src.[PhysicalAddressIsPrivate],
		src.[OtherAddress1],
		src.[OtherAddress2],
		src.[OtherCity],
		src.[OtherCounty],
		src.[OtherCommunity],
		src.[OtherStateProvince],
		src.[OtherPostalCode],
		src.[OtherCountry],
		src.[Latitude],
		src.[Longitude],
		src.[HoursOfOperation],
		src.[Phone1Number],
		src.[Phone1Name],
		src.[Phone1Description],
		src.[Phone1IsPrivate],
		src.[Phone1Type],
		src.[Phone2Number],
		src.[Phone2Name],
		src.[Phone2Description],
		src.[Phone2IsPrivate],
		src.[Phone2Type],
		src.[Phone3Number],
		src.[Phone3Name],
		src.[Phone3Description],
		src.[Phone3IsPrivate],
		src.[Phone3Type],
		src.[Phone4Number],
		src.[Phone4Name],
		src.[Phone4Description],
		src.[Phone4IsPrivate],
		src.[Phone4Type],
		src.[Phone5Number],
		src.[Phone5name],
		src.[Phone5Description],
		src.[Phone5IsPrivate],
		src.[Phone5Type],
		src.[PhoneFax],
		src.[PhoneFaxDescription],
		src.[PhoneFaxIsPrivate],
		src.[PhoneTTY],
		src.[PhoneTTYDescription],
		src.[PhoneTTYIsPrivate],
		src.[PhoneTollFree],
		src.[PhoneTollFreeDescription],
		src.[PhoneTollFreeIsPrivate],
		src.[PhoneNumberHotline],
		src.[PhoneNumberHotlineDescription],
		src.[PhoneNumberHotlineIsPrivate],
		src.[PhoneNumberBusinessLine],
		src.[PhoneNumberBusinessLineDescription],
		src.[PhoneNumberBusinessLineIsPrivate],
		src.[PhoneNumberOutOfArea],
		src.[PhoneNumberOutOfAreaDescription],
		src.[PhoneNumberOutOfAreaIsPrivate],
		src.[PhoneNumberAfterHours],
		src.[PhoneNumberAfterHoursDescription],
		src.[PhoneNumberAfterHoursIsPrivate],
		src.[EmailAddressMain],
		src.[WebsiteAddress],
		src.[AgencyStatus],
		src.[AgencyClassification],
		src.[CoverageArea],
		src.[CoverageAreaText],
		src.[Eligibility],
		src.[EligibilityAdult],
		src.[EligibilityChild],
		src.[EligibilityFamily],
		src.[EligibilityFemale],
		src.[EligibilityMale],
		src.[EligibilityTeen],
		src.[SeniorWorkerName],
		src.[SeniorWorkerTitle],
		src.[SeniorWorkerEmailAddress],
		src.[SeniorWorkerPhoneNumber],
		src.[SeniorWorkerIsPrivate],
		src.[MainContactName],
		src.[MainContactTitle],
		src.[MainContactEmailAddress],
		src.[MainContactPhoneNumber],
		src.[MainContactType],
		src.[MainContactIsPrivate],
		src.[LicenseAccreditation],
		src.[YearIncorporated],
		src.[AnnualBudgetTotal],
		src.[LegalStatus],
		src.[SourceOfFunds],
		src.[ExcludeFromWebsite],
		src.[ExcludeFromDirectory],
		src.[DisabilitiesAccess],
		src.[PhysicalLocationDescription],
		src.[BusServiceAccess],
		src.[PublicAccessTransportation],
		src.[PaymentMethods],
		src.[FeeStructureSource],
		src.[ApplicationProcess],
		src.[ResourceInfo],
		src.[DocumentsRequired],
		src.[LanguagesOffered],
		src.[LanguagesOfferedList],
		src.[AvailabilityNumberOfTimes],
		src.[AvailabilityFrequency],
		src.[AvailabilityPeriod],
		src.[ServiceNotAlwaysAvailability],
		src.[CapacityType],
		src.[ServiceCapacity],
		src.[NormalWaitTime],
		src.[TemporaryMessage],
		src.[TemporaryMessageAppears],
		src.[TemporaryMessageExpires],
		src.[EnteredOn],
		src.[UpdatedOn],
		src.[MadeInactiveOn],
		src.[InternalNotes],
		src.[InternalNotesForEditorsAndViewers],
		src.[HighlightedResource],
		src.[LastVerifiedOn],
		src.[LastVerifiedByName],
		src.[LastVerifiedByTitle],
		src.[LastVerifiedByPhoneNumber],
		src.[LastVerifiedByEmailAddress],
		src.[LastVerificationApprovedBy],
		src.[AvailableForDirectory],
		src.[AvailableForReferral],
		src.[AvailableForResearch],
		src.[PreferredProvider],
		src.[ConnectsToSiteNum],
		src.[ConnectsToProgramNum],
		src.[LanguageOfRecord],
		src.[CurrentWorkflowStepCode],
		src.[VolunteerOpportunities],
		src.[VolunteerDuties],
		src.[IsLinkOnly],
		src.[ProgramAgencyNamePublic],
		src.[SiteAgencyNamePublic],
		src.[Categories],
		src.[TaxonomyTerm],
		src.[TaxonomyTerms],
		src.[TaxonomyTermsNotDeactivated],
		src.[TaxonomyCodes],
		src.[Coverage],
		src.[Hours],
		src.[Custom_Public Comments],
		src.[Custom_Former Names],
		src.[Custom_Legal Name],
		src.[Custom_Facebook],
		src.[Custom_Instagram],
		src.[Custom_LinkedIn],
		src.[Custom_Twitter],
		src.[Custom_YouTube],
		src.[Custom_Minimum Age],
		src.[Custom_Maximum Age],
		GETDATE(),
		src.ORG_LEVEL_1,
		src.ORG_DESCRIPTION,
		src.LOCATION_NAME,
		src.LOCATION_DESCRIPTION,
		'SITE',
		src.DELETION_DATE,
		CASE WHEN src.[Custom_Deleted Record] = 'yes' THEN GETDATE() ELSE NULL END,
		src.[Custom_Deleted Record]
	)
OPTION (ROBUST PLAN)
	;

SELECT m.MemberID, m.DefaultEmailNameCIC, m.BaseURLCIC, m.ImportNotificationEmailCIC
FROM dbo.STP_Member m WHERE m.Active=1


RETURN @Error

SET NOCOUNT OFF



GO
GRANT EXECUTE ON  [dbo].[sp_CIC_iCarolImport_Rollup] TO [cioc_login_role]
GO
