(function(){window.init_history_dialog=function(b,e){var h=!1,c=null,l=null,k=null,p=function(a){a.fail?b("#HistoryFieldContent").html("<em>"+a.errinfo+"</em>"):a.compare?(null===c&&(c=new diff_match_patch),a=c.diff_main(a.text2,a.text1),c.diff_cleanupSemantic(a),a=c.diff_prettyHtml(a),b("#HistoryFieldContent").html(a)):b("#HistoryFieldContent").html(a.text1)},q=function(a,f,d){return function(){var f=b("#HistoryLanguage").prop("value"),c=b("#HistoryRevision").prop("value"),g=b("#HistoryCompare").prop("value");
if(g===k||!(""===k&&g===c||""===g&&k===l)){var h=g;if(""===g||g===c)h="";b.getJSON(e.fielddiff_url.replace("[ID]",d).replace("[LANG]",f).replace("[FIELD]",a).replace("[REV]",c).replace("[COMP]",h),p)}l=c;k=g}},m=null,n=function(a,f,d,c){b("select.HistorySelect").unbind("change");b("#HistoryLanguage").unbind("change");b("#field_history").html('<p class="Info">'+e.txt_loading+"</p>").dialog("close").dialog("open").dialog("option","title",e.txt_fielddifftitle+d+" ("+f+")").load(e.fielddiffui_url.replace("[ID]",
d).replace("[FIELD]",a).replace("[LANG]",c),m(a,f,d))},r=function(a,f,c){return function(){var e=b(this).prop("value");n(a,f,c,e)}},m=function(a,c,d){return function(){b("select.HistorySelect").change(q(a,c,d));b("#HistoryLanguage").change(r(a,c,d));l=b("#HistoryRevision").prop("value");k=b("#HistoryCompare").prop("value")}};b(".ShowVersions").click(function(){var a=b(this).data("ciocfield"),c=b(this).data("ciocfielddisplay"),d=b(this).data("ciocid");h||(h=!0,b.getScript(e.path_to_start+"scripts/diff_match_patch.min.js"));
n(a,c,d,"")});b(document).on("click",".FieldHistoryJump",function(a){a=b(a.currentTarget).data("fieldname");(a=document.getElementById("FIELD_"+a))&&a.scrollIntoView(!0)});b(document).on("click",".HistoryFieldsToggle",function(a){b(a.currentTarget).parent().children("ul").toggle("fast")});var s=function(){b(".HistoryFieldsToggle").parent().children("ul").hide()};b(".HistorySummary").click(function(){var a=b(this).data("cioclang"),c=b(this).data("ciocid");b("#revision_history").html("Loading...").load(e.revhistory_url.replace("[ID]",
c).replace("[LANG]",a),s).dialog("open")});b("#revision_history").dialog({autoOpen:!1,width:330,height:280,position:["right","top"],resizable:!1,dialogClass:"RevHistory"});b("#field_history").dialog({autoOpen:!1,width:620,height:280,position:["right","bottom"]});b(".RevHistory.ui-dialog").css({position:"fixed"})}})();
