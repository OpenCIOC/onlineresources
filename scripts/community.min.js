window.CIOC={};
(function(b,c){c.do_drop_down_navigation=function(){for(var a=b.getElementById("ActionList").options,d=0;d<a.length;d++)if(a[d].selected){var f=a[d].getAttribute("href");f&&("undefined"!=typeof a[d].attributes.newwindow?c.open(f):c.location.href=f);break}};jQuery(function(a){a("[data-toggle=dialog]").each(function(){var d=a(this),b=a(d.data("target")),c={autoOpen:!1,title:b.data("title"),modal:b.data("modal")};b.dialog(c);d.click(function(){b.dialog("isOpen")?b.dialog("close"):b.dialog("open")})})})})(document,window);
function CheckAll(b,c){b||(b="IDList");var a=c;c||(a=document.RecordList);for(var d=a.elements.length,f=0;f<d;f++){var e=a.elements[f];e.name===b&&(e.checked=!0)}}function ClearAll(b,c){b||(b="IDList");var a=c;c||(a=document.RecordList);for(var d=a.elements.length,f=0;f<d;f++){var e=a.elements[f];e.name===b&&(e.checked=!1)}}function add_class(b,c){b&&!(new RegExp("\\b"+c+"\\b")).test(b.className)&&(b.className&&(c=" "+c),b.className+=c)}
function remove_class(b,c){if(b){for(var a=b.className.split(" "),d=[],f=0;f<a.length;f++){var e=a[f];e!==c&&d.push(e)}b.className=d.join(" ")}}function hide(b){add_class(b,"NotVisible")}function show(b){remove_class(b,"NotVisible")}function openWin(b,c){window.open(b,c,"toolbar=no,width=490,height=485,location=no,scrollBars=yes,resizable=no,titlebar=yes").focus()}
function openWinL(b,c){window.open(b,c,"toolbar=no,width=650,height=520,location=no,scrollBars=yes,resizable=no,titlebar=yes").focus()}function openWinXL(b,c){window.open(b,c,"toolbar=no,width=755,height=550,location=no,scrollBars=yes,resizable=no,titlebar=yes").focus()}jQuery(function(b){var c={sm:openWin,lg:openWinL,xl:openWinXL};b(document).on("click","a.poplink",function(){var a=b(this).data("popargs");(c[a.size||"sm"]||openWin)(this.href,a.name||"popwin");return!1})});
(function(){var b=jQuery,c={},a=function(a){null!==a&&"undefined"!==typeof a?b("#myListCount").text(a):(a=b("#myListCount").text())&&(a=parseInt(a,10));a?c.myListLink.show():c.myListLink.hide()},d=function(a){b.each(a,function(a,d){b("#added_to_list_"+d).show();b("#add_to_list_"+d).hide()})},f=function(f){return function(e){e.fail?alert(e.errinfo):(e.ids?a(b.grep(e.ids,k[c.domain]).length):e.count?a(e.count):a(0),d([f]))}},e=function(a){a=b(a.currentTarget).data("id");b.ajax({success:f(a),dataType:"json",
error:function(){alert("Error")},data:{id:a},type:"POST",url:c.current_list_url})},l=function(a){return function(d){if(d.fail)alert(d.errinfo);else{d=!0;if(a){var c=b("#results_table #remove_from_list_"+a);c.length?c.parent().parent().remove():(d=!1,c=b("#results_container #remove_from_list_"+a),c.parents(".dlist-result").remove())}c=!1;if((c=d?1===b("#results_table tr").length:0===b("#results_container .dlist-result").length)||!a)b("#records_ui").hide(),b("#no_records_message").show()}}},g=function(a){a=
b(a.currentTarget).data("id");b.ajax({success:l(a),dataType:"json",error:function(){alert("Error")},data:{ID:a,RemoveItem:c.domain},type:"POST",url:c.current_list_url})},h=function(a){b.ajax({success:l(),dataType:"json",error:function(){alert("Error")},data:{ID:"all",RemoveItem:c.domain},type:"POST",url:c.current_list_url})},k={CIC:function(a){return/^[A-Za-z]{3}[0-9]{4,5}$/.test(a)},VOL:function(a){return/^[1-9][0-9]*$/.test(a)}},n=function(f){if(f.fail)p();else if(f.inrequest){var e=b.grep(f.ids,
k[c.domain]);d(e);a(e.length);(f=f.previous_ids)&&b.each(f,function(a,d){b("#ct_added_to_previous_request_"+d).show()});b(".ListUI img").prop("src",function(a,d){return d.replace("list","referral")});b("#list_header_text").hide();b("#ct_header_text").show();c.current_list_url=c.ct_update_url;s()}else p()},p=function(){var f=function(){c.list_view_mode||d(c.already_added||[]);c.current_list_url=c.list_view_mode&&"ct"===c.list_view_mode?c.ct_update_url:c.list_update_url;a((c.already_added||[]).length);
s()};c.list_view_mode||c.has_session?f():b.ajax({dataType:"json",error:null,url:c.list_update_url,data:{SessionTest:"on"},type:"POST",success:function(a){a.has_session&&f()}})},s=function(){b(".HideListUI").delegate(".add_to_list","click",e).delegate(".remove_from_list","click",g).removeClass("HideListUI");b("#remove_all_from_list").click(h);b.browser.msie&&"8.0">b.browser.msie&&b(".ListUI").removeClass("FixIE")};window.init_list_adder=function(a){c=a;c.myListLink=b("#myListLink").parent(":hidden").add("#myListLink");
a.in_request?b.ajax({success:n,dataType:"json",error:null,type:"POST",url:a.in_request}):p()}})();this.JSON||(this.JSON={});
(function(){function b(a){return 10>a?"0"+a:a}function c(a){f.lastIndex=0;return f.test(a)?'"'+a.replace(f,function(a){var d=g[a];return"string"===typeof d?d:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function a(d,b){var f,g,r,t,u=e,q,m=b[d];m&&"object"===typeof m&&"function"===typeof m.toJSON&&(m=m.toJSON(d));"function"===typeof h&&(m=h.call(b,d,m));switch(typeof m){case "string":return c(m);case "number":return isFinite(m)?String(m):"null";case "boolean":case "null":return String(m);
case "object":if(!m)return"null";e+=l;q=[];if("[object Array]"===Object.prototype.toString.apply(m)){t=m.length;for(f=0;f<t;f+=1)q[f]=a(f,m)||"null";r=0===q.length?"[]":e?"[\n"+e+q.join(",\n"+e)+"\n"+u+"]":"["+q.join(",")+"]";e=u;return r}if(h&&"object"===typeof h)for(t=h.length,f=0;f<t;f+=1)g=h[f],"string"===typeof g&&(r=a(g,m))&&q.push(c(g)+(e?": ":":")+r);else for(g in m)Object.hasOwnProperty.call(m,g)&&(r=a(g,m))&&q.push(c(g)+(e?": ":":")+r);r=0===q.length?"{}":e?"{\n"+e+q.join(",\n"+e)+"\n"+
u+"}":"{"+q.join(",")+"}";e=u;return r}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,l,g={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;"function"!==typeof JSON.stringify&&(JSON.stringify=function(d,b,f){var c;l=e="";if("number"===typeof f)for(c=0;c<f;c+=1)l+=" ";else"string"===typeof f&&(l=f);if((h=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return a("",{"":d})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,b){function f(a,d){var c,e,m=a[d];if(m&&"object"===typeof m)for(c in m)Object.hasOwnProperty.call(m,c)&&(e=f(m,c),void 0!==e?m[c]=e:delete m[c]);return b.call(a,d,m)}var c;a=String(a);d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return c=eval("("+a+")"),"function"===typeof b?f({"":c},""):c;throw new SyntaxError("JSON.parse");})})();
(function(){window.get_form_values=function(b){var c={};jQuery(b).find("input,select,textarea").each(function(a){if(this.name)if(c[this.name]||(c[this.name]=[]),"select"===this.nodeName.toLowerCase()){var d=c[this.name];$(this).find("option").each(function(a){this.selected&&d.push(this.value)})}else("input"!==this.nodeName.toLowerCase()||"checkbox"!==this.type&&"radio"!==this.type||this.checked)&&c[this.name].push(this.value||"")});return c};window.restore_form_values=function(b,c){var a=jQuery;a(b).find("input,select,textarea").each(function(d){if(this.name){var b=
c[this.name];"undefined"!=typeof b&&null!==b&&("input"!==this.nodeName.toLowerCase()||"checkbox"!==this.type&&"radio"!==this.type?"select"===this.nodeName.toLowerCase()?a(this).find("option").each(function(d){this.selected=1<b.length?0<=a.inArray(this.value,b):0===b.length?!1:this.value===b[0]}):this.value=b.length?b[0]:"":this.checked=1<b.length?0<=a.inArray(this.value,b):0===b.length?!1:this.value===b[0])}})};window.init_cached_state=function(b){var c=jQuery;b=b||"#EntryForm";onbeforeunload_fns=
[];onbeforerestorevalues_fns=[];c(window).on("beforeunload",function(){var a={form_values:get_form_values(b)};c.each(onbeforeunload_fns,function(d,b){b(a)});document.getElementById("cache_form_values").value=JSON.stringify(a)});window.cache_register_onbeforeunload=function(a){onbeforeunload_fns.push(a)};window.cache_register_onbeforerestorevalues=function(a){onbeforerestorevalues_fns.push(a)};window.restore_cached_state=function(){var a=document.getElementById("cache_form_values");if(a&&a.value){var d=
JSON.parse(a.value);c.each(onbeforerestorevalues_fns,function(a,b){b(d)});restore_form_values(b,d.form_values)}}}})();
(function(){var b=jQuery,c={"en-CA":"d M yy",de:"dd.mm.yy",fr:"d M yy",it:"d M yy",nl:"d M yy",no:"d M yy",pt:"d-mm-yy",sv:"d M yy",hu:"M d. yy",ro:"d M yy",hr:"d M yy",sl:"d M yy",bg:"d MM yy",ru:"d M yy",tr:"d M yy",lv:"d M yy",lt:"d M yy",ko:"yy/mm/dd","zh-CN":"yy/mm/dd",th:"d M yy"},a={"en-CA":!0,"":!0},d={},f={"fr-CA":"fr","es-MX":"es"},e=function(){var a=b(this),d=a.data("culture"),f=c[d]||b.datepicker.regional[d].dateFormat,e={};a.hasClass("NoYear")&&(f=f.replace(/[\- .\/]*yy[\/]?/,""),e={beforeShow:function(a,
d){d.dpDiv.addClass("NoYearDatePicker")},onClose:function(a,d){d.dpDiv.removeClass("NoYearDatePicker")},changeYear:!1});e.dateFormat=f;a.datepicker(b.extend({},b.datepicker.regional[d],e)).prop("autocomplete","off")},l=function(c){b.getScript("//ajax.googleapis.com/ajax/libs/jqueryui/"+b.ui.version+"/i18n/jquery.ui.datepicker-"+c+".min.js",function(){a[c]=!0;b.each(d[c],function(){e.call(this)});delete d[c]})};b.datepicker.regional["en-CA"]=b.extend({},b.datepicker.regional[""]);b.fn.extend({autodatepicker:function(){return this.each(function(){var c=
b(this),h;h=c.parents("[lang]").first().prop("lang")||"en-CA";h=f[h]||h;c.data("culture",h);a[h]?e.call(this):(c=d[h],c||(c=d[h]=[],l(h)),c.push(this))})}});jQuery(function(){b("input.DatePicker").autodatepicker()})})();
(function(b){function c(a){return a&&a.constructor===Number?a+"px":a}b.fn.bgiframe=b.browser.msie&&/msie 6\.0/i.test(navigator.userAgent)?function(a){a=b.extend({top:"auto",left:"auto",width:"auto",height:"auto",opacity:!0,src:"javascript:false;"},a);var d='<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+a.src+'"style="display:block;position:absolute;z-index:-1;'+(!1!==a.opacity?"filter:Alpha(Opacity='0');":"")+"top:"+("auto"==a.top?"expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+'px')":
c(a.top))+";left:"+("auto"==a.left?"expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+'px')":c(a.left))+";width:"+("auto"==a.width?"expression(this.parentNode.offsetWidth+'px')":c(a.width))+";height:"+("auto"==a.height?"expression(this.parentNode.offsetHeight+'px')":c(a.height))+';"/>';return this.each(function(){0===b(this).children("iframe.bgiframe").length&&this.insertBefore(document.createElement(d),this.firstChild)})}:function(){return this};b.fn.bgIframe=b.fn.bgiframe})(jQuery);
(function(){var b=function(a){a=a.toLowerCase();a=a.replace(RegExp("[\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5]","g"),"a");a=a.replace(RegExp("\u00e6","g"),"ae");a=a.replace(RegExp("\u00e7","g"),"c");a=a.replace(RegExp("[\u00e8\u00e9\u00ea\u00eb]","g"),"e");a=a.replace(RegExp("[\u00ec\u00ed\u00ee\u00ef]","g"),"i");a=a.replace(RegExp("\u00f1","g"),"n");a=a.replace(RegExp("[\u00f2\u00f3\u00f4\u00f5\u00f6]","g"),"o");a=a.replace(RegExp("\u009c","g"),"oe");a=a.replace(RegExp("[\u00f9\u00fa\u00fb\u00fc]","g"),
"u");return a=a.replace(RegExp("[\u00fd\u00ff]","g"),"y")};window.string_ci_ai=b;var c=function(a,c,e,l,g){e=e||"value";l=l||"";g=g||"";return function(h,k){if(c.term&&(new RegExp(l+a.ui.autocomplete.escapeRegex(c.term)+g,"i")).test(h.term)&&c.content&&13>c.content.length){var n=new RegExp(l+a.ui.autocomplete.escapeRegex(h.term)+g,"i");k(a.grep(c.content,function(a){return n.test(b(a[e]))}));return!0}return!1}};window.default_cache_search_fn=c;var a=function(a,f,e,l,g){e=e||{};g=g||c(a,e,l||"value");
return function(c,k,n){c.term=b(c.term);e.term===c.term&&e.content?k(e.content):g(c,k)||a.ajax({url:n||f,dataType:"json",data:c,cache:!1,success:function(a){e.term=c.term;e.content=a;k(a)}})}};window.create_caching_source_fn=a;window.init_community_autocomplete=function(c,f,e,l,g){var h={};g&&(g=c(g));g&&!g.length&&(g=null);var k=c("#"+f).autocomplete({focus:function(a,b){return!1},select:function(a,b){k.data({chkid:b.item.chkid,display:b.item.value})},source:a(c,e,h),minLength:l}).keypress(function(a){"13"==
a.keyCode&&(a.preventDefault(),k.autocomplete("close"))});g&&(k.parents("form").on("submit",function(){var a=k.val();if(k.data("display")===a)g.val(k.data("chkid"));else{if(h.content){var f=b(a),a=c.grep(h.content,function(a){return b(a.value)===f});if(1===a.length){g.val(a[0].chkid);k.data({chkid:a[0].chkid,display:a[0].value}).val(a[0].value);return}}g.val("")}}),cache_register_onbeforerestorevalues(function(a){k.length&&(a=a["autocomplete_data_"+k[0].id])&&k.data(a)}),cache_register_onbeforeunload(function(a){if(k.length){var b=
k.data();b.display&&b.chkid&&(a["autocomplete_data_"+k[0].id]={display:b.display,chkid:b.chkid})}}))}})();
(function(){window.entryform=window.entryform||{};window.create_checklist_onbefore_fns=function(a,b,c,e){cache_register_onbeforeunload(function(a){a[b+"_added"]=c});cache_register_onbeforerestorevalues(function(c){(c=c[b+"_added"])&&a.each(c,function(a,b){e(b.chkid,b.display,"")})})};window.basic_chk_add_html=function(a,b){return function(c,e){var l=a("<tr>").append(a("<td>").append(a("<input>").prop({id:b+"_ID_"+c,type:"checkbox",checked:!0,defaultChecked:!0,name:b+"_ID",value:c})).append(document.createTextNode(" "+
e))).append(a("<td>").append(a("<input>").prop({id:b+"_NOTES_"+c,name:b+"_NOTES_"+c,size:entryform.chk_notes_size,maxlength:entryform.chk_notes_maxlen})));a("#"+b+"_existing_add_table").append(l);return l.find('input[type="checkbox"]')[0]}};var b={},c=function(a){$("#NEW_"+a).autocomplete(b[a])};window.init_autocomplete_checklist=function(a,d){var f=d.field;if(!b[f]){var e=d.source;d.minLength=d.minLength||1;d.delay=d.delay||300;d.add_new_html=d.add_new_html||basic_chk_add_html(a,f);d.match_prop=
d.match_prop||"value";d.txt_not_found=d.txt_not_found||"Not Found";var l=a(d.delegate_root||document),g=d.added_values||[],h=function(a,b,c){var e=document.getElementById(f+"_ID_"+a);e?(e.checked=!0,d.after_add_new_value&&d.after_add_new_value.call(e)):(g.push({chkid:a,display:b,label:c}),a=d.add_new_html(a,b,c),d.after_add_new_value&&d.after_add_new_value.call(a))};create_checklist_onbefore_fns(a,f,g,h);var k={},n=function(b){a("#NEW_"+f).data({chkid:"",display:"",label:""}).prop("value","").focus();
a("#"+f+"_error").hide("slow",function(){a(this).remove()})},p=null,s=null;(function(b){a.isArray(b)?(s=function(c,f){var e=new RegExp(a.ui.autocomplete.escapeRegex(string_ci_ai(c.term)));f(a.grep(b,function(a){return e.test(string_ci_ai(a[d.match_prop]||a))}))},p=function(c,f){var e=string_ci_ai(c),m=a.grep(b,function(a){return string_ci_ai(string_ci_ai(a[d.match_prop]||a))===e});if(1===m.length)return f(m[0]),!0;f()}):"string"===typeof b?(s=create_caching_source_fn(a,b,k,d.match_prop),p=function(b,
c,f){var e=string_ci_ai(b);if(k.content){var h=a.grep(k.content,function(a){return string_ci_ai(a[d.match_prop])===e});if(1===h.length){c(h[0]);return}}f||string_ci_ai(k.term||"")===e?c():s({term:e},function(a){p(b,c,!0)})}):(s=b,p=d.look_for_fn)})(e);l.on("click","#add_"+f,function(b){b=a("#NEW_"+f);var c=b.data("chkid"),e=b.data("display"),k=b.data("label"),m=b[0].value;if(c&&e&&e==m)return h(c,e,k),n(),!1;p(b[0].value,function(b){b?(h(b.chkid,b.value,b.label),n()):0===a("#"+f+"_error").length&&
(a("#"+f+"_new_input_table").before(a("<p>").hide().addClass("Alert").prop("id",f+"_error").append(document.createTextNode(d.txt_not_found))),a("#"+f+"_error").show("slow"))});return!1});b[f]={focus:function(a,b){return!1},source:s,minLength:d.minLength,delay:d.delay,select:function(b,c){a("#NEW_"+f).data({chkid:c.item.chkid,display:c.item.value,label:c.item.label})}};l.on("keypress","#NEW_"+f,function(b){"13"==b.keyCode&&(b.preventDefault(),a("#NEW_"+f).autocomplete("close"),a("#add_"+f).trigger("click"))})}c(f)};
window.init_languages=function(a,b){var c=null,e=null,l=a("#LN_existing_add_table"),g=function(){var b=a(this).parents(".language-entry").find(".language-details-notes");this.checked?b.slideDown():b.slideUp()};init_autocomplete_checklist(a,{field:"LN",source:entryform.languages_source,txt_not_found:b,after_add_new_value:g,add_new_html:function(b,d){null===c&&(c=a("#add_LN"),e=c.data("newTemplate"));var g=e.replace(/LANGNAMELANGNAME/g,d).replace(/IDIDID/g,b);l.append(g)}});l.on("change",".language-primary",
g).uitooltip({items:"[data-help-text]",content:function(){return'<div class="language-help-text">'+a(this).data("helpText")+"</div>"},position:{my:"center bottom-20",at:"center top",using:function(b,c){a(this).css(b);a("<div>").addClass("arrow").addClass(c.vertical).addClass(c.horizontal).appendTo(this)}}});window.languages_check_state=g}})();
(function(){window.only_items_chk_add_html=function(b,c,a){return function(d,f){a&&a();b("#"+c+"_existing_add_container").append(b("<label>").append(b("<input>").prop({id:c+"_ID_"+d,type:"checkbox",checked:!0,defaultChecked:!0,name:c+"_ID",value:d})).append("&nbsp;").append(document.createTextNode(f))).append(" ; ")}};window.init_check_for_autochecklist=function(b){var c=jQuery,a=function(){var a=c(this).data("jump_location");(a=document.getElementById(a))&&a.scrollIntoView(!0)},d=function(){return c("<li>").append(c("<span>").data("jump_location",
this.id).addClass("UnaddedChecklistJump SimulateLink").append(c(this).parentsUntil("td[data-field-display-name]").parent().data("fieldDisplayName")))},f=c("input[id^=NEW_]");f.length&&(c("#EntryForm").submit(function(a){var l=f.map(function(){return this.value?this:null}),g;if(l.length&&!a.isDefaultPrevented()){if(!confirm(b)){a.preventDefault();c("#SUBMIT_BUTTON").prop("disabled",!1);a=c("#unadded_checklist_error_box");g=c("#unadded_checklist_error_list");var h=a.is(":visible");h&&g.children("ul:first").hide("slow",
function(){c(this).remove()});var k=c("<ul>");h&&k.hide();g.append(k);c.each(l.map(d),function(){k.append(this)});h?k.show("slow"):a.show("slow")}}else a.isDefaultPrevented()&&(a=c("#unadded_checklist_error_box"),g=c("#unadded_checklist_error_list"),a.hide("slow",function(){g.children().remove()}))}),c(document).on("click",".UnaddedChecklistJump",a))};window.init_entryform_items=function(b,c,a){var d=jQuery;b.each(function(){var b=null,e=this,l=d(e),g=1,h=l.find(".EntryFormItemContainerIds")[0];if(h){var k=
l.data("maxAdd");k&&(k=parseInt(k,10));var n=[];h.value&&(n=d.map(h.value.split(","),function(a){return 0===a.indexOf("NEW")?null:a}));var p={},s=function(){l.find(".EntryFormItemBox").each(function(a){d(this).find(".EntryFormItemCount").text(a+1)})},r=function(a){if(k){var b=l.find(".EntryFormItemContent:hidden").parent().find("button.EntryFormItemDelete").prop("disabled",!a);q.prop("disabled",!a);a?(b.removeClass("ui-state-disabled"),q.removeClass("ui-state-disabled")):(b.addClass("ui-state-disabled"),
q.addClass("ui-state-disabled"))}},t=function(){var a=0,b;for(b in p)a++;return n.length-a},u=function(a){var c=0;if(k&&!a&&(c=t(),c>=k)){alert("over");return}var e=l.data("addTmpl");n.push("NEW"+g++);h.value=n.join(",");e=d(e.replace(/\[COUNT\]/g,n.length).replace(/\[ID\]/g,n[n.length-1]));e.find(".DatePicker").autodatepicker();e.find(".Province").combobox({source:window.cioc_province_source});entryform.service_titles&&e.find(".ServiceTitleField").combobox({source:entryform.service_titles});l.append(e);
b&&(b.sortable("refresh"),s());k&&!a&&c+1===k&&r(!1)},q=l.parent().find(".EntryFormItemAdd").click(function(){u(!1)});l.on("click","button.EntryFormItemDelete",function(){var b=this,e=d(this).parents(".EntryFormItemBox").find(".EntryFormItemContent"),f=this.id.split("_"),f=f[f.length-2];if(e.is(":visible"))e.hide("slow",function(){p[f]=get_form_values(e);d(b).text(a);e.find("input,select,textarea").each(function(){"input"!==this.nodeName.toLowerCase()||"checkbox"!==this.type&&"radio"!==this.type?
"select"===this.nodeName.toLowerCase()?d(this).find("option").each(function(){this.selected=!1}):this.value="":this.checked=!1});r(!0)});else{var g=0;if(k&&(g=t(),g>=k)){alert("over");return}var h=p[f];h&&(delete p[f],restore_form_values(e,h),e.show("slow",function(){d(b).text(c)}),k&&g+1===k&&r(!1))}});l.hasClass("sortable")&&(b=l.sortable({items:".EntryFormItemBox"}),b.bind("sortstart",function(a,b){b.helper.bgiframe();l.addClass("sorting")}),b.bind("sortstop",function(){var a=b.sortable("toArray");
n=d.map(a,function(a){a=a.split("_");return a[a.length-2]});h.value=n.join(",");setTimeout(function(){l.removeClass("sorting");s()},1)}));cache_register_onbeforeunload(function(a){a[e.id+"_ids"]=n;a[e.id+"_deletes"]=p;b&&(a[e.id+"_order"]=b.sortable("toArray"))});cache_register_onbeforerestorevalues(function(c){c[e.id+"_ids"]&&d.each(c[e.id+"_ids"],function(a,b){0===b.indexOf("NEW")&&u(!0)});c[e.id+"_deletes"]&&(p=c[e.id+"_deletes"],l.find(".EntryFormItemContent").each(function(){var b=this.id.split("_"),
b=b[b.length-2];p[b]&&d(this).hide().parent().find("button.EntryFormItemDelete").text(a)}));k&&t()>=k&&r(!1);b&&(c=c[e.id+"_order"])&&(c.reverse(),d.each(c,function(a,b){d("#"+b).detach().prependTo(l)}),b.sortable("refresh"),s())})}})};window.init_schedule=function(b){var c=function(){var a=b(this).parents(".EntryFormItemBox"),c=this.value;"0"===c?a.find(".recurs-ui").hide():"1"==c?(a.find(".repeat-every-ui, .repeats-on-ui, .recurs-week-label").show(),a.find(".repeat-week-of-month-ui, .repeat-day-of-month-ui, .recurs-month-label").hide()):
"2"==c?(a.find(".repeat-every-ui, .repeat-day-of-month-ui, .recurs-month-label").show(),a.find(".repeat-week-of-month-ui, .repeats-on-ui, .recurs-week-label").hide()):(a.find(".repeat-week-of-month-ui, .repeats-on-ui, .recurs-month-label").show(),a.find(".repeat-every-ui, .repeat-day-of-month-ui, .recurs-week-label").hide())};b("#ScheduleEditArea").on("change",".recur-type-selector",c).find(".recur-type-selector").each(c)}})();
(function(){var b=jQuery;window.init_municipality_autocomplete=function(c,a,d){c.each(function(){var c={},e=this,l=this.id.replace("Web",""),g=b("#"+l),h=b(this).data("cm_info",{value:this.value,chkid:g[0].value}).autocomplete({focus:function(a,b){return!1},source:create_caching_source_fn(b,a,c),minLength:1,close:function(){h.is(":focus")||k()}}).keypress(function(a){"13"==a.keyCode&&(a.preventDefault(),h.autocomplete("close"))}),k=function(){var a=h.data("cm_info"),k=e.value,l;if(k)if(a&&a.chkid&&
a.value&&a.value===k)g[0].value=a.chkid;else{l=string_ci_ai(k);if(c.content&&(a=b.grep(c.content,function(a){return string_ci_ai(a.value)===l}),1===a.length)){g[0].value=a[0].chkid;h.data("cm_info",a[0]);return}setTimeout(function(){h[0].focus()},1);alert(d)}else g[0].value=""};h.blur(function(){h.autocomplete("widget").is(":visible")||k()})})}})();
(function(){window.init_cm_checklist=function(b,c,a){var d={},f=create_caching_source_fn(b,c,d,"label"),e=a.parent_cmid_input||null,l=9999,g=b("#cm-checklist-template").html(),h=b("#cm-checklist-target");c=e?function(a,b,c){a.parent=e.val();return f(a,b,c)}:f;var k=function(c,e,g){var h=string_ci_ai(c);if(d.content){var l=b.grep(d.content,function(b){return string_ci_ai(b[a.match_prop])===h});if(1===l.length){e(l[0]);return}}g||string_ci_ai(d.term||"")===h?e():f({term:h},function(a){k(c,e,!0)})};
a.parent_cmid_input&&(e=b(a.parent_cmid_input));a.source=c;a.look_for_fn=k;a.add_new_html=function(a,c){to_add=b(g.replace(/\[COUNT\]/g,l++).replace(/\[ID\]/g,a).replace(/\[LABEL\]/g,b("<div>").text(c).html()));h.is(":hidden")?h.removeClass("hidden").append(to_add):h.append(to_add);return!1};init_autocomplete_checklist(b,a)};window.init_community_edit=function(b){var c=9999,a=null,d=null;b("#add-alternate-name").click(function(f){var e=null;f.preventDefault();a||(a=b("#alt-name-template").html(),
d=b("#alt-name-target"));e=b(a.replace(/\[COUNT\]/g,c++));d.is(":hidden")?d.removeClass("hidden").append(e):d.append(e);return!1})}})();
