window.CIOC={};
(function(c,d){d.do_drop_down_navigation=function(){for(var b=c.getElementById("ActionList").options,a=0;a<b.length;a++)if(b[a].selected){var f=b[a].getAttribute("href");f&&("undefined"!=typeof b[a].attributes.newwindow?d.open(f):d.location.href=f);break}};jQuery(function(b){b("[data-toggle=dialog]").each(function(){var a=b(this),c=b(a.data("target")),d={autoOpen:!1,title:c.data("title"),modal:c.data("modal")};c.dialog(d);a.click(function(){c.dialog("isOpen")?c.dialog("close"):c.dialog("open")})})})})(document,window);
function CheckAll(c,d){c||(c="IDList");var b=d;d||(b=document.RecordList);for(var a=b.elements.length,f=0;f<a;f++){var e=b.elements[f];e.name===c&&(e.checked=!0)}}function ClearAll(c,d){c||(c="IDList");var b=d;d||(b=document.RecordList);for(var a=b.elements.length,f=0;f<a;f++){var e=b.elements[f];e.name===c&&(e.checked=!1)}}function add_class(c,d){c&&!(new RegExp("\\b"+d+"\\b")).test(c.className)&&(c.className&&(d=" "+d),c.className+=d)}
function remove_class(c,d){if(c){for(var b=c.className.split(" "),a=[],f=0;f<b.length;f++){var e=b[f];e!==d&&a.push(e)}c.className=a.join(" ")}}function hide(c){add_class(c,"NotVisible")}function show(c){remove_class(c,"NotVisible")}function openWin(c,d){window.open(c,d,"toolbar=no,width=490,height=485,location=no,scrollBars=yes,resizable=no,titlebar=yes").focus()}
function openWinL(c,d){window.open(c,d,"toolbar=no,width=650,height=520,location=no,scrollBars=yes,resizable=no,titlebar=yes").focus()}function openWinXL(c,d){window.open(c,d,"toolbar=no,width=755,height=550,location=no,scrollBars=yes,resizable=no,titlebar=yes").focus()}jQuery(function(c){var d={sm:openWin,lg:openWinL,xl:openWinXL};c(document).on("click","a.poplink",function(){var b=c(this).data("popargs");(d[b.size||"sm"]||openWin)(this.href,b.name||"popwin");return!1})});
(function(){var c=jQuery,d={},b=function(a){null!==a&&"undefined"!==typeof a?c("#myListCount").text(a):(a=c("#myListCount").text())&&(a=parseInt(a,10));a?d.myListLink.show():d.myListLink.hide()},a=function(a){c.each(a,function(a,b){c("#added_to_list_"+b).show();c("#add_to_list_"+b).hide()})},f=function(f){return function(e){e.fail?alert(e.errinfo):(e.ids?b(c.grep(e.ids,k[d.domain]).length):e.count?b(e.count):b(0),a([f]))}},e=function(a){a=c(a.currentTarget).data("id");c.ajax({success:f(a),dataType:"json",
error:function(){alert("Error")},data:{id:a},type:"POST",url:d.current_list_url})},l=function(a){return function(b){if(b.fail)alert(b.errinfo);else{b=!0;if(a){var d=c("#results_table #remove_from_list_"+a);d.length?d.parent().parent().remove():(b=!1,d=c("#results_container #remove_from_list_"+a),d.parents(".dlist-result").remove())}d=!1;if((d=b?1===c("#results_table tr").length:0===c("#results_container .dlist-result").length)||!a)c("#records_ui").hide(),c("#no_records_message").show()}}},g=function(a){a=
c(a.currentTarget).data("id");c.ajax({success:l(a),dataType:"json",error:function(){alert("Error")},data:{ID:a,RemoveItem:d.domain},type:"POST",url:d.current_list_url})},h=function(a){c.ajax({success:l(),dataType:"json",error:function(){alert("Error")},data:{ID:"all",RemoveItem:d.domain},type:"POST",url:d.current_list_url})},k={CIC:function(a){return/^[A-Za-z]{3}[0-9]{4,5}$/.test(a)},VOL:function(a){return/^[1-9][0-9]*$/.test(a)}},n=function(f){if(f.fail)p();else if(f.inrequest){var e=c.grep(f.ids,
k[d.domain]);a(e);b(e.length);(f=f.previous_ids)&&c.each(f,function(a,b){c("#ct_added_to_previous_request_"+b).show()});c(".ListUI img").prop("src",function(a,b){return b.replace("list","referral")});c("#list_header_text").hide();c("#ct_header_text").show();d.current_list_url=d.ct_update_url;s()}else p()},p=function(){var f=function(){d.list_view_mode||a(d.already_added||[]);d.current_list_url=d.list_view_mode&&"ct"===d.list_view_mode?d.ct_update_url:d.list_update_url;b((d.already_added||[]).length);
s()};d.list_view_mode||d.has_session?f():c.ajax({dataType:"json",error:null,url:d.list_update_url,data:{SessionTest:"on"},type:"POST",success:function(a){a.has_session&&f()}})},s=function(){c(".HideListUI").delegate(".add_to_list","click",e).delegate(".remove_from_list","click",g).removeClass("HideListUI");c("#remove_all_from_list").click(h);c.browser.msie&&"8.0">c.browser.msie&&c(".ListUI").removeClass("FixIE")};window.init_list_adder=function(a){d=a;d.myListLink=c("#myListLink").parent(":hidden").add("#myListLink");
a.in_request?c.ajax({success:n,dataType:"json",error:null,type:"POST",url:a.in_request}):p()}})();this.JSON||(this.JSON={});
(function(){function c(a){return 10>a?"0"+a:a}function d(a){f.lastIndex=0;return f.test(a)?'"'+a.replace(f,function(a){var b=g[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function b(a,c){var f,g,r,t,u=e,q,m=c[a];m&&"object"===typeof m&&"function"===typeof m.toJSON&&(m=m.toJSON(a));"function"===typeof h&&(m=h.call(c,a,m));switch(typeof m){case "string":return d(m);case "number":return isFinite(m)?String(m):"null";case "boolean":case "null":return String(m);
case "object":if(!m)return"null";e+=l;q=[];if("[object Array]"===Object.prototype.toString.apply(m)){t=m.length;for(f=0;f<t;f+=1)q[f]=b(f,m)||"null";r=0===q.length?"[]":e?"[\n"+e+q.join(",\n"+e)+"\n"+u+"]":"["+q.join(",")+"]";e=u;return r}if(h&&"object"===typeof h)for(t=h.length,f=0;f<t;f+=1)g=h[f],"string"===typeof g&&(r=b(g,m))&&q.push(d(g)+(e?": ":":")+r);else for(g in m)Object.hasOwnProperty.call(m,g)&&(r=b(g,m))&&q.push(d(g)+(e?": ":":")+r);r=0===q.length?"{}":e?"{\n"+e+q.join(",\n"+e)+"\n"+
u+"}":"{"+q.join(",")+"}";e=u;return r}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var a=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,l,g={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,c,f){var d;l=e="";if("number"===typeof f)for(d=0;d<f;d+=1)l+=" ";else"string"===typeof f&&(l=f);if((h=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return b("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(b,c){function f(a,b){var d,e,m=a[b];if(m&&"object"===typeof m)for(d in m)Object.hasOwnProperty.call(m,d)&&(e=f(m,d),void 0!==e?m[d]=e:delete m[d]);return c.call(a,b,m)}var d;b=String(b);a.lastIndex=0;a.test(b)&&(b=b.replace(a,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+b+")"),"function"===typeof c?f({"":d},""):d;throw new SyntaxError("JSON.parse");})})();
(function(){window.get_form_values=function(c){var d={};jQuery(c).find("input,select,textarea").each(function(b){if(this.name)if(d[this.name]||(d[this.name]=[]),"select"===this.nodeName.toLowerCase()){var a=d[this.name];$(this).find("option").each(function(b){this.selected&&a.push(this.value)})}else("input"!==this.nodeName.toLowerCase()||"checkbox"!==this.type&&"radio"!==this.type||this.checked)&&d[this.name].push(this.value||"")});return d};window.restore_form_values=function(c,d){var b=jQuery;b(c).find("input,select,textarea").each(function(a){if(this.name){var c=
d[this.name];"undefined"!=typeof c&&null!==c&&("input"!==this.nodeName.toLowerCase()||"checkbox"!==this.type&&"radio"!==this.type?"select"===this.nodeName.toLowerCase()?b(this).find("option").each(function(a){this.selected=1<c.length?0<=b.inArray(this.value,c):0===c.length?!1:this.value===c[0]}):this.value=c.length?c[0]:"":this.checked=1<c.length?0<=b.inArray(this.value,c):0===c.length?!1:this.value===c[0])}})};window.init_cached_state=function(c){var d=jQuery;c=c||"#EntryForm";onbeforeunload_fns=
[];onbeforerestorevalues_fns=[];d(window).on("beforeunload",function(){var b={form_values:get_form_values(c)};d.each(onbeforeunload_fns,function(a,c){c(b)});document.getElementById("cache_form_values").value=JSON.stringify(b)});window.cache_register_onbeforeunload=function(b){onbeforeunload_fns.push(b)};window.cache_register_onbeforerestorevalues=function(b){onbeforerestorevalues_fns.push(b)};window.restore_cached_state=function(){var b=document.getElementById("cache_form_values");if(b&&b.value){var a=
JSON.parse(b.value);d.each(onbeforerestorevalues_fns,function(b,c){c(a)});restore_form_values(c,a.form_values)}}}})();
(function(){var c=jQuery,d={"en-CA":"d M yy",de:"dd.mm.yy",fr:"d M yy",it:"d M yy",nl:"d M yy",no:"d M yy",pt:"d-mm-yy",sv:"d M yy",hu:"M d. yy",ro:"d M yy",hr:"d M yy",sl:"d M yy",bg:"d MM yy",ru:"d M yy",tr:"d M yy",lv:"d M yy",lt:"d M yy",ko:"yy/mm/dd","zh-CN":"yy/mm/dd",th:"d M yy"},b={"en-CA":!0,"":!0},a={},f={"fr-CA":"fr","es-MX":"es"},e=function(){var a=c(this),b=a.data("culture"),f=d[b]||c.datepicker.regional[b].dateFormat,e={};a.hasClass("NoYear")&&(f=f.replace(/[\- .\/]*yy[\/]?/,""),e={beforeShow:function(a,
b){b.dpDiv.addClass("NoYearDatePicker")},onClose:function(a,b){b.dpDiv.removeClass("NoYearDatePicker")},changeYear:!1});e.dateFormat=f;a.datepicker(c.extend({},c.datepicker.regional[b],e)).prop("autocomplete","off")},l=function(d){c.getScript("//ajax.googleapis.com/ajax/libs/jqueryui/"+c.ui.version+"/i18n/jquery.ui.datepicker-"+d+".min.js",function(){b[d]=!0;c.each(a[d],function(){e.call(this)});delete a[d]})};c.datepicker.regional["en-CA"]=c.extend({},c.datepicker.regional[""]);c.fn.extend({autodatepicker:function(){return this.each(function(){var d=
c(this),h;h=d.parents("[lang]").first().prop("lang")||"en-CA";h=f[h]||h;d.data("culture",h);b[h]?e.call(this):(d=a[h],d||(d=a[h]=[],l(h)),d.push(this))})}});jQuery(function(){c("input.DatePicker").autodatepicker()})})();
(function(c){function d(b){return b&&b.constructor===Number?b+"px":b}c.fn.bgiframe=c.browser.msie&&/msie 6\.0/i.test(navigator.userAgent)?function(b){b=c.extend({top:"auto",left:"auto",width:"auto",height:"auto",opacity:!0,src:"javascript:false;"},b);var a='<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+b.src+'"style="display:block;position:absolute;z-index:-1;'+(!1!==b.opacity?"filter:Alpha(Opacity='0');":"")+"top:"+("auto"==b.top?"expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+'px')":
d(b.top))+";left:"+("auto"==b.left?"expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+'px')":d(b.left))+";width:"+("auto"==b.width?"expression(this.parentNode.offsetWidth+'px')":d(b.width))+";height:"+("auto"==b.height?"expression(this.parentNode.offsetHeight+'px')":d(b.height))+';"/>';return this.each(function(){0===c(this).children("iframe.bgiframe").length&&this.insertBefore(document.createElement(a),this.firstChild)})}:function(){return this};c.fn.bgIframe=c.fn.bgiframe})(jQuery);
(function(){var c=function(a){a=a.toLowerCase();a=a.replace(RegExp("[\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5]","g"),"a");a=a.replace(RegExp("\u00e6","g"),"ae");a=a.replace(RegExp("\u00e7","g"),"c");a=a.replace(RegExp("[\u00e8\u00e9\u00ea\u00eb]","g"),"e");a=a.replace(RegExp("[\u00ec\u00ed\u00ee\u00ef]","g"),"i");a=a.replace(RegExp("\u00f1","g"),"n");a=a.replace(RegExp("[\u00f2\u00f3\u00f4\u00f5\u00f6]","g"),"o");a=a.replace(RegExp("\u009c","g"),"oe");a=a.replace(RegExp("[\u00f9\u00fa\u00fb\u00fc]","g"),
"u");return a=a.replace(RegExp("[\u00fd\u00ff]","g"),"y")};window.string_ci_ai=c;var d=function(a,b,d,l,g){d=d||"value";l=l||"";g=g||"";return function(h,k){if(b.term&&(new RegExp(l+a.ui.autocomplete.escapeRegex(b.term)+g,"i")).test(h.term)&&b.content&&13>b.content.length){var n=new RegExp(l+a.ui.autocomplete.escapeRegex(h.term)+g,"i");k(a.grep(b.content,function(a){return n.test(c(a[d]))}));return!0}return!1}};window.default_cache_search_fn=d;var b=function(a,b,e,l,g){e=e||{};g=g||d(a,e,l||"value");
return function(d,k,n){d.term=c(d.term);e.term===d.term&&e.content?k(e.content):g(d,k)||a.ajax({url:n||b,dataType:"json",data:d,cache:!1,success:function(a){e.term=d.term;e.content=a;k(a)}})}};window.create_caching_source_fn=b;window.init_community_autocomplete=function(a,d,e,l,g){var h={};g&&(g=a(g));g&&!g.length&&(g=null);var k=a("#"+d).autocomplete({focus:function(a,b){return!1},select:function(a,b){k.data({chkid:b.item.chkid,display:b.item.value})},source:b(a,e,h),minLength:l}).keypress(function(a){"13"==
a.keyCode&&(a.preventDefault(),k.autocomplete("close"))});g&&(k.parents("form").on("submit",function(){var b=k.val();if(k.data("display")===b)g.val(k.data("chkid"));else{if(h.content){var d=c(b),b=a.grep(h.content,function(a){return c(a.value)===d});if(1===b.length){g.val(b[0].chkid);k.data({chkid:b[0].chkid,display:b[0].value}).val(b[0].value);return}}g.val("")}}),cache_register_onbeforerestorevalues(function(a){k.length&&(a=a["autocomplete_data_"+k[0].id])&&k.data(a)}),cache_register_onbeforeunload(function(a){if(k.length){var b=
k.data();b.display&&b.chkid&&(a["autocomplete_data_"+k[0].id]={display:b.display,chkid:b.chkid})}}))}})();
(function(){window.entryform=window.entryform||{};window.create_checklist_onbefore_fns=function(b,a,c,d){cache_register_onbeforeunload(function(b){b[a+"_added"]=c});cache_register_onbeforerestorevalues(function(c){(c=c[a+"_added"])&&b.each(c,function(a,b){d(b.chkid,b.display,"")})})};window.basic_chk_add_html=function(b,a){return function(c,d){var l=b("<tr>").append(b("<td>").append(b("<input>").prop({id:a+"_ID_"+c,type:"checkbox",checked:!0,defaultChecked:!0,name:a+"_ID",value:c})).append(document.createTextNode(" "+
d))).append(b("<td>").append(b("<input>").prop({id:a+"_NOTES_"+c,name:a+"_NOTES_"+c,size:entryform.chk_notes_size,maxlength:entryform.chk_notes_maxlen})));b("#"+a+"_existing_add_table").append(l);return l.find('input[type="checkbox"]')[0]}};var c={},d=function(b){$("#NEW_"+b).autocomplete(c[b])};window.init_autocomplete_checklist=function(b,a){var f=a.field;if(!c[f]){var e=a.source;a.minLength=a.minLength||1;a.delay=a.delay||300;a.add_new_html=a.add_new_html||basic_chk_add_html(b,f);a.match_prop=
a.match_prop||"value";a.txt_not_found=a.txt_not_found||"Not Found";var l=b(a.delegate_root||document),g=a.added_values||[],h=function(b,c,d){var e=document.getElementById(f+"_ID_"+b);e?(e.checked=!0,a.after_add_new_value&&a.after_add_new_value.call(e)):(g.push({chkid:b,display:c,label:d}),b=a.add_new_html(b,c,d),a.after_add_new_value&&a.after_add_new_value.call(b))};create_checklist_onbefore_fns(b,f,g,h);var k={},n=function(a){b("#NEW_"+f).data({chkid:"",display:"",label:""}).prop("value","").focus();
b("#"+f+"_error").hide("slow",function(){b(this).remove()})},p=null,s=null;(function(c){b.isArray(c)?(s=function(d,f){var e=new RegExp(b.ui.autocomplete.escapeRegex(string_ci_ai(d.term)));f(b.grep(c,function(b){return e.test(string_ci_ai(b[a.match_prop]||b))}))},p=function(d,f){var e=string_ci_ai(d),m=b.grep(c,function(b){return string_ci_ai(string_ci_ai(b[a.match_prop]||b))===e});if(1===m.length)return f(m[0]),!0;f()}):"string"===typeof c?(s=create_caching_source_fn(b,c,k,a.match_prop),p=function(c,
d,f){var e=string_ci_ai(c);if(k.content){var h=b.grep(k.content,function(b){return string_ci_ai(b[a.match_prop])===e});if(1===h.length){d(h[0]);return}}f||string_ci_ai(k.term||"")===e?d():s({term:e},function(a){p(c,d,!0)})}):(s=c,p=a.look_for_fn)})(e);l.on("click","#add_"+f,function(c){c=b("#NEW_"+f);var d=c.data("chkid"),e=c.data("display"),k=c.data("label"),m=c[0].value;if(d&&e&&e==m)return h(d,e,k),n(),!1;p(c[0].value,function(c){c?(h(c.chkid,c.value,c.label),n()):0===b("#"+f+"_error").length&&
(b("#"+f+"_new_input_table").before(b("<p>").hide().addClass("Alert").prop("id",f+"_error").append(document.createTextNode(a.txt_not_found))),b("#"+f+"_error").show("slow"))});return!1});c[f]={focus:function(a,b){return!1},source:s,minLength:a.minLength,delay:a.delay,select:function(a,c){b("#NEW_"+f).data({chkid:c.item.chkid,display:c.item.value,label:c.item.label})}};l.on("keypress","#NEW_"+f,function(a){"13"==a.keyCode&&(a.preventDefault(),b("#NEW_"+f).autocomplete("close"),b("#add_"+f).trigger("click"))})}d(f)};
window.init_languages=function(b,a){var c=null,d=null,l=b("#LN_existing_add_table"),g=function(){var a=b(this).parents(".language-entry").find(".language-details-notes");this.checked?a.slideDown():a.slideUp()};init_autocomplete_checklist(b,{field:"LN",source:entryform.languages_source,txt_not_found:a,after_add_new_value:g,add_new_html:function(a,k){null===c&&(c=b("#add_LN"),d=c.data("newTemplate"));var g=d.replace(/LANGNAMELANGNAME/g,k).replace(/IDIDID/g,a);l.append(g)}});l.on("change",".language-primary",
g).uitooltip({items:"[data-help-text]",content:function(){return'<div class="language-help-text">'+b(this).data("helpText")+"</div>"},position:{my:"center bottom-20",at:"center top",using:function(a,c){b(this).css(a);b("<div>").addClass("arrow").addClass(c.vertical).addClass(c.horizontal).appendTo(this)}}});window.languages_check_state=g}})();
(function(){window.only_items_chk_add_html=function(c,d,b){return function(a,f){b&&b();c("#"+d+"_existing_add_container").append(c("<label>").append(c("<input>").prop({id:d+"_ID_"+a,type:"checkbox",checked:!0,defaultChecked:!0,name:d+"_ID",value:a})).append("&nbsp;").append(document.createTextNode(f))).append(" ; ")}};window.init_check_for_autochecklist=function(c){var d=jQuery,b=function(){var a=d(this).data("jump_location");(a=document.getElementById(a))&&a.scrollIntoView(!0)},a=function(){return d("<li>").append(d("<span>").data("jump_location",
this.id).addClass("UnaddedChecklistJump SimulateLink").append(d(this).parentsUntil("td[data-field-display-name]").parent().data("fieldDisplayName")))},f=d("input[id^=NEW_]");f.length&&(d("#EntryForm").submit(function(b){var l=f.map(function(){return this.value?this:null}),g;if(l.length&&!b.isDefaultPrevented()){if(!confirm(c)){b.preventDefault();d("#SUBMIT_BUTTON").prop("disabled",!1);b=d("#unadded_checklist_error_box");g=d("#unadded_checklist_error_list");var h=b.is(":visible");h&&g.children("ul:first").hide("slow",
function(){d(this).remove()});var k=d("<ul>");h&&k.hide();g.append(k);d.each(l.map(a),function(){k.append(this)});h?k.show("slow"):b.show("slow")}}else b.isDefaultPrevented()&&(b=d("#unadded_checklist_error_box"),g=d("#unadded_checklist_error_list"),b.hide("slow",function(){g.children().remove()}))}),d(document).on("click",".UnaddedChecklistJump",b))};window.init_entryform_items=function(c,d,b){var a=jQuery;c.each(function(){var c=null,e=this,l=a(e),g=1,h=l.find(".EntryFormItemContainerIds")[0];if(h){var k=
l.data("maxAdd");k&&(k=parseInt(k,10));var n=[];h.value&&(n=a.map(h.value.split(","),function(a){return 0===a.indexOf("NEW")&&0!==a.indexOf("NEWFB")?null:a}));var p={},s=function(){l.find(".EntryFormItemBox").each(function(b){a(this).find(".EntryFormItemCount").text(b+1)})},r=function(a){if(k){var b=l.find(".EntryFormItemContent:hidden").parent().find("button.EntryFormItemDelete").prop("disabled",!a);q.prop("disabled",!a);a?(b.removeClass("ui-state-disabled"),q.removeClass("ui-state-disabled")):(b.addClass("ui-state-disabled"),
q.addClass("ui-state-disabled"))}},t=function(){var a=0,b;for(b in p)a++;return n.length-a},u=function(b){var d=0;if(k&&!b&&(d=t(),d>=k)){alert("over");return}var e=l.data("addTmpl");n.push("NEW"+g++);h.value=n.join(",");e=a(e.replace(/\[COUNT\]/g,n.length).replace(/\[ID\]/g,n[n.length-1]));e.find(".DatePicker").autodatepicker();e.find(".Province").combobox({source:window.cioc_province_source});entryform.service_titles&&e.find(".ServiceTitleField").combobox({source:entryform.service_titles});l.append(e);
c&&(c.sortable("refresh"),s());k&&!b&&d+1===k&&r(!1)},q=l.parent().find(".EntryFormItemAdd").click(function(){u(!1)});l.on("click","button.EntryFormItemDelete",function(){var c=this,e=a(this).parents(".EntryFormItemBox").find(".EntryFormItemContent"),f=this.id.split("_"),f=f[f.length-2];if(e.is(":visible"))e.hide("slow",function(){p[f]=get_form_values(e);a(c).text(b);e.find("input,select,textarea").each(function(){"input"!==this.nodeName.toLowerCase()||"checkbox"!==this.type&&"radio"!==this.type?
"select"===this.nodeName.toLowerCase()?a(this).find("option").each(function(){this.selected=!1}):this.value="":this.checked=!1});r(!0)});else{var g=0;if(k&&(g=t(),g>=k)){alert("over");return}var h=p[f];h&&(delete p[f],restore_form_values(e,h),e.show("slow",function(){a(c).text(d)}),k&&g+1===k&&r(!1))}});l.hasClass("sortable")&&(c=l.sortable({items:".EntryFormItemBox"}),c.bind("sortstart",function(a,b){b.helper.bgiframe();l.addClass("sorting")}),c.bind("sortstop",function(){var b=c.sortable("toArray");
n=a.map(b,function(a){a=a.split("_");return a[a.length-2]});h.value=n.join(",");setTimeout(function(){l.removeClass("sorting");s()},1)}));cache_register_onbeforeunload(function(a){a[e.id+"_ids"]=n;a[e.id+"_deletes"]=p;c&&(a[e.id+"_order"]=c.sortable("toArray"))});cache_register_onbeforerestorevalues(function(d){d[e.id+"_ids"]&&a.each(d[e.id+"_ids"],function(a,b){0===b.indexOf("NEW")&&u(!0)});d[e.id+"_deletes"]&&(p=d[e.id+"_deletes"],l.find(".EntryFormItemContent").each(function(){var c=this.id.split("_"),
c=c[c.length-2];p[c]&&a(this).hide().parent().find("button.EntryFormItemDelete").text(b)}));k&&t()>=k&&r(!1);c&&(d=d[e.id+"_order"])&&(d.reverse(),a.each(d,function(b,c){a("#"+c).detach().prependTo(l)}),c.sortable("refresh"),s())})}})};window.init_schedule=function(c){var d=function(){var b=c(this).parents(".EntryFormItemBox"),a=this.value;"0"===a?b.find(".recurs-ui").hide():"1"==a?(b.find(".repeat-every-ui, .repeats-on-ui, .recurs-week-label").show(),b.find(".repeat-week-of-month-ui, .repeat-day-of-month-ui, .recurs-month-label").hide()):
"2"==a?(b.find(".repeat-every-ui, .repeat-day-of-month-ui, .recurs-month-label").show(),b.find(".repeat-week-of-month-ui, .repeats-on-ui, .recurs-week-label").hide()):(b.find(".repeat-week-of-month-ui, .repeats-on-ui, .recurs-month-label").show(),b.find(".repeat-every-ui, .repeat-day-of-month-ui, .recurs-week-label").hide())};c("#ScheduleEditArea").on("change",".recur-type-selector",d).on("click",".schedule-ui-accept-feedback",function(b){var a=c(this);b=a.parents(".EntryFormItemBox");a=a.data("schedule");
restore_form_values(b,a);return!1}).find(".recur-type-selector").each(d)}})();
(function(){var c=jQuery;window.init_municipality_autocomplete=function(d,b,a){d.each(function(){var d={},e=this,l=this.id.replace("Web",""),g=c("#"+l),h=c(this).data("cm_info",{value:this.value,chkid:g[0].value}).autocomplete({focus:function(a,b){return!1},source:create_caching_source_fn(c,b,d),minLength:1,close:function(){h.is(":focus")||k()}}).keypress(function(a){"13"==a.keyCode&&(a.preventDefault(),h.autocomplete("close"))}),k=function(){var b=h.data("cm_info"),k=e.value,l;if(k)if(b&&b.chkid&&
b.value&&b.value===k)g[0].value=b.chkid;else{l=string_ci_ai(k);if(d.content&&(b=c.grep(d.content,function(a){return string_ci_ai(a.value)===l}),1===b.length)){g[0].value=b[0].chkid;h.data("cm_info",b[0]);return}setTimeout(function(){h[0].focus()},1);alert(a)}else g[0].value=""};h.blur(function(){h.autocomplete("widget").is(":visible")||k()})})}})();
(function(){window.init_cm_checklist=function(c,d,b){var a={},f=create_caching_source_fn(c,d,a,"label"),e=b.parent_cmid_input||null,l=9999,g=c("#cm-checklist-template").html(),h=c("#cm-checklist-target");d=e?function(a,b,c){a.parent=e.val();return f(a,b,c)}:f;var k=function(d,e,g){var h=string_ci_ai(d);if(a.content){var l=c.grep(a.content,function(a){return string_ci_ai(a[b.match_prop])===h});if(1===l.length){e(l[0]);return}}g||string_ci_ai(a.term||"")===h?e():f({term:h},function(a){k(d,e,!0)})};
b.parent_cmid_input&&(e=c(b.parent_cmid_input));b.source=d;b.look_for_fn=k;b.add_new_html=function(a,b){to_add=c(g.replace(/\[COUNT\]/g,l++).replace(/\[ID\]/g,a).replace(/\[LABEL\]/g,c("<div>").text(b).html()));h.is(":hidden")?h.removeClass("hidden").append(to_add):h.append(to_add);return!1};init_autocomplete_checklist(c,b)};window.init_community_edit=function(c){var d=9999,b=null,a=null;c("#add-alternate-name").click(function(f){var e=null;f.preventDefault();b||(b=c("#alt-name-template").html(),
a=c("#alt-name-target"));e=c(b.replace(/\[COUNT\]/g,d++));a.is(":hidden")?a.removeClass("hidden").append(e):a.append(e);return!1})}})();
