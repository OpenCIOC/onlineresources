window.CIOC={};
(function(c,d){d.do_drop_down_navigation=function(){for(var b=c.getElementById("ActionList").options,a=0;a<b.length;a++)if(b[a].selected){var e=b[a].getAttribute("href");e&&("undefined"!=typeof b[a].attributes.newwindow?d.open(e):d.location.href=e);break}};jQuery(function(b){b("[data-toggle=dialog]").each(function(){var a=b(this),c=b(a.data("target")),d={autoOpen:!1,title:c.data("title"),modal:c.data("modal")};c.dialog(d);a.click(function(){c.dialog("isOpen")?c.dialog("close"):c.dialog("open")})})})})(document,window);
function CheckAll(c,d){c||(c="IDList");var b=d;d||(b=document.RecordList);for(var a=b.elements.length,e=0;e<a;e++){var f=b.elements[e];f.name===c&&(f.checked=!0)}}function ClearAll(c,d){c||(c="IDList");var b=d;d||(b=document.RecordList);for(var a=b.elements.length,e=0;e<a;e++){var f=b.elements[e];f.name===c&&(f.checked=!1)}}function add_class(c,d){c&&!(new RegExp("\\b"+d+"\\b")).test(c.className)&&(c.className&&(d=" "+d),c.className+=d)}
function remove_class(c,d){if(c){for(var b=c.className.split(" "),a=[],e=0;e<b.length;e++){var f=b[e];f!==d&&a.push(f)}c.className=a.join(" ")}}function hide(c){add_class(c,"NotVisible")}function show(c){remove_class(c,"NotVisible")}function openWin(c,d){window.open(c,d,"toolbar=no,width=490,height=485,location=no,scrollBars=yes,resizable=no,titlebar=yes").focus()}
function openWinL(c,d){window.open(c,d,"toolbar=no,width=650,height=520,location=no,scrollBars=yes,resizable=no,titlebar=yes").focus()}function openWinXL(c,d){window.open(c,d,"toolbar=no,width=755,height=550,location=no,scrollBars=yes,resizable=no,titlebar=yes").focus()}jQuery(function(c){var d={sm:openWin,lg:openWinL,xl:openWinXL};c(document).on("click","a.poplink",function(){var b=c(this).data("popargs");(d[b.size||"sm"]||openWin)(this.href,b.name||"popwin");return!1})});
(function(){var c=jQuery,d={},b=function(a){null!==a&&"undefined"!==typeof a?c("#myListCount").text(a):(a=c("#myListCount").text())&&(a=parseInt(a,10));a?d.myListLink.show():d.myListLink.hide()},a=function(a){c.each(a,function(a,b){c("#added_to_list_"+b).show();c("#add_to_list_"+b).hide()})},e=function(e){return function(f){f.fail?alert(f.errinfo):(f.ids?b(c.grep(f.ids,k[d.domain]).length):f.count?b(f.count):b(0),a([e]))}},f=function(a){a=c(a.currentTarget).data("id");c.ajax({success:e(a),dataType:"json",
error:function(){alert("Error")},data:{id:a},type:"POST",url:d.current_list_url})},g=function(a){return function(b){if(b.fail)alert(b.errinfo);else{b=!0;if(a){var e=c("#results_table #remove_from_list_"+a);e.length?e.parent().parent().remove():(b=!1,e=c("#results_container #remove_from_list_"+a),e.parents(".dlist-result").remove())}e=!1;if((e=b?1===c("#results_table tr").length:0===c("#results_container .dlist-result").length)||!a)c("#records_ui").hide(),c("#no_records_message").show()}}},h=function(a){a=
c(a.currentTarget).data("id");c.ajax({success:g(a),dataType:"json",error:function(){alert("Error")},data:{ID:a,RemoveItem:d.domain},type:"POST",url:d.current_list_url})},l=function(a){c.ajax({success:g(),dataType:"json",error:function(){alert("Error")},data:{ID:"all",RemoveItem:d.domain},type:"POST",url:d.current_list_url})},k={CIC:function(a){return/^[A-Za-z]{3}[0-9]{4,5}$/.test(a)},VOL:function(a){return/^[1-9][0-9]*$/.test(a)}},n=function(e){if(e.fail)p();else if(e.inrequest){var f=c.grep(e.ids,
k[d.domain]);a(f);b(f.length);(e=e.previous_ids)&&c.each(e,function(a,b){c("#ct_added_to_previous_request_"+b).show()});c(".ListUI img").prop("src",function(a,b){return b.replace("list","referral")});c("#list_header_text").hide();c("#ct_header_text").show();d.current_list_url=d.ct_update_url;s()}else p()},p=function(){var e=function(){d.list_view_mode||a(d.already_added||[]);d.current_list_url=d.list_view_mode&&"ct"===d.list_view_mode?d.ct_update_url:d.list_update_url;b((d.already_added||[]).length);
s()};d.list_view_mode||d.has_session?e():c.ajax({dataType:"json",error:null,url:d.list_update_url,data:{SessionTest:"on"},type:"POST",success:function(a){a.has_session&&e()}})},s=function(){c(".HideListUI").delegate(".add_to_list","click",f).delegate(".remove_from_list","click",h).removeClass("HideListUI");c("#remove_all_from_list").click(l);c.browser.msie&&"8.0">c.browser.msie&&c(".ListUI").removeClass("FixIE")};window.init_list_adder=function(a){d=a;d.myListLink=c("#myListLink").parent(":hidden").add("#myListLink");
a.in_request?c.ajax({success:n,dataType:"json",error:null,type:"POST",url:a.in_request}):p()}})();this.JSON||(this.JSON={});
(function(){function c(a){return 10>a?"0"+a:a}function d(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var b=h[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function b(a,c){var e,h,r,t,u=f,q,m=c[a];m&&"object"===typeof m&&"function"===typeof m.toJSON&&(m=m.toJSON(a));"function"===typeof l&&(m=l.call(c,a,m));switch(typeof m){case "string":return d(m);case "number":return isFinite(m)?String(m):"null";case "boolean":case "null":return String(m);
case "object":if(!m)return"null";f+=g;q=[];if("[object Array]"===Object.prototype.toString.apply(m)){t=m.length;for(e=0;e<t;e+=1)q[e]=b(e,m)||"null";r=0===q.length?"[]":f?"[\n"+f+q.join(",\n"+f)+"\n"+u+"]":"["+q.join(",")+"]";f=u;return r}if(l&&"object"===typeof l)for(t=l.length,e=0;e<t;e+=1)h=l[e],"string"===typeof h&&(r=b(h,m))&&q.push(d(h)+(f?": ":":")+r);else for(h in m)Object.hasOwnProperty.call(m,h)&&(r=b(h,m))&&q.push(d(h)+(f?": ":":")+r);r=0===q.length?"{}":f?"{\n"+f+q.join(",\n"+f)+"\n"+
u+"}":"{"+q.join(",")+"}";f=u;return r}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var a=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,c,e){var d;g=f="";if("number"===typeof e)for(d=0;d<e;d+=1)g+=" ";else"string"===typeof e&&(g=e);if((l=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return b("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(b,c){function e(a,b){var d,f,m=a[b];if(m&&"object"===typeof m)for(d in m)Object.hasOwnProperty.call(m,d)&&(f=e(m,d),void 0!==f?m[d]=f:delete m[d]);return c.call(a,b,m)}var d;b=String(b);a.lastIndex=0;a.test(b)&&(b=b.replace(a,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+b+")"),"function"===typeof c?e({"":d},""):d;throw new SyntaxError("JSON.parse");})})();
(function(){window.get_form_values=function(c){var d={};jQuery(c).find("input,select,textarea").each(function(b){if(this.name)if(d[this.name]||(d[this.name]=[]),"select"===this.nodeName.toLowerCase()){var a=d[this.name];$(this).find("option").each(function(b){this.selected&&a.push(this.value)})}else("input"!==this.nodeName.toLowerCase()||"checkbox"!==this.type&&"radio"!==this.type||this.checked)&&d[this.name].push(this.value||"")});return d};window.restore_form_values=function(c,d){var b=jQuery;b(c).find("input,select,textarea").each(function(a){if(this.name){var c=
d[this.name];"undefined"!=typeof c&&null!==c&&("input"!==this.nodeName.toLowerCase()||"checkbox"!==this.type&&"radio"!==this.type?"select"===this.nodeName.toLowerCase()?b(this).find("option").each(function(a){this.selected=1<c.length?0<=b.inArray(this.value,c):0===c.length?!1:this.value===c[0]}):this.value=c.length?c[0]:"":this.checked=1<c.length?0<=b.inArray(this.value,c):0===c.length?!1:this.value===c[0])}})};window.init_cached_state=function(c){var d=jQuery;c=c||"#EntryForm";onbeforeunload_fns=
[];onbeforerestorevalues_fns=[];d(window).on("beforeunload",function(){var b={form_values:get_form_values(c)};d.each(onbeforeunload_fns,function(a,c){c(b)});document.getElementById("cache_form_values").value=JSON.stringify(b)});window.cache_register_onbeforeunload=function(b){onbeforeunload_fns.push(b)};window.cache_register_onbeforerestorevalues=function(b){onbeforerestorevalues_fns.push(b)};window.restore_cached_state=function(){var b=document.getElementById("cache_form_values");if(b&&b.value){var a=
JSON.parse(b.value);d.each(onbeforerestorevalues_fns,function(b,c){c(a)});restore_form_values(c,a.form_values)}}}})();
(function(){var c=jQuery,d={"en-CA":"d M yy",de:"dd.mm.yy",fr:"d M yy",it:"d M yy",nl:"d M yy",no:"d M yy",pt:"d-mm-yy",sv:"d M yy",hu:"M d. yy",ro:"d M yy",hr:"d M yy",sl:"d M yy",bg:"d MM yy",ru:"d M yy",tr:"d M yy",lv:"d M yy",lt:"d M yy",ko:"yy/mm/dd","zh-CN":"yy/mm/dd",th:"d M yy"},b={"en-CA":!0,"":!0},a={},e={"fr-CA":"fr","es-MX":"es"},f=function(){var a=c(this),b=a.data("culture"),e=d[b]||c.datepicker.regional[b].dateFormat,f={};a.hasClass("NoYear")&&(e=e.replace(/[\- .\/]*yy[\/]?/,""),f={beforeShow:function(a,
b){b.dpDiv.addClass("NoYearDatePicker")},onClose:function(a,b){b.dpDiv.removeClass("NoYearDatePicker")},changeYear:!1});f.dateFormat=e;a.datepicker(c.extend({},c.datepicker.regional[b],f)).prop("autocomplete","off")},g=function(e){c.getScript("//ajax.googleapis.com/ajax/libs/jqueryui/"+c.ui.version+"/i18n/jquery.ui.datepicker-"+e+".min.js",function(){b[e]=!0;c.each(a[e],function(){f.call(this)});delete a[e]})};c.datepicker.regional["en-CA"]=c.extend({},c.datepicker.regional[""]);c.fn.extend({autodatepicker:function(){return this.each(function(){var d=
c(this),l;l=d.parents("[lang]").first().prop("lang")||"en-CA";l=e[l]||l;d.data("culture",l);b[l]?f.call(this):(d=a[l],d||(d=a[l]=[],g(l)),d.push(this))})}});jQuery(function(){c("input.DatePicker").autodatepicker()})})();
(function(c){function d(b){return b&&b.constructor===Number?b+"px":b}c.fn.bgiframe=c.browser.msie&&/msie 6\.0/i.test(navigator.userAgent)?function(b){b=c.extend({top:"auto",left:"auto",width:"auto",height:"auto",opacity:!0,src:"javascript:false;"},b);var a='<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+b.src+'"style="display:block;position:absolute;z-index:-1;'+(!1!==b.opacity?"filter:Alpha(Opacity='0');":"")+"top:"+("auto"==b.top?"expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+'px')":
d(b.top))+";left:"+("auto"==b.left?"expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+'px')":d(b.left))+";width:"+("auto"==b.width?"expression(this.parentNode.offsetWidth+'px')":d(b.width))+";height:"+("auto"==b.height?"expression(this.parentNode.offsetHeight+'px')":d(b.height))+';"/>';return this.each(function(){0===c(this).children("iframe.bgiframe").length&&this.insertBefore(document.createElement(a),this.firstChild)})}:function(){return this};c.fn.bgIframe=c.fn.bgiframe})(jQuery);
(function(){var c=function(a){a=a.toLowerCase();a=a.replace(RegExp("[\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5]","g"),"a");a=a.replace(RegExp("\u00e6","g"),"ae");a=a.replace(RegExp("\u00e7","g"),"c");a=a.replace(RegExp("[\u00e8\u00e9\u00ea\u00eb]","g"),"e");a=a.replace(RegExp("[\u00ec\u00ed\u00ee\u00ef]","g"),"i");a=a.replace(RegExp("\u00f1","g"),"n");a=a.replace(RegExp("[\u00f2\u00f3\u00f4\u00f5\u00f6]","g"),"o");a=a.replace(RegExp("\u009c","g"),"oe");a=a.replace(RegExp("[\u00f9\u00fa\u00fb\u00fc]","g"),
"u");return a=a.replace(RegExp("[\u00fd\u00ff]","g"),"y")};window.string_ci_ai=c;var d=function(a,b,d,g,h){d=d||"value";g=g||"";h=h||"";return function(l,k){if(b.term&&(new RegExp(g+a.ui.autocomplete.escapeRegex(b.term)+h,"i")).test(l.term)&&b.content&&13>b.content.length){var n=new RegExp(g+a.ui.autocomplete.escapeRegex(l.term)+h,"i");k(a.grep(b.content,function(a){return n.test(c(a[d]))}));return!0}return!1}};window.default_cache_search_fn=d;var b=function(a,b,f,g,h){f=f||{};h=h||d(a,f,g||"value");
return function(d,g,n){d.term=c(d.term);f.term===d.term&&f.content?g(f.content):h(d,g)||a.ajax({url:n||b,dataType:"json",data:d,cache:!1,success:function(a){f.term=d.term;f.content=a;g(a)}})}};window.create_caching_source_fn=b;window.init_community_autocomplete=function(a,d,f,g,h){var l={};h&&(h=a(h));h&&!h.length&&(h=null);var k=a("#"+d).autocomplete({focus:function(a,b){return!1},select:function(a,b){k.data({chkid:b.item.chkid,display:b.item.value})},source:b(a,f,l),minLength:g}).keypress(function(a){"13"==
a.keyCode&&(a.preventDefault(),k.autocomplete("close"))});h&&(k.parents("form").on("submit",function(){var b=k.val();if(k.data("display")===b)h.val(k.data("chkid"));else{if(l.content){var d=c(b),b=a.grep(l.content,function(a){return c(a.value)===d});if(1===b.length){h.val(b[0].chkid);k.data({chkid:b[0].chkid,display:b[0].value}).val(b[0].value);return}}h.val("")}}),cache_register_onbeforerestorevalues(function(a){k.length&&(a=a["autocomplete_data_"+k[0].id])&&k.data(a)}),cache_register_onbeforeunload(function(a){if(k.length){var b=
k.data();b.display&&b.chkid&&(a["autocomplete_data_"+k[0].id]={display:b.display,chkid:b.chkid})}}))}})();
(function(){window.entryform=window.entryform||{};window.create_checklist_onbefore_fns=function(b,a,c,d){cache_register_onbeforeunload(function(b){b[a+"_added"]=c});cache_register_onbeforerestorevalues(function(c){(c=c[a+"_added"])&&b.each(c,function(a,b){d(b.chkid,b.display,"")})})};window.basic_chk_add_html=function(b,a){return function(c,d){var g=b("<tr>").append(b("<td>").append(b("<input>").prop({id:a+"_ID_"+c,type:"checkbox",checked:!0,defaultChecked:!0,name:a+"_ID",value:c})).append(document.createTextNode(" "+
d))).append(b("<td>").append(b("<input>").prop({id:a+"_NOTES_"+c,name:a+"_NOTES_"+c,size:entryform.chk_notes_size,maxlength:entryform.chk_notes_maxlen})));b("#"+a+"_existing_add_table").append(g);return g.find('input[type="checkbox"]')[0]}};var c={},d=function(b){$("#NEW_"+b).autocomplete(c[b])};window.init_autocomplete_checklist=function(b,a){var e=a.field;if(!c[e]){var f=a.source;a.minLength=a.minLength||1;a.delay=a.delay||300;a.add_new_html=a.add_new_html||basic_chk_add_html(b,e);a.match_prop=
a.match_prop||"value";a.txt_not_found=a.txt_not_found||"Not Found";var g=b(a.delegate_root||document),h=a.added_values||[],l=function(b,c,d){var f=document.getElementById(e+"_ID_"+b);f?(f.checked=!0,a.after_add_new_value&&a.after_add_new_value.call(f)):(h.push({chkid:b,display:c,label:d}),b=a.add_new_html(b,c,d),a.after_add_new_value&&a.after_add_new_value.call(b))};create_checklist_onbefore_fns(b,e,h,l);var k={},n=function(a){b("#NEW_"+e).data({chkid:"",display:"",label:""}).prop("value","").focus();
b("#"+e+"_error").hide("slow",function(){b(this).remove()})},p=null,s=null;(function(c){b.isArray(c)?(s=function(d,e){var f=new RegExp(b.ui.autocomplete.escapeRegex(string_ci_ai(d.term)));e(b.grep(c,function(b){return f.test(string_ci_ai(b[a.match_prop]||b))}))},p=function(d,e){var f=string_ci_ai(d),m=b.grep(c,function(b){return string_ci_ai(string_ci_ai(b[a.match_prop]||b))===f});if(1===m.length)return e(m[0]),!0;e()}):"string"===typeof c?(s=create_caching_source_fn(b,c,k,a.match_prop),p=function(c,
d,e){var f=string_ci_ai(c);if(k.content){var g=b.grep(k.content,function(b){return string_ci_ai(b[a.match_prop])===f});if(1===g.length){d(g[0]);return}}e||string_ci_ai(k.term||"")===f?d():s({term:f},function(a){p(c,d,!0)})}):(s=c,p=a.look_for_fn)})(f);g.on("click","#add_"+e,function(c){c=b("#NEW_"+e);var d=c.data("chkid"),f=c.data("display"),g=c.data("label"),m=c[0].value;if(d&&f&&f==m)return l(d,f,g),n(),!1;p(c[0].value,function(c){c?(l(c.chkid,c.value,c.label),n()):0===b("#"+e+"_error").length&&
(b("#"+e+"_new_input_table").before(b("<p>").hide().addClass("Alert").prop("id",e+"_error").append(document.createTextNode(a.txt_not_found))),b("#"+e+"_error").show("slow"))});return!1});c[e]={focus:function(a,b){return!1},source:s,minLength:a.minLength,delay:a.delay,select:function(a,c){b("#NEW_"+e).data({chkid:c.item.chkid,display:c.item.value,label:c.item.label})}};g.on("keypress","#NEW_"+e,function(a){"13"==a.keyCode&&(a.preventDefault(),b("#NEW_"+e).autocomplete("close"),b("#add_"+e).trigger("click"))})}d(e)};
window.init_languages=function(b,a){var c=null,d=null,g=b("#LN_existing_add_table"),h=function(){var a=b(this).parents(".language-entry").find(".language-details-notes");this.checked?a.slideDown():a.slideUp()};init_autocomplete_checklist(b,{field:"LN",source:entryform.languages_source,txt_not_found:a,after_add_new_value:h,add_new_html:function(a,h){null===c&&(c=b("#add_LN"),d=c.data("newTemplate"));var n=d.replace(/LANGNAMELANGNAME/g,h).replace(/IDIDID/g,a);g.append(n)}});g.on("change",".language-primary",
h).uitooltip({items:"[data-help-text]",content:function(){return'<div class="language-help-text">'+b(this).data("helpText")+"</div>"},position:{my:"center bottom-20",at:"center top",using:function(a,c){b(this).css(a);b("<div>").addClass("arrow").addClass(c.vertical).addClass(c.horizontal).appendTo(this)}}});window.languages_check_state=h}})();
(function(){window.only_items_chk_add_html=function(c,d,b){return function(a,e){b&&b();c("#"+d+"_existing_add_container").append(c("<label>").append(c("<input>").prop({id:d+"_ID_"+a,type:"checkbox",checked:!0,defaultChecked:!0,name:d+"_ID",value:a})).append("&nbsp;").append(document.createTextNode(e))).append(" ; ")}};window.init_check_for_autochecklist=function(c){var d=jQuery,b=function(){var a=d(this).data("jump_location");(a=document.getElementById(a))&&a.scrollIntoView(!0)},a=function(){return d("<li>").append(d("<span>").data("jump_location",
this.id).addClass("UnaddedChecklistJump SimulateLink").append(d(this).parentsUntil("td[data-field-display-name]").parent().data("fieldDisplayName")))},e=d("input[id^=NEW_]");e.length&&(d("#EntryForm").submit(function(b){var g=e.map(function(){return this.value?this:null}),h;if(g.length&&!b.isDefaultPrevented()){if(!confirm(c)){b.preventDefault();d("#SUBMIT_BUTTON").prop("disabled",!1);b=d("#unadded_checklist_error_box");h=d("#unadded_checklist_error_list");var l=b.is(":visible");l&&h.children("ul:first").hide("slow",
function(){d(this).remove()});var k=d("<ul>");l&&k.hide();h.append(k);d.each(g.map(a),function(){k.append(this)});l?k.show("slow"):b.show("slow")}}else b.isDefaultPrevented()&&(b=d("#unadded_checklist_error_box"),h=d("#unadded_checklist_error_list"),b.hide("slow",function(){h.children().remove()}))}),d(document).on("click",".UnaddedChecklistJump",b))};window.init_entryform_items=function(c,d,b){var a=jQuery;c.each(function(){var c=null,f=this,g=a(f),h=1,l=g.find(".EntryFormItemContainerIds")[0];if(l){var k=
g.data("maxAdd");k&&(k=parseInt(k,10));var n=[];l.value&&(n=a.map(l.value.split(","),function(a){return 0===a.indexOf("NEW")&&0!==a.indexOf("NEWFB")?null:a}));var p={},s=function(){g.find(".EntryFormItemBox").each(function(b){a(this).find(".EntryFormItemCount").text(b+1)})},r=function(a){if(k){var b=g.find(".EntryFormItemContent:hidden").parent().find("button.EntryFormItemDelete").prop("disabled",!a);q.prop("disabled",!a);a?(b.removeClass("ui-state-disabled"),q.removeClass("ui-state-disabled")):(b.addClass("ui-state-disabled"),
q.addClass("ui-state-disabled"))}},t=function(){var a=0,b;for(b in p)a++;return n.length-a},u=function(b){var d=0;if(k&&!b&&(d=t(),d>=k)){alert("over");return}var f=g.data("addTmpl");n.push("NEW"+h++);l.value=n.join(",");f=a(f.replace(/\[COUNT\]/g,n.length).replace(/\[ID\]/g,n[n.length-1]));f.find(".DatePicker").autodatepicker();f.find(".Province").combobox({source:window.cioc_province_source});entryform.service_titles&&f.find(".ServiceTitleField").combobox({source:entryform.service_titles});g.append(f);
c&&(c.sortable("refresh"),s());k&&!b&&d+1===k&&r(!1)},q=g.parent().find(".EntryFormItemAdd").click(function(){u(!1)});g.on("click","button.EntryFormItemDelete",function(){var c=this,e=a(this).parents(".EntryFormItemBox").find(".EntryFormItemContent"),f=this.id.split("_"),f=f[f.length-2];if(e.is(":visible"))e.hide("slow",function(){p[f]=get_form_values(e);a(c).text(b);e.find("input,select,textarea").each(function(){"input"!==this.nodeName.toLowerCase()||"checkbox"!==this.type&&"radio"!==this.type?
"select"===this.nodeName.toLowerCase()?a(this).find("option").each(function(){this.selected=!1}):this.value="":this.checked=!1});r(!0)});else{var g=0;if(k&&(g=t(),g>=k)){alert("over");return}var h=p[f];h&&(delete p[f],restore_form_values(e,h),e.show("slow",function(){a(c).text(d)}),k&&g+1===k&&r(!1))}});g.hasClass("sortable")&&(c=g.sortable({items:".EntryFormItemBox"}),c.bind("sortstart",function(a,b){b.helper.bgiframe();g.addClass("sorting")}),c.bind("sortstop",function(){var b=c.sortable("toArray");
n=a.map(b,function(a){a=a.split("_");return a[a.length-2]});l.value=n.join(",");setTimeout(function(){g.removeClass("sorting");s()},1)}));cache_register_onbeforeunload(function(a){a[f.id+"_ids"]=n;a[f.id+"_deletes"]=p;c&&(a[f.id+"_order"]=c.sortable("toArray"))});cache_register_onbeforerestorevalues(function(d){d[f.id+"_ids"]&&a.each(d[f.id+"_ids"],function(a,b){0===b.indexOf("NEW")&&u(!0)});d[f.id+"_deletes"]&&(p=d[f.id+"_deletes"],g.find(".EntryFormItemContent").each(function(){var c=this.id.split("_"),
c=c[c.length-2];p[c]&&a(this).hide().parent().find("button.EntryFormItemDelete").text(b)}));k&&t()>=k&&r(!1);c&&(d=d[f.id+"_order"])&&(d.reverse(),a.each(d,function(b,c){a("#"+c).detach().prependTo(g)}),c.sortable("refresh"),s())})}})};window.init_schedule=function(c){var d=function(){var b=c(this).parents(".EntryFormItemBox"),a=this.value;"0"===a?b.find(".recurs-ui").hide():"1"==a?(b.find(".repeat-every-ui, .repeats-on-ui, .recurs-week-label").show(),b.find(".repeat-week-of-month-ui, .repeat-day-of-month-ui, .recurs-month-label").hide()):
"2"==a?(b.find(".repeat-every-ui, .repeat-day-of-month-ui, .recurs-month-label").show(),b.find(".repeat-week-of-month-ui, .repeats-on-ui, .recurs-week-label").hide()):(b.find(".repeat-week-of-month-ui, .repeats-on-ui, .recurs-month-label").show(),b.find(".repeat-every-ui, .repeat-day-of-month-ui, .recurs-week-label").hide())};c("#ScheduleEditArea").on("change",".recur-type-selector",d).on("click",".schedule-ui-accept-feedback",function(b){var a=c(this);b=a.parents(".EntryFormItemBox");a=a.data("schedule");
restore_form_values(b,a);return!1}).find(".recur-type-selector").each(d)}})();
(function(c){var d=function(a,b){return function(d,g){g=b(d,document.createTextNode(g));c("#"+a+"_existing_add_container").append(c("<label>").append(c("<input>").prop({id:a+"_ID_"+d,type:"checkbox",checked:!0,defaultChecked:!0,name:a+"_ID",value:d})).append("&nbsp;").append(g)).append(c("<br>"))}},b=function(a,b,f,g){init_autocomplete_checklist(c,{field:a,source:b,add_new_html:d(a,f),txt_not_found:g})};window.init_publication_checklist=function(a,c){init_cached_state();b("PUB",a,function(a,b){return b},
c);b("ADDPUB",a,function(a,b){return b},c);restore_cached_state()};window.init_subject_checklist=function(a,d,f){var g=function(a,b){return c("<a>").prop("href",d.replace(/IDIDID/g,a.toString())).append(b)};init_cached_state();b("UseSubj",a,g,f);b("BroaderSubj",a,g,f);b("RelatedSubj",a,g,f);restore_cached_state()}})(jQuery);
