/*
 Copyright (c) 2010 Brandon Aaron (http://brandonaaron.net)
 Licensed under the MIT License (LICENSE.txt).

 Version 2.1.2
*/
window.CIOC={};
(function(c,e){e.do_drop_down_navigation=function(){for(var b=c.getElementById("ActionList").options,a=0;a<b.length;a++)if(b[a].selected){var d=b[a].getAttribute("href");d&&("undefined"!=typeof b[a].attributes.newwindow?e.open(d):e.location.href=d);break}};jQuery(function(b){b("[data-toggle=dialog]").each(function(){var a=b(this),d=b(a.data("target")),h={autoOpen:!1,title:d.data("title"),modal:d.data("modal")};d.dialog(h);a.click(function(){d.dialog("isOpen")?d.dialog("close"):d.dialog("open")})})})})(document,window);
function CheckAll(c,e){c||="IDList";var b=e;e||(b=document.RecordList);e=b.elements.length;for(var a=0;a<e;a++){var d=b.elements[a];d.name===c&&(d.checked=!0)}}function ClearAll(c,e){c||="IDList";var b=e;e||(b=document.RecordList);e=b.elements.length;for(var a=0;a<e;a++){var d=b.elements[a];d.name===c&&(d.checked=!1)}}function add_class(c,e){c&&!(new RegExp("\\b"+e+"\\b")).test(c.className)&&(c.className&&(e=" "+e),c.className+=e)}
function remove_class(c,e){if(c){for(var b=c.className.split(" "),a=[],d=0;d<b.length;d++){var h=b[d];h!==e&&a.push(h)}c.className=a.join(" ")}}function hide(c){add_class(c,"NotVisible")}function show(c){remove_class(c,"NotVisible")}function openWin(c,e){window.open(c,e,"toolbar=no,width=490,height=485,location=no,scrollBars=yes,resizable=no,titlebar=yes").focus()}
function openWinL(c,e){window.open(c,e,"toolbar=no,width=650,height=520,location=no,scrollBars=yes,resizable=no,titlebar=yes").focus()}function openWinXL(c,e){window.open(c,e,"toolbar=no,width=755,height=550,location=no,scrollBars=yes,resizable=no,titlebar=yes").focus()}jQuery(function(c){var e={sm:openWin,lg:openWinL,xl:openWinXL};c(document).on("click","a.poplink",function(){var b=c(this).data("popargs");(e[b.size||"sm"]||openWin)(this.href,b.name||"popwin");return!1})});
(function(){var c=jQuery,e={},b=function(f){null!==f&&"undefined"!==typeof f?c("#myListCount").text(f):(f=c("#myListCount").text())&&(f=parseInt(f,10));f?e.myListLink.show():e.myListLink.hide()},a=function(f){c.each(f,function(p,u){c("#added_to_list_"+u).show();c("#add_to_list_"+u).hide()})},d=function(f){return function(p){p.fail?alert(p.errinfo):(p.ids?b(c.grep(p.ids,g[e.domain]).length):p.count?b(p.count):b(0),a([f]))}},h=function(f){f=c(f.currentTarget).data("id");c.ajax({success:d(f),dataType:"json",
error:function(){alert("Error")},data:{id:f},type:"POST",url:e.current_list_url})},m=function(f){return function(p){if(p.fail)alert(p.errinfo);else{p=!0;if(f){var u=c("#results_table #remove_from_list_"+f);u.length?u.parent().parent().remove():(p=!1,u=c("#results_container #remove_from_list_"+f),u.parents(".dlist-result").remove())}(p?1!==c("#results_table tr").length:0!==c("#results_container .dlist-result").length)&&f||(c("#records_ui").hide(),c("#no_records_message").show())}}},n=function(f){f=
c(f.currentTarget).data("id");c.ajax({success:m(f),dataType:"json",error:function(){alert("Error")},data:{ID:f,RemoveItem:e.domain},type:"POST",url:e.current_list_url})},k=function(f){c.ajax({success:m(),dataType:"json",error:function(){alert("Error")},data:{ID:"all",RemoveItem:e.domain},type:"POST",url:e.current_list_url})},g={CIC:function(f){return/^[A-Za-z]{3}[0-9]{4,5}$/.test(f)},VOL:function(f){return/^[1-9][0-9]*$/.test(f)}},l=function(f){if(f.fail)q();else if(f.inrequest){var p=c.grep(f.ids,
g[e.domain]);a(p);b(p.length);(f=f.previous_ids)&&c.each(f,function(u,w){c("#ct_added_to_previous_request_"+w).show()});c(".ListUI img").prop("src",function(u,w){return w.replace("list","referral")});c("#list_header_text").hide();c("#ct_header_text").show();e.current_list_url=e.ct_update_url;r()}else q()},q=function(){var f=function(){e.list_view_mode||a(e.already_added||[]);e.current_list_url=e.list_view_mode&&"ct"===e.list_view_mode?e.ct_update_url:e.list_update_url;b((e.already_added||[]).length);
r()};e.list_view_mode||e.has_session?f():c.ajax({dataType:"json",error:null,url:e.list_update_url,data:{SessionTest:"on"},type:"POST",success:function(p){p.has_session&&f()}})},r=function(){c(".HideListUI").delegate(".add_to_list","click",h).delegate(".remove_from_list","click",n).removeClass("HideListUI");c("#remove_all_from_list").click(k);c.browser.msie&&"8.0">c.browser.msie&&c(".ListUI").removeClass("FixIE")};window.init_list_adder=function(f){e=f;e.myListLink=c("#myListLink").parent(":hidden").add("#myListLink");
f.in_request?c.ajax({success:l,dataType:"json",error:null,type:"POST",url:f.in_request}):q()}})();this.JSON||(this.JSON={});
(function(){function c(g){return 10>g?"0"+g:g}function e(g){d.lastIndex=0;return d.test(g)?'"'+g.replace(d,function(l){var q=n[l];return"string"===typeof q?q:"\\u"+("0000"+l.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+g+'"'}function b(g,l){var q=h,r=l[g];r&&"object"===typeof r&&"function"===typeof r.toJSON&&(r=r.toJSON(g));"function"===typeof k&&(r=k.call(l,g,r));switch(typeof r){case "string":return e(r);case "number":return isFinite(r)?String(r):"null";case "boolean":case "null":return String(r);
case "object":if(!r)return"null";h+=m;var f=[];if("[object Array]"===Object.prototype.toString.apply(r)){var p=r.length;for(g=0;g<p;g+=1)f[g]=b(g,r)||"null";l=0===f.length?"[]":h?"[\n"+h+f.join(",\n"+h)+"\n"+q+"]":"["+f.join(",")+"]";h=q;return l}if(k&&"object"===typeof k)for(p=k.length,g=0;g<p;g+=1){var u=k[g];"string"===typeof u&&(l=b(u,r))&&f.push(e(u)+(h?": ":":")+l)}else for(u in r)Object.hasOwnProperty.call(r,u)&&(l=b(u,r))&&f.push(e(u)+(h?": ":":")+l);l=0===f.length?"{}":h?"{\n"+h+f.join(",\n"+
h)+"\n"+q+"}":"{"+f.join(",")+"}";h=q;return l}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(g){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(g){return this.valueOf()});var a=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
d=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h,m,n={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;"function"!==typeof JSON.stringify&&(JSON.stringify=function(g,l,q){var r;m=h="";if("number"===typeof q)for(r=0;r<q;r+=1)m+=" ";else"string"===typeof q&&(m=q);if((k=l)&&"function"!==typeof l&&("object"!==typeof l||"number"!==typeof l.length))throw Error("JSON.stringify");return b("",{"":g})});
"function"!==typeof JSON.parse&&(JSON.parse=function(g,l){function q(r,f){var p,u=r[f];if(u&&"object"===typeof u)for(p in u)if(Object.hasOwnProperty.call(u,p)){var w=q(u,p);void 0!==w?u[p]=w:delete u[p]}return l.call(r,f,u)}g=String(g);a.lastIndex=0;a.test(g)&&(g=g.replace(a,function(r){return"\\u"+("0000"+r.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(g.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return g=eval("("+g+")"),"function"===typeof l?q({"":g},""):g;throw new SyntaxError("JSON.parse");})})();
(function(){window.get_form_values=function(c){var e={};jQuery(c).find("input,select,textarea").each(function(b){if(this.name)if(e[this.name]||(e[this.name]=[]),"select"===this.nodeName.toLowerCase()){var a=e[this.name];$(this).find("option").each(function(d){this.selected&&a.push(this.value)})}else("input"!==this.nodeName.toLowerCase()||"checkbox"!==this.type&&"radio"!==this.type||this.checked)&&e[this.name].push(this.value||"")});return e};window.restore_form_values=function(c,e){var b=jQuery;b(c).find("input,select,textarea").each(function(a){if(this.name){var d=
e[this.name];"undefined"!=typeof d&&null!==d&&("input"!==this.nodeName.toLowerCase()||"checkbox"!==this.type&&"radio"!==this.type?"select"===this.nodeName.toLowerCase()?b(this).find("option").each(function(h){this.selected=1<d.length?0<=b.inArray(this.value,d):0===d.length?!1:this.value===d[0]}):this.value=d.length?d[0]:"":this.checked=1<d.length?0<=b.inArray(this.value,d):0===d.length?!1:this.value===d[0])}})};window.init_cached_state=function(c){var e=jQuery;c=c||"#EntryForm";onbeforeunload_fns=
[];onbeforerestorevalues_fns=[];e(window).on("beforeunload",function(){var b={form_values:get_form_values(c)};e.each(onbeforeunload_fns,function(a,d){d(b)});document.getElementById("cache_form_values").value=JSON.stringify(b)});window.cache_register_onbeforeunload=function(b){onbeforeunload_fns.push(b)};window.cache_register_onbeforerestorevalues=function(b){onbeforerestorevalues_fns.push(b)};window.restore_cached_state=function(){var b=document.getElementById("cache_form_values");if(b&&b.value){var a=
JSON.parse(b.value);e.each(onbeforerestorevalues_fns,function(d,h){h(a)});restore_form_values(c,a.form_values)}}}})();
(function(){var c=jQuery,e={"en-CA":"d M yy",de:"dd.mm.yy",fr:"d M yy",it:"d M yy",nl:"d M yy",no:"d M yy",pt:"d-mm-yy",sv:"d M yy",hu:"M d. yy",ro:"d M yy",hr:"d M yy",sl:"d M yy",bg:"d MM yy",ru:"d M yy",tr:"d M yy",lv:"d M yy",lt:"d M yy",ko:"yy/mm/dd","zh-CN":"yy/mm/dd",th:"d M yy"},b={"en-CA":!0,"":!0},a={},d={"fr-CA":"fr","es-MX":"es"},h=function(){var n=c(this),k=n.data("culture"),g=e[k]||c.datepicker.regional[k].dateFormat,l={};n.hasClass("NoYear")&&(g=g.replace(/[\- .\/]*yy[\/]?/,""),l={beforeShow:function(q,
r){r.dpDiv.addClass("NoYearDatePicker")},onClose:function(q,r){r.dpDiv.removeClass("NoYearDatePicker")},changeYear:!1});l.dateFormat=g;n.datepicker(c.extend({},c.datepicker.regional[k],l)).prop("autocomplete","off")},m=function(n){c.getScript("//ajax.googleapis.com/ajax/libs/jqueryui/"+c.ui.version+"/i18n/jquery.ui.datepicker-"+n+".min.js",function(){b[n]=!0;c.each(a[n],function(){h.call(this)});delete a[n]})};c.datepicker.regional["en-CA"]=c.extend({},c.datepicker.regional[""]);c.fn.extend({autodatepicker:function(){return this.each(function(){var n=
c(this);var k=n.parents("[lang]").first().prop("lang")||"en-CA";k=d[k]||k;n.data("culture",k);b[k]?h.call(this):(n=a[k],n||(n=a[k]=[],m(k)),n.push(this))})}});jQuery(function(){c("input.DatePicker").autodatepicker()})})();
(function(c){function e(b){return b&&b.constructor===Number?b+"px":b}c.fn.bgiframe=c.browser.msie&&/msie 6\.0/i.test(navigator.userAgent)?function(b){b=c.extend({top:"auto",left:"auto",width:"auto",height:"auto",opacity:!0,src:"javascript:false;"},b);var a='<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+b.src+'"style="display:block;position:absolute;z-index:-1;'+(!1!==b.opacity?"filter:Alpha(Opacity='0');":"")+"top:"+("auto"==b.top?"expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+'px')":
e(b.top))+";left:"+("auto"==b.left?"expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+'px')":e(b.left))+";width:"+("auto"==b.width?"expression(this.parentNode.offsetWidth+'px')":e(b.width))+";height:"+("auto"==b.height?"expression(this.parentNode.offsetHeight+'px')":e(b.height))+';"/>';return this.each(function(){0===c(this).children("iframe.bgiframe").length&&this.insertBefore(document.createElement(a),this.firstChild)})}:function(){return this};c.fn.bgIframe=c.fn.bgiframe})(jQuery);
(function(){var c=function(a){a=a.toLowerCase();a=a.replace(RegExp("[\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5]","g"),"a");a=a.replace(RegExp("\u00e6","g"),"ae");a=a.replace(RegExp("\u00e7","g"),"c");a=a.replace(RegExp("[\u00e8\u00e9\u00ea\u00eb]","g"),"e");a=a.replace(RegExp("[\u00ec\u00ed\u00ee\u00ef]","g"),"i");a=a.replace(RegExp("\u00f1","g"),"n");a=a.replace(RegExp("[\u00f2\u00f3\u00f4\u00f5\u00f6]","g"),"o");a=a.replace(RegExp("\u009c","g"),"oe");a=a.replace(RegExp("[\u00f9\u00fa\u00fb\u00fc]","g"),
"u");return a=a.replace(RegExp("[\u00fd\u00ff]","g"),"y")};window.string_ci_ai=c;var e=function(a,d,h,m,n){h=h||"value";m=m||"";n=n||"";return function(k,g){if(d.term&&(new RegExp(m+a.ui.autocomplete.escapeRegex(d.term)+n,"i")).test(k.term)&&d.content&&13>d.content.length){var l=new RegExp(m+a.ui.autocomplete.escapeRegex(k.term)+n,"i");g(a.grep(d.content,function(q){return l.test(c(q[h]))}));return!0}return!1}};window.default_cache_search_fn=e;var b=function(a,d,h,m,n){h=h||{};n=n||e(a,h,m||"value");
return function(k,g,l){k.term=c(k.term);h.term===k.term&&h.content?g(h.content):n(k,g)||a.ajax({url:l||d,dataType:"json",data:k,cache:!1,success:function(q){h.term=k.term;h.content=q;g(q)}})}};window.create_caching_source_fn=b;window.init_community_autocomplete=function(a,d,h,m,n){var k={};n&&=a(n);n&&!n.length&&(n=null);var g=a("#"+d).autocomplete({focus:function(l,q){return!1},select:function(l,q){g.data({chkid:q.item.chkid,display:q.item.value})},source:b(a,h,k),minLength:m}).keypress(function(l){"13"==
l.keyCode&&(l.preventDefault(),g.autocomplete("close"))});n&&(g.parents("form").on("submit",function(){var l=g.val();if(g.data("display")===l)n.val(g.data("chkid"));else{if(k.content){var q=c(l);l=a.grep(k.content,function(r){return c(r.value)===q});if(1===l.length){n.val(l[0].chkid);g.data({chkid:l[0].chkid,display:l[0].value}).val(l[0].value);return}}n.val("")}}),cache_register_onbeforerestorevalues(function(l){g.length&&(l=l["autocomplete_data_"+g[0].id])&&g.data(l)}),cache_register_onbeforeunload(function(l){if(g.length){var q=
g.data();q.display&&q.chkid&&(l["autocomplete_data_"+g[0].id]={display:q.display,chkid:q.chkid})}}))}})();
(function(){window.entryform=window.entryform||{};window.create_checklist_onbefore_fns=function(b,a,d,h){cache_register_onbeforeunload(function(m){m[a+"_added"]=d});cache_register_onbeforerestorevalues(function(m){(m=m[a+"_added"])&&b.each(m,function(n,k){h(k.chkid,k.display,"")})})};window.basic_chk_add_html=function(b,a){return function(d,h){d=b("<tr>").append(b("<td>").append(b("<input>").prop({id:a+"_ID_"+d,type:"checkbox",checked:!0,defaultChecked:!0,name:a+"_ID",value:d})).append(document.createTextNode(" "+
h))).append(b("<td>").append(b("<input>").prop({id:a+"_NOTES_"+d,name:a+"_NOTES_"+d,size:entryform.chk_notes_size,maxlength:entryform.chk_notes_maxlen})));b("#"+a+"_existing_add_table").append(d);return d.find('input[type="checkbox"]')[0]}};var c={},e=function(b){$("#NEW_"+b).autocomplete(c[b])};window.init_autocomplete_checklist=function(b,a){var d=a.field;if(!c[d]){var h=a.source;a.minLength=a.minLength||1;a.delay=a.delay||300;a.add_new_html=a.add_new_html||basic_chk_add_html(b,d);a.match_prop=
a.match_prop||"value";a.txt_not_found=a.txt_not_found||"Not Found";var m=b(a.delegate_root||document),n=a.added_values||[],k=function(f,p,u){var w=document.getElementById(d+"_ID_"+f);w?(w.checked=!0,a.after_add_new_value&&a.after_add_new_value.call(w)):(n.push({chkid:f,display:p,label:u}),f=a.add_new_html(f,p,u),a.after_add_new_value&&a.after_add_new_value.call(f))};create_checklist_onbefore_fns(b,d,n,k);var g={},l=function(f){b("#NEW_"+d).data({chkid:"",display:"",label:""}).prop("value","").focus();
b("#"+d+"_error").hide("slow",function(){b(this).remove()})},q=null,r=null;(function(f){b.isArray(f)?(r=function(p,u){var w=new RegExp(b.ui.autocomplete.escapeRegex(string_ci_ai(p.term)));u(b.grep(f,function(t){return w.test(string_ci_ai(t[a.match_prop]||t))}))},q=function(p,u){var w=string_ci_ai(p);p=b.grep(f,function(t){return string_ci_ai(string_ci_ai(t[a.match_prop]||t))===w});if(1===p.length)return u(p[0]),!0;u()}):"string"===typeof f?(r=create_caching_source_fn(b,f,g,a.match_prop),q=function(p,
u,w){var t=string_ci_ai(p);if(g.content){var v=b.grep(g.content,function(x){return string_ci_ai(x[a.match_prop])===t});if(1===v.length){u(v[0]);return}}w||string_ci_ai(g.term||"")===t?u():r({term:t},function(x){q(p,u,!0)})}):(r=f,q=a.look_for_fn)})(h);m.on("click","#add_"+d,function(f){f=b("#NEW_"+d);var p=f.data("chkid"),u=f.data("display"),w=f.data("label"),t=f[0].value;if(p&&u&&u==t)return k(p,u,w),l(),!1;q(f[0].value,function(v){v?(k(v.chkid,v.value,v.label),l()):0===b("#"+d+"_error").length&&
(b("#"+d+"_new_input_table").before(b("<p>").hide().addClass("Alert").prop("id",d+"_error").append(document.createTextNode(a.txt_not_found))),b("#"+d+"_error").show("slow"))});return!1});c[d]={focus:function(f,p){return!1},source:r,minLength:a.minLength,delay:a.delay,select:function(f,p){b("#NEW_"+d).data({chkid:p.item.chkid,display:p.item.value,label:p.item.label})}};m.on("keypress","#NEW_"+d,function(f){"13"==f.keyCode&&(f.preventDefault(),b("#NEW_"+d).autocomplete("close"),b("#add_"+d).trigger("click"))})}e(d)};
window.init_languages=function(b,a){var d=null,h=null,m=b("#LN_existing_add_table"),n=function(){var k=b(this).parents(".language-entry").find(".language-details-notes");this.checked?k.slideDown():k.slideUp()};init_autocomplete_checklist(b,{field:"LN",source:entryform.languages_source,txt_not_found:a,after_add_new_value:n,add_new_html:function(k,g){null===d&&(d=b("#add_LN"),h=d.data("newTemplate"));k=h.replace(/LANGNAMELANGNAME/g,g).replace(/IDIDID/g,k);m.append(k)}});m.on("change",".language-primary",
n).uitooltip({items:"[data-help-text]",content:function(){return'<div class="language-help-text">'+b(this).data("helpText")+"</div>"},position:{my:"center bottom-20",at:"center top",using:function(k,g){b(this).css(k);b("<div>").addClass("arrow").addClass(g.vertical).addClass(g.horizontal).appendTo(this)}}});window.languages_check_state=n}})();
(function(){window.only_items_chk_add_html=function(c,e,b){return function(a,d){b&&b();c("#"+e+"_existing_add_container").append(c("<label>").append(c("<input>").prop({id:e+"_ID_"+a,type:"checkbox",checked:!0,defaultChecked:!0,name:e+"_ID",value:a})).append("&nbsp;").append(document.createTextNode(d))).append(" ; ")}};window.init_check_for_autochecklist=function(c){var e=jQuery,b=function(){return e("<li>").append(e("<span>").data("jump_location",this.id).addClass("UnaddedChecklistJump SimulateLink").append(e(this).parentsUntil("td[data-field-display-name]").parent().data("fieldDisplayName")))},
a=e("input[id^=NEW_]");a.length&&(e("#EntryForm").submit(function(d){var h=a.map(function(){return this.value?this:null});if(h.length&&!d.isDefaultPrevented()){if(!confirm(c)){d.preventDefault();e("#SUBMIT_BUTTON").prop("disabled",!1);d=e("#unadded_checklist_error_box");var m=e("#unadded_checklist_error_list");var n=d.is(":visible");n&&m.children("ul:first").hide("slow",function(){e(this).remove()});var k=e("<ul>");n&&k.hide();m.append(k);e.each(h.map(b),function(){k.append(this)});n?k.show("slow"):
d.show("slow")}}else d.isDefaultPrevented()&&(d=e("#unadded_checklist_error_box"),m=e("#unadded_checklist_error_list"),d.hide("slow",function(){m.children().remove()}))}),e(document).on("click",".UnaddedChecklistJump",function(){var d=e(this).data("jump_location");(d=document.getElementById(d))&&d.scrollIntoView(!0)}))};window.init_entryform_items=function(c,e,b){var a=jQuery;c.each(function(){var d=null,h=this,m=a(h),n=1,k=m.find(".EntryFormItemContainerIds")[0];if(k){var g=m.data("maxAdd");g&&=
parseInt(g,10);var l=[];k.value&&(l=a.map(k.value.split(","),function(t){return 0===t.indexOf("NEW")&&0!==t.indexOf("NEWFB")?null:t}));var q={},r=function(){m.find(".EntryFormItemBox").each(function(t){a(this).find(".EntryFormItemCount").text(t+1)})},f=function(t){if(g){var v=m.find(".EntryFormItemContent:hidden").parent().find("button.EntryFormItemDelete").prop("disabled",!t);w.prop("disabled",!t);t?(v.removeClass("ui-state-disabled"),w.removeClass("ui-state-disabled")):(v.addClass("ui-state-disabled"),
w.addClass("ui-state-disabled"))}},p=function(){var t=0,v;for(v in q)t++;return l.length-t},u=function(t){var v=0;if(g&&!t&&(v=p(),v>=g)){alert("over");return}var x=m.data("addTmpl");l.push("NEW"+n++);k.value=l.join(",");x=a(x.replace(/\[COUNT\]/g,l.length).replace(/\[ID\]/g,l[l.length-1]));x.find(".DatePicker").autodatepicker();x.find(".Province").combobox({source:window.cioc_province_source});entryform.service_titles&&x.find(".ServiceTitleField").combobox({source:entryform.service_titles});m.append(x);
d&&(d.sortable("refresh"),r());g&&!t&&v+1===g&&f(!1)},w=m.parent().find(".EntryFormItemAdd").click(function(){u(!1)});m.on("click","button.EntryFormItemDelete",function(){var t=this,v=a(this).parents(".EntryFormItemBox").find(".EntryFormItemContent"),x=this.id.split("_");x=x[x.length-2];if(v.is(":visible"))v.hide("slow",function(){q[x]=get_form_values(v);a(t).text(b);v.find("input,select,textarea").each(function(){"input"!==this.nodeName.toLowerCase()||"checkbox"!==this.type&&"radio"!==this.type?
"select"===this.nodeName.toLowerCase()?a(this).find("option").each(function(){this.selected=!1}):this.value="":this.checked=!1});f(!0)});else{var y=0;if(g&&(y=p(),y>=g)){alert("over");return}var z=q[x];z&&(delete q[x],restore_form_values(v,z),v.show("slow",function(){a(t).text(e)}),g&&y+1===g&&f(!1))}});m.hasClass("sortable")&&(d=m.sortable({items:".EntryFormItemBox"}),d.bind("sortstart",function(t,v){v.helper.bgiframe();m.addClass("sorting")}),d.bind("sortstop",function(){var t=d.sortable("toArray");
l=a.map(t,function(v){v=v.split("_");return v[v.length-2]});k.value=l.join(",");setTimeout(function(){m.removeClass("sorting");r()},1)}));cache_register_onbeforeunload(function(t){t[h.id+"_ids"]=l;t[h.id+"_deletes"]=q;d&&(t[h.id+"_order"]=d.sortable("toArray"))});cache_register_onbeforerestorevalues(function(t){t[h.id+"_ids"]&&a.each(t[h.id+"_ids"],function(v,x){0===x.indexOf("NEW")&&u(!0)});t[h.id+"_deletes"]&&(q=t[h.id+"_deletes"],m.find(".EntryFormItemContent").each(function(){var v=this.id.split("_");
v=v[v.length-2];q[v]&&a(this).hide().parent().find("button.EntryFormItemDelete").text(b)}));g&&p()>=g&&f(!1);d&&(t=t[h.id+"_order"])&&(t.reverse(),a.each(t,function(v,x){a("#"+x).detach().prependTo(m)}),d.sortable("refresh"),r())})}})};window.init_schedule=function(c){var e=function(){var b=c(this).parents(".EntryFormItemBox"),a=this.value;"0"===a?b.find(".recurs-ui").hide():"1"==a?(b.find(".repeat-every-ui, .repeats-on-ui, .recurs-week-label").show(),b.find(".repeat-week-of-month-ui, .repeat-day-of-month-ui, .recurs-month-label").hide()):
"2"==a?(b.find(".repeat-every-ui, .repeat-day-of-month-ui, .recurs-month-label").show(),b.find(".repeat-week-of-month-ui, .repeats-on-ui, .recurs-week-label").hide()):(b.find(".repeat-week-of-month-ui, .repeats-on-ui, .recurs-month-label").show(),b.find(".repeat-every-ui, .repeat-day-of-month-ui, .recurs-week-label").hide())};c("#ScheduleEditArea").on("change",".recur-type-selector",e).on("click",".schedule-ui-accept-feedback",function(b){var a=c(this);b=a.parents(".EntryFormItemBox");a=a.data("schedule");
var d=b.find(".recur-type-selector");restore_form_values(b,a);e.call(d[0]);return!1}).find(".recur-type-selector").each(e)}})();
(function(c){var e=function(a,d){return function(h,m){m=d(h,document.createTextNode(m));c("#"+a+"_existing_add_container").append(c("<label>").append(c("<input>").prop({id:a+"_ID_"+h,type:"checkbox",checked:!0,defaultChecked:!0,name:a+"_ID",value:h})).append("&nbsp;").append(m)).append(c("<br>"))}},b=function(a,d,h,m){init_autocomplete_checklist(c,{field:a,source:d,add_new_html:e(a,h),txt_not_found:m})};window.init_publication_checklist=function(a,d){init_cached_state();b("PUB",a,function(h,m){return m},
d);b("ADDPUB",a,function(h,m){return m},d);restore_cached_state()};window.init_subject_checklist=function(a,d,h){var m=function(n,k){return c("<a>").prop("href",d.replace(/IDIDID/g,n.toString())).append(k)};init_cached_state();b("UseSubj",a,m,h);b("BroaderSubj",a,m,h);b("RelatedSubj",a,m,h);restore_cached_state()}})(jQuery);
