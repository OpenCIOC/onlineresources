/*
 Copyright (c) 2010 Brandon Aaron (http://brandonaaron.net)
 Licensed under the MIT License (LICENSE.txt).

 Version 2.1.2
*/
window.CIOC={};
(function(a,c){c.do_drop_down_navigation=function(){for(var d=a.getElementById("ActionList").options,b=0;b<d.length;b++)if(d[b].selected){var h=d[b].getAttribute("href");h&&("undefined"!=typeof d[b].attributes.newwindow?c.open(h):c.location.href=h);break}};jQuery(function(d){d("[data-toggle=dialog]").each(function(){var b=d(this),h=d(b.data("target")),p={autoOpen:!1,title:h.data("title"),modal:h.data("modal")};h.dialog(p);b.click(function(){h.dialog("isOpen")?h.dialog("close"):h.dialog("open")})})})})(document,window);
function CheckAll(a,c){a||="IDList";var d=c;c||(d=document.RecordList);c=d.elements.length;for(var b=0;b<c;b++){var h=d.elements[b];h.name===a&&(h.checked=!0)}}function ClearAll(a,c){a||="IDList";var d=c;c||(d=document.RecordList);c=d.elements.length;for(var b=0;b<c;b++){var h=d.elements[b];h.name===a&&(h.checked=!1)}}function add_class(a,c){a&&!(new RegExp("\\b"+c+"\\b")).test(a.className)&&(a.className&&(c=" "+c),a.className+=c)}
function remove_class(a,c){if(a){for(var d=a.className.split(" "),b=[],h=0;h<d.length;h++){var p=d[h];p!==c&&b.push(p)}a.className=b.join(" ")}}function hide(a){add_class(a,"NotVisible")}function show(a){remove_class(a,"NotVisible")}function openWin(a,c){window.open(a,c,"toolbar=no,width=490,height=485,location=no,scrollBars=yes,resizable=no,titlebar=yes").focus()}
function openWinL(a,c){window.open(a,c,"toolbar=no,width=650,height=520,location=no,scrollBars=yes,resizable=no,titlebar=yes").focus()}function openWinXL(a,c){window.open(a,c,"toolbar=no,width=755,height=550,location=no,scrollBars=yes,resizable=no,titlebar=yes").focus()}jQuery(function(a){var c={sm:openWin,lg:openWinL,xl:openWinXL};a(document).on("click","a.poplink",function(){var d=a(this).data("popargs");(c[d.size||"sm"]||openWin)(this.href,d.name||"popwin");return!1})});
(function(){var a=jQuery,c={},d=function(e){null!==e&&"undefined"!==typeof e?a("#myListCount").text(e):(e=a("#myListCount").text())&&(e=parseInt(e,10));e?c.myListLink.show():c.myListLink.hide()},b=function(e){a.each(e,function(m,q){a("#added_to_list_"+q).show();a("#add_to_list_"+q).hide()})},h=function(e){return function(m){m.fail?alert(m.errinfo):(m.ids?d(a.grep(m.ids,f[c.domain]).length):m.count?d(m.count):d(0),b([e]))}},p=function(e){e=a(e.currentTarget).data("id");a.ajax({success:h(e),dataType:"json",
error:function(){alert("Error")},data:{id:e},type:"POST",url:c.current_list_url})},t=function(e){return function(m){if(m.fail)alert(m.errinfo);else{m=!0;if(e){var q=a("#results_table #remove_from_list_"+e);q.length?q.parent().parent().remove():(m=!1,q=a("#results_container #remove_from_list_"+e),q.parents(".dlist-result").remove())}(m?1!==a("#results_table tr").length:0!==a("#results_container .dlist-result").length)&&e||(a("#records_ui").hide(),a("#no_records_message").show())}}},r=function(e){e=
a(e.currentTarget).data("id");a.ajax({success:t(e),dataType:"json",error:function(){alert("Error")},data:{ID:e,RemoveItem:c.domain},type:"POST",url:c.current_list_url})},n=function(e){a.ajax({success:t(),dataType:"json",error:function(){alert("Error")},data:{ID:"all",RemoveItem:c.domain},type:"POST",url:c.current_list_url})},f={CIC:function(e){return/^[A-Za-z]{3}[0-9]{4,5}$/.test(e)},VOL:function(e){return/^[1-9][0-9]*$/.test(e)}},l=function(e){if(e.fail)g();else if(e.inrequest){var m=a.grep(e.ids,
f[c.domain]);b(m);d(m.length);(e=e.previous_ids)&&a.each(e,function(q,u){a("#ct_added_to_previous_request_"+u).show()});a(".ListUI img").prop("src",function(q,u){return u.replace("list","referral")});a("#list_header_text").hide();a("#ct_header_text").show();c.current_list_url=c.ct_update_url;k()}else g()},g=function(){var e=function(){c.list_view_mode||b(c.already_added||[]);c.current_list_url=c.list_view_mode&&"ct"===c.list_view_mode?c.ct_update_url:c.list_update_url;d((c.already_added||[]).length);
k()};c.list_view_mode||c.has_session?e():a.ajax({dataType:"json",error:null,url:c.list_update_url,data:{SessionTest:"on"},type:"POST",success:function(m){m.has_session&&e()}})},k=function(){a(".HideListUI").delegate(".add_to_list","click",p).delegate(".remove_from_list","click",r).removeClass("HideListUI");a("#remove_all_from_list").click(n);a.browser.msie&&"8.0">a.browser.msie&&a(".ListUI").removeClass("FixIE")};window.init_list_adder=function(e){c=e;c.myListLink=a("#myListLink").parent(":hidden").add("#myListLink");
e.in_request?a.ajax({success:l,dataType:"json",error:null,type:"POST",url:e.in_request}):g()}})();this.JSON||(this.JSON={});
(function(){function a(f){return 10>f?"0"+f:f}function c(f){h.lastIndex=0;return h.test(f)?'"'+f.replace(h,function(l){var g=r[l];return"string"===typeof g?g:"\\u"+("0000"+l.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+f+'"'}function d(f,l){var g=p,k=l[f];k&&"object"===typeof k&&"function"===typeof k.toJSON&&(k=k.toJSON(f));"function"===typeof n&&(k=n.call(l,f,k));switch(typeof k){case "string":return c(k);case "number":return isFinite(k)?String(k):"null";case "boolean":case "null":return String(k);
case "object":if(!k)return"null";p+=t;var e=[];if("[object Array]"===Object.prototype.toString.apply(k)){var m=k.length;for(f=0;f<m;f+=1)e[f]=d(f,k)||"null";l=0===e.length?"[]":p?"[\n"+p+e.join(",\n"+p)+"\n"+g+"]":"["+e.join(",")+"]";p=g;return l}if(n&&"object"===typeof n)for(m=n.length,f=0;f<m;f+=1){var q=n[f];"string"===typeof q&&(l=d(q,k))&&e.push(c(q)+(p?": ":":")+l)}else for(q in k)Object.hasOwnProperty.call(k,q)&&(l=d(q,k))&&e.push(c(q)+(p?": ":":")+l);l=0===e.length?"{}":p?"{\n"+p+e.join(",\n"+
p)+"\n"+g+"}":"{"+e.join(",")+"}";p=g;return l}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(f){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(f){return this.valueOf()});var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,p,t,r={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},n;"function"!==typeof JSON.stringify&&(JSON.stringify=function(f,l,g){var k;t=p="";if("number"===typeof g)for(k=0;k<g;k+=1)t+=" ";else"string"===typeof g&&(t=g);if((n=l)&&"function"!==typeof l&&("object"!==typeof l||"number"!==typeof l.length))throw Error("JSON.stringify");return d("",{"":f})});
"function"!==typeof JSON.parse&&(JSON.parse=function(f,l){function g(k,e){var m,q=k[e];if(q&&"object"===typeof q)for(m in q)if(Object.hasOwnProperty.call(q,m)){var u=g(q,m);void 0!==u?q[m]=u:delete q[m]}return l.call(k,e,q)}f=String(f);b.lastIndex=0;b.test(f)&&(f=f.replace(b,function(k){return"\\u"+("0000"+k.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(f.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+f+")"),"function"===typeof l?g({"":f},""):f;throw new SyntaxError("JSON.parse");})})();
(function(){window.get_form_values=function(a){var c={};jQuery(a).find("input,select,textarea").each(function(d){if(this.name)if(c[this.name]||(c[this.name]=[]),"select"===this.nodeName.toLowerCase()){var b=c[this.name];$(this).find("option").each(function(h){this.selected&&b.push(this.value)})}else("input"!==this.nodeName.toLowerCase()||"checkbox"!==this.type&&"radio"!==this.type||this.checked)&&c[this.name].push(this.value||"")});return c};window.restore_form_values=function(a,c){var d=jQuery;d(a).find("input,select,textarea").each(function(b){if(this.name){var h=
c[this.name];"undefined"!=typeof h&&null!==h&&("input"!==this.nodeName.toLowerCase()||"checkbox"!==this.type&&"radio"!==this.type?"select"===this.nodeName.toLowerCase()?d(this).find("option").each(function(p){this.selected=1<h.length?0<=d.inArray(this.value,h):0===h.length?!1:this.value===h[0]}):this.value=h.length?h[0]:"":this.checked=1<h.length?0<=d.inArray(this.value,h):0===h.length?!1:this.value===h[0])}})};window.init_cached_state=function(a){var c=jQuery;a=a||"#EntryForm";onbeforeunload_fns=
[];onbeforerestorevalues_fns=[];c(window).on("beforeunload",function(){var d={form_values:get_form_values(a)};c.each(onbeforeunload_fns,function(b,h){h(d)});document.getElementById("cache_form_values").value=JSON.stringify(d)});window.cache_register_onbeforeunload=function(d){onbeforeunload_fns.push(d)};window.cache_register_onbeforerestorevalues=function(d){onbeforerestorevalues_fns.push(d)};window.restore_cached_state=function(){var d=document.getElementById("cache_form_values");if(d&&d.value){var b=
JSON.parse(d.value);c.each(onbeforerestorevalues_fns,function(h,p){p(b)});restore_form_values(a,b.form_values)}}}})();
(function(){var a=jQuery,c={"en-CA":"d M yy",de:"dd.mm.yy",fr:"d M yy",it:"d M yy",nl:"d M yy",no:"d M yy",pt:"d-mm-yy",sv:"d M yy",hu:"M d. yy",ro:"d M yy",hr:"d M yy",sl:"d M yy",bg:"d MM yy",ru:"d M yy",tr:"d M yy",lv:"d M yy",lt:"d M yy",ko:"yy/mm/dd","zh-CN":"yy/mm/dd",th:"d M yy"},d={"en-CA":!0,"":!0},b={},h={"fr-CA":"fr","es-MX":"es"},p=function(){var r=a(this),n=r.data("culture"),f=c[n]||a.datepicker.regional[n].dateFormat,l={};r.hasClass("NoYear")&&(f=f.replace(/[\- .\/]*yy[\/]?/,""),l={beforeShow:function(g,
k){k.dpDiv.addClass("NoYearDatePicker")},onClose:function(g,k){k.dpDiv.removeClass("NoYearDatePicker")},changeYear:!1});l.dateFormat=f;r.datepicker(a.extend({},a.datepicker.regional[n],l)).prop("autocomplete","off")},t=function(r){a.getScript("//ajax.googleapis.com/ajax/libs/jqueryui/"+a.ui.version+"/i18n/jquery.ui.datepicker-"+r+".min.js",function(){d[r]=!0;a.each(b[r],function(){p.call(this)});delete b[r]})};a.datepicker.regional["en-CA"]=a.extend({},a.datepicker.regional[""]);a.fn.extend({autodatepicker:function(){return this.each(function(){var r=
a(this);var n=r.parents("[lang]").first().prop("lang")||"en-CA";n=h[n]||n;r.data("culture",n);d[n]?p.call(this):(r=b[n],r||(r=b[n]=[],t(n)),r.push(this))})}});jQuery(function(){a("input.DatePicker").autodatepicker()})})();
(function(a){function c(d){return d&&d.constructor===Number?d+"px":d}a.fn.bgiframe=a.browser.msie&&/msie 6\.0/i.test(navigator.userAgent)?function(d){d=a.extend({top:"auto",left:"auto",width:"auto",height:"auto",opacity:!0,src:"javascript:false;"},d);var b='<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+d.src+'"style="display:block;position:absolute;z-index:-1;'+(!1!==d.opacity?"filter:Alpha(Opacity='0');":"")+"top:"+("auto"==d.top?"expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+'px')":
c(d.top))+";left:"+("auto"==d.left?"expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+'px')":c(d.left))+";width:"+("auto"==d.width?"expression(this.parentNode.offsetWidth+'px')":c(d.width))+";height:"+("auto"==d.height?"expression(this.parentNode.offsetHeight+'px')":c(d.height))+';"/>';return this.each(function(){0===a(this).children("iframe.bgiframe").length&&this.insertBefore(document.createElement(b),this.firstChild)})}:function(){return this};a.fn.bgIframe=a.fn.bgiframe})(jQuery);
(function(){var a=function(b){b=b.toLowerCase();b=b.replace(RegExp("[\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5]","g"),"a");b=b.replace(RegExp("\u00e6","g"),"ae");b=b.replace(RegExp("\u00e7","g"),"c");b=b.replace(RegExp("[\u00e8\u00e9\u00ea\u00eb]","g"),"e");b=b.replace(RegExp("[\u00ec\u00ed\u00ee\u00ef]","g"),"i");b=b.replace(RegExp("\u00f1","g"),"n");b=b.replace(RegExp("[\u00f2\u00f3\u00f4\u00f5\u00f6]","g"),"o");b=b.replace(RegExp("\u009c","g"),"oe");b=b.replace(RegExp("[\u00f9\u00fa\u00fb\u00fc]","g"),
"u");return b=b.replace(RegExp("[\u00fd\u00ff]","g"),"y")};window.string_ci_ai=a;var c=function(b,h,p,t,r){p=p||"value";t=t||"";r=r||"";return function(n,f){if(h.term&&(new RegExp(t+b.ui.autocomplete.escapeRegex(h.term)+r,"i")).test(n.term)&&h.content&&13>h.content.length){var l=new RegExp(t+b.ui.autocomplete.escapeRegex(n.term)+r,"i");f(b.grep(h.content,function(g){return l.test(a(g[p]))}));return!0}return!1}};window.default_cache_search_fn=c;var d=function(b,h,p,t,r){p=p||{};r=r||c(b,p,t||"value");
return function(n,f,l){n.term=a(n.term);p.term===n.term&&p.content?f(p.content):r(n,f)||b.ajax({url:l||h,dataType:"json",data:n,cache:!1,success:function(g){p.term=n.term;p.content=g;f(g)}})}};window.create_caching_source_fn=d;window.init_community_autocomplete=function(b,h,p,t,r){var n={};r&&=b(r);r&&!r.length&&(r=null);var f=b("#"+h).autocomplete({focus:function(l,g){return!1},select:function(l,g){f.data({chkid:g.item.chkid,display:g.item.value})},source:d(b,p,n),minLength:t}).keypress(function(l){"13"==
l.keyCode&&(l.preventDefault(),f.autocomplete("close"))});r&&(f.parents("form").on("submit",function(){var l=f.val();if(f.data("display")===l)r.val(f.data("chkid"));else{if(n.content){var g=a(l);l=b.grep(n.content,function(k){return a(k.value)===g});if(1===l.length){r.val(l[0].chkid);f.data({chkid:l[0].chkid,display:l[0].value}).val(l[0].value);return}}r.val("")}}),cache_register_onbeforerestorevalues(function(l){f.length&&(l=l["autocomplete_data_"+f[0].id])&&f.data(l)}),cache_register_onbeforeunload(function(l){if(f.length){var g=
f.data();g.display&&g.chkid&&(l["autocomplete_data_"+f[0].id]={display:g.display,chkid:g.chkid})}}))}})();
(function(a){window.init_general_heading_icons=function(c,d){d=d||a("#generalheading_IconNameFull");d.autocomplete({focus:function(b,h){return!1},source:create_caching_source_fn(a,c),minLength:3}).keypress(function(b){"13"==b.keyCode&&(b.preventDefault(),d.autocomplete("close"))});d.data("autocomplete")._renderItem=function(b,h){return a("<li></li>").data("item.autocomplete",h).append(a("<a></a>").text(h.label+" ").append(a(" <span></span>").addClass(h.label+" "+h.class_extra))).appendTo(b)}}})(jQuery);
(function(a){var c=function(b){var h=a("#generalheading_TaxonomyName");h.prop("checked")&&!h.prop("disabled")?a(".name-row").hide(b):a(".name-row").show(b)},d=function(b){b=a(b);b.find(".remove-link").before('<a class="SimulateLink edit-link"><img src="/images/edit.gif"></a> ');return b};window.init_gh_tax_edit=function(b,h){init_cached_state();cache_register_onbeforeunload(function(g){g.tax_selection=a("#tax-selection").html()});cache_register_onbeforerestorevalues(function(g){(g=g.tax_selection)&&
a("#tax-selection").html(g)});restore_cached_state();c();a("#generalheading_TaxonomyName").click(function(){c("slow")});a(document).on("click","a.remove-link",function(){var g=a(this).parents("li").first(),k=g.parent(),e=k.parent(),m=e.data("match");g.remove();0===k.children().length?(k.remove(),e.text(h)):k.children().each(function(q){var u=m+"-"+q+".Code-";a(this).find("input").prop("name",function(v){return u+v})});p()});var p=function(){if(!f){var g=a("#tax-selection"),k=g.find(".MustMatchTermList li").length;
g=g.find(".MatchAnyTermList li").length;k=1<g||k&&g;a("#generalheading_TaxonomyName").prop("disabled",k);c()}},t=a("#searchFrame"),r=a(window).resize(function(){n.dialog("option",{width:r.width()-30,height:r.height()-30});n.dialog("option","position","center");t.prop("height",n.height())}),n=a("#tax-selection-dialog").dialog({autoOpen:!1,resizable:!1,draggable:!1,modal:!0,open:function(){n.dialog("option",{width:r.width()-30,height:r.height()-30});n.dialog("option","position","center");t.prop("height",
n.height())},close:function(){a("html").css("overflow","");a("#dialog-selected-target").empty();f&&(a("#tax-selection").append(f),f=null);p()}}),f=null;a("#modify-term-selection").click(function(){f=a("#tax-selection").contents().remove();t.prop("src",b);a("#dialog-selected-target").empty().append(d(f.clone()));a("html").css("overflow","hidden");n.dialog("open")});var l=function(g,k){return g.code<k.code?-1:g.code>k.code?1:0};window.addBuildTerm=function(g,k){var e=a("#BuildTermList"),m=a("#BuildTermText"),
q=e.data("existingTerms")||[];if(!q.length)m=a('<span id="BuildTermText">'),e.empty().append(m).append(a('<a id="clear-build-term-list" class="SimulateLink"><img src="/images/x.gif"></a>')),a("#SelectDiv,#SuggestDiv").show();else if(0<=a.inArray(g,a.map(q,function(u){return u.code})))return;q.push({code:g,term:k});q.sort(l);e.data("existingTerms",q);m.text(a.map(q,function(u){return u.term}).join(" ~ ")+" ")};n.on("click","#clear-build-term-list",function(){a("#BuildTermList").data("existingTerms",
[]).empty().text(h);a("#SelectDiv,#SuggestDiv").hide()}).on("click",".edit-link",function(){var g=a(this).parent(),k=a.trim(g.text()),e=k.split(" ~ ");g=g.find("input").map(function(){return this.value});var m=[],q;for(q=0;q<g.length;q++)m.push({code:g[q],term:e[q]});a("#BuildTermList").data("existingTerms",m).empty().append(a('<span id="BuildTermText">').text(k+" ")).append(a('<a id="clear-build-term-list" class="SimulateLink"><img src="/images/x.gif"></a>'));a("#SelectDiv,#SuggestDiv").show()});
a("#add-match-all,#add-match-any").click(function(){var g=a("#BuildTermList"),k=a(this).data("target"),e=n.find("."+k+"TermList"),m=e.children("ul"),q=m.length?m.children().length:0,u=a('<li class="TermItem">').html(a("#BuildTermText").html()).append(a('<a class="SimulateLink remove-link"><img src="/images/x.gif"></a>')),v='<input type="hidden" name="'+k+"-"+q+".Code-";d(u);m.length||(m=a("<ul>"),e.empty().append(m));a.each(g.data("existingTerms"),function(w,x){u.append(a(v+w+'" value="'+x.code+'">"'))});
m.append(u);a("#clear-build-term-list").trigger("click")});a("#suggest-link,#suggest-term").click(function(){var g=a("#BuildTermList"),k=a(this).data("st"),e=g.data("existingTerms");g=a.map(e,function(m){return m.term}).join(" ~ ");e=a.map(e,function(m){return m.code}).join(",");k={ST:k,TC:e,TCD:g};a("#searchFrame").prop("src",b+"&"+a.param(k))});a("#save-tax-form").click(function(){a("#tax-selection").append(a("#dialog-selected-target").contents().find(".edit-link").remove().end());f=null;n.dialog("close")});
a("#reset-tax-form").click(function(){a("#dialog-selected-target").empty().append(d(f.clone()))});a("#cancel-tax-form").click(function(){n.dialog("close")});a("#clear-tax-form").click(function(){a("#dialog-selected-target").find(".MustMatchTermList,.MatchAnyTermList").empty().text(h);a("#generalheading_TaxonomyRestrict").prop("checked",!1)})}})(jQuery);
